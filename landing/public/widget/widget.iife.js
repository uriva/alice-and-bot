var aliceAndBot=function(tr){"use strict";var pn,V,hi,_t,pi,_i,yi,mi,nr,rr,ir,Lt={},gi=[],Eo=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ft=Array.isArray;function et(t,e){for(var n in e)t[n]=e[n];return t}function sr(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function or(t,e,n){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?pn.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]==null&&(o[s]=t.defaultProps[s]);return _n(t,o,r,i,null)}function _n(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++hi,__i:-1,__u:0};return i==null&&V.vnode!=null&&V.vnode(s),s}function It(t){return t.children}function tt(t,e){this.props=t,this.context=e}function At(t,e){if(e==null)return t.__?At(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?At(t):null}function vi(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return vi(t)}}function bi(t){(!t.__d&&(t.__d=!0)&&_t.push(t)&&!yn.__r++||pi!=V.debounceRendering)&&((pi=V.debounceRendering)||_i)(yn)}function yn(){for(var t,e,n,r,i,s,o,a=1;_t.length;)_t.length>a&&_t.sort(yi),t=_t.shift(),a=_t.length,t.__d&&(n=void 0,i=(r=(e=t).__v).__e,s=[],o=[],e.__P&&((n=et({},r)).__v=r.__v+1,V.vnode&&V.vnode(n),ar(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??At(r),!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,Oi(s,n,o),n.__e!=i&&vi(n)));yn.__r=0}function wi(t,e,n,r,i,s,o,a,l,d,f){var p,m,v,S,T,R,E=r&&r.__k||gi,w=e.length;for(l=To(n,e,E,l,w),p=0;p<w;p++)(v=n.__k[p])!=null&&(m=v.__i==-1?Lt:E[v.__i]||Lt,v.__i=p,R=ar(t,v,m,i,s,o,a,l,d,f),S=v.__e,v.ref&&m.ref!=v.ref&&(m.ref&&cr(m.ref,null,v),f.push(v.ref,v.__c||S,v)),T==null&&S!=null&&(T=S),4&v.__u||m.__k===v.__k?l=xi(v,l,t):typeof v.type=="function"&&R!==void 0?l=R:S&&(l=S.nextSibling),v.__u&=-7);return n.__e=T,l}function To(t,e,n,r,i){var s,o,a,l,d,f=n.length,p=f,m=0;for(t.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+m,(o=t.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?_n(null,o,null,null,null):Ft(o)?_n(It,{children:o},null,null,null):o.constructor==null&&o.__b>0?_n(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,(d=o.__i=Io(o,n,l,p))!=-1&&(p--,(a=n[d])&&(a.__u|=2)),a==null||a.__v==null?(d==-1&&(i>f?m--:i<f&&m++),typeof o.type!="function"&&(o.__u|=4)):d!=l&&(d==l-1?m--:d==l+1?m++:(d>l?m--:m++,o.__u|=4))):t.__k[s]=null;if(p)for(s=0;s<f;s++)(a=n[s])!=null&&!(2&a.__u)&&(a.__e==r&&(r=At(a)),Ti(a,a));return r}function xi(t,e,n){var r,i;if(typeof t.type=="function"){for(r=t.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=t,e=xi(r[i],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=At(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function mn(t,e){return e=e||[],t==null||typeof t=="boolean"||(Ft(t)?t.some(function(n){mn(n,e)}):e.push(t)),e}function Io(t,e,n,r){var i,s,o=t.key,a=t.type,l=e[n];if(l===null&&t.key==null||l&&o==l.key&&a==l.type&&!(2&l.__u))return n;if(r>(l!=null&&!(2&l.__u)?1:0))for(i=n-1,s=n+1;i>=0||s<e.length;){if(i>=0){if((l=e[i])&&!(2&l.__u)&&o==l.key&&a==l.type)return i;i--}if(s<e.length){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a==l.type)return s;s++}}return-1}function Si(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Eo.test(e)?n:n+"px"}function gn(t,e,n,r,i){var s,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Si(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||Si(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(mi,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=nr,t.addEventListener(e,s?ir:rr,s)):t.removeEventListener(e,s?ir:rr,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ki(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=nr++;else if(e.t<n.u)return;return n(V.event?V.event(e):e)}}}function ar(t,e,n,r,i,s,o,a,l,d){var f,p,m,v,S,T,R,E,w,k,P,M,W,X,ne,Q,Ne,me=e.type;if(e.constructor!=null)return null;128&n.__u&&(l=!!(32&n.__u),s=[a=e.__e=n.__e]),(f=V.__b)&&f(e);e:if(typeof me=="function")try{if(E=e.props,w="prototype"in me&&me.prototype.render,k=(f=me.contextType)&&r[f.__c],P=f?k?k.props.value:f.__:r,n.__c?R=(p=e.__c=n.__c).__=p.__E:(w?e.__c=p=new me(E,P):(e.__c=p=new tt(E,P),p.constructor=me,p.render=Co),k&&k.sub(p),p.props=E,p.state||(p.state={}),p.context=P,p.__n=r,m=p.__d=!0,p.__h=[],p._sb=[]),w&&p.__s==null&&(p.__s=p.state),w&&me.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=et({},p.__s)),et(p.__s,me.getDerivedStateFromProps(E,p.__s))),v=p.props,S=p.state,p.__v=e,m)w&&me.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),w&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(w&&me.getDerivedStateFromProps==null&&E!==v&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(E,P),!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(E,p.__s,P)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(p.props=E,p.state=p.__s,p.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(ye){ye&&(ye.__=e)}),M=0;M<p._sb.length;M++)p.__h.push(p._sb[M]);p._sb=[],p.__h.length&&o.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(E,p.__s,P),w&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(v,S,T)})}if(p.context=P,p.props=E,p.__P=t,p.__e=!1,W=V.__r,X=0,w){for(p.state=p.__s,p.__d=!1,W&&W(e),f=p.render(p.props,p.state,p.context),ne=0;ne<p._sb.length;ne++)p.__h.push(p._sb[ne]);p._sb=[]}else do p.__d=!1,W&&W(e),f=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++X<25);p.state=p.__s,p.getChildContext!=null&&(r=et(et({},r),p.getChildContext())),w&&!m&&p.getSnapshotBeforeUpdate!=null&&(T=p.getSnapshotBeforeUpdate(v,S)),Q=f,f!=null&&f.type===It&&f.key==null&&(Q=Ei(f.props.children)),a=wi(t,Ft(Q)?Q:[Q],e,n,r,i,s,o,a,l,d),p.base=e.__e,e.__u&=-161,p.__h.length&&o.push(p),R&&(p.__E=p.__=null)}catch(ye){if(e.__v=null,l||s!=null)if(ye.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(Ne=s.length;Ne--;)sr(s[Ne]);else e.__e=n.__e,e.__k=n.__k;V.__e(ye,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=Ao(n.__e,e,n,r,i,s,o,l,d);return(f=V.diffed)&&f(e),128&e.__u?void 0:a}function Oi(t,e,n){for(var r=0;r<n.length;r++)cr(n[r],n[++r],n[++r]);V.__c&&V.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){V.__e(s,i.__v)}})}function Ei(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Ft(t)?t.map(Ei):et({},t)}function Ao(t,e,n,r,i,s,o,a,l){var d,f,p,m,v,S,T,R=n.props,E=e.props,w=e.type;if(w=="svg"?i="http://www.w3.org/2000/svg":w=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(d=0;d<s.length;d++)if((v=s[d])&&"setAttribute"in v==!!w&&(w?v.localName==w:v.nodeType==3)){t=v,s[d]=null;break}}if(t==null){if(w==null)return document.createTextNode(E);t=document.createElementNS(i,w,E.is&&E),a&&(V.__m&&V.__m(e,s),a=!1),s=null}if(w==null)R===E||a&&t.data==E||(t.data=E);else{if(s=s&&pn.call(t.childNodes),R=n.props||Lt,!a&&s!=null)for(R={},d=0;d<t.attributes.length;d++)R[(v=t.attributes[d]).name]=v.value;for(d in R)if(v=R[d],d!="children"){if(d=="dangerouslySetInnerHTML")p=v;else if(!(d in E)){if(d=="value"&&"defaultValue"in E||d=="checked"&&"defaultChecked"in E)continue;gn(t,d,null,v,i)}}for(d in E)v=E[d],d=="children"?m=v:d=="dangerouslySetInnerHTML"?f=v:d=="value"?S=v:d=="checked"?T=v:a&&typeof v!="function"||R[d]===v||gn(t,d,v,R[d],i);if(f)a||p&&(f.__html==p.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(p&&(t.innerHTML=""),wi(e.type=="template"?t.content:t,Ft(m)?m:[m],e,n,r,w=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&At(n,0),a,l),s!=null)for(d=s.length;d--;)sr(s[d]);a||(d="value",w=="progress"&&S==null?t.removeAttribute("value"):S!=null&&(S!==t[d]||w=="progress"&&!S||w=="option"&&S!=R[d])&&gn(t,d,S,R[d],i),d="checked",T!=null&&T!=t[d]&&gn(t,d,T,R[d],i))}return t}function cr(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){V.__e(i,n)}}function Ti(t,e,n){var r,i;if(V.unmount&&V.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||cr(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){V.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&Ti(r[i],e,n||typeof t.type!="function");n||sr(t.__e),t.__c=t.__=t.__e=void 0}function Co(t,e,n){return this.constructor(t,n)}function jo(t,e,n){var r,i,s,o;e==document&&(e=document.documentElement),V.__&&V.__(t,e),i=(r=!1)?null:e.__k,s=[],o=[],ar(e,t=e.__k=or(It,null,[t]),i||Lt,Lt,e.namespaceURI,i?null:e.firstChild?pn.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),Oi(s,t,o)}pn=gi.slice,V={__e:function(t,e,n,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(a){t=a}throw t}},hi=0,tt.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=et({},this.state),typeof t=="function"&&(t=t(et({},n),this.props)),t&&et(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),bi(this))},tt.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),bi(this))},tt.prototype.render=It,_t=[],_i=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,yi=function(t,e){return t.__v.__b-e.__v.__b},yn.__r=0,mi=/(PointerCapture)$|Capture$/i,nr=0,rr=ki(!1),ir=ki(!0);var Ro=0;function G(t,e,n,r,i,s){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var d={type:t,props:l,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ro,__i:-1,__u:0,__source:i,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return V.vnode&&V.vnode(d),d}var Ct,ce,ur,Ii,Zt=0,Ai=[],pe=V,Ci=pe.__b,ji=pe.__r,Ri=pe.diffed,Pi=pe.__c,Mi=pe.unmount,$i=pe.__;function vn(t,e){pe.__h&&pe.__h(ce,t,Zt||e),Zt=0;var n=ce.__H||(ce.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function $e(t){return Zt=1,Po(Ni,t)}function Po(t,e,n){var r=vn(Ct++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):Ni(void 0,e),function(a){var l=r.__N?r.__N[0]:r.__[0],d=r.t(l,a);l!==d&&(r.__N=[d,r.__[1]],r.__c.setState({}))}],r.__c=ce,!ce.__f)){var i=function(a,l,d){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(m){return!!m.__c});if(f.every(function(m){return!m.__N}))return!s||s.call(this,a,l,d);var p=r.__c.props!==a;return f.forEach(function(m){if(m.__N){var v=m.__[0];m.__=m.__N,m.__N=void 0,v!==m.__[0]&&(p=!0)}}),s&&s.call(this,a,l,d)||p};ce.__f=!0;var s=ce.shouldComponentUpdate,o=ce.componentWillUpdate;ce.componentWillUpdate=function(a,l,d){if(this.__e){var f=s;s=void 0,i(a,l,d),s=f}o&&o.call(this,a,l,d)},ce.shouldComponentUpdate=i}return r.__N||r.__}function Ae(t,e){var n=vn(Ct++,3);!pe.__s&&dr(n.__H,e)&&(n.__=t,n.u=e,ce.__H.__h.push(n))}function Mo(t,e){var n=vn(Ct++,4);!pe.__s&&dr(n.__H,e)&&(n.__=t,n.u=e,ce.__h.push(n))}function yt(t){return Zt=5,qt(function(){return{current:t}},[])}function qt(t,e){var n=vn(Ct++,7);return dr(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function ct(t,e){return Zt=8,qt(function(){return t},e)}function $o(){for(var t;t=Ai.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(bn),t.__H.__h.forEach(lr),t.__H.__h=[]}catch(e){t.__H.__h=[],pe.__e(e,t.__v)}}pe.__b=function(t){ce=null,Ci&&Ci(t)},pe.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),$i&&$i(t,e)},pe.__r=function(t){ji&&ji(t),Ct=0;var e=(ce=t.__c).__H;e&&(ur===ce?(e.__h=[],ce.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(bn),e.__h.forEach(lr),e.__h=[],Ct=0)),ur=ce},pe.diffed=function(t){Ri&&Ri(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ai.push(e)!==1&&Ii===pe.requestAnimationFrame||((Ii=pe.requestAnimationFrame)||Uo)($o)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ur=ce=null},pe.__c=function(t,e){e.some(function(n){try{n.__h.forEach(bn),n.__h=n.__h.filter(function(r){return!r.__||lr(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],pe.__e(r,n.__v)}}),Pi&&Pi(t,e)},pe.unmount=function(t){Mi&&Mi(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{bn(r)}catch(i){e=i}}),n.__H=void 0,e&&pe.__e(e,n.__v))};var Ui=typeof requestAnimationFrame=="function";function Uo(t){var e,n=function(){clearTimeout(r),Ui&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Ui&&(e=requestAnimationFrame(n))}function bn(t){var e=ce,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ce=e}function lr(t){var e=ce;t.__c=t.__(),ce=e}function dr(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Ni(t,e){return typeof e=="function"?e(t):e}function Te(t){if(typeof t=="number")return(Math.abs(t*2654435761)>>>0).toString(16);if(typeof t=="boolean")return t?"1":"0";if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string"){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24),e=e>>>0;return e.toString(16)}if(Array.isArray(t)){let e=2166136261;for(let n=0;n<t.length;n++){e^=(n+1)*2654435761;const r=Te(t[n]);for(let i=0;i<r.length;i++)e^=r.charCodeAt(i),e*=16777619,e=e>>>0}return e.toString(16)}if(typeof t=="object"){let e=2166136261;const n=Object.keys(t).sort();for(let r=0;r<n.length;r++){const i=n[r],s=Te(i);e^=parseInt(s,16),e*=16777619,e=e>>>0;const o=Te(t[i]);e^=parseInt(o,16),e*=16777619,e=e>>>0}return e.toString(16)}return Te(String(t))}const _e={Remove:"remove",Replace:"replace",Add:"add"},Bi=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),No=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),wn=Symbol.iterator,Ce={mutable:"mutable",immutable:"immutable"},fr={};function Vt(t,e){return t instanceof Map?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Di(t,e){if(e in t){let n=Reflect.getPrototypeOf(t);for(;n;){const r=Reflect.getOwnPropertyDescriptor(n,e);if(r)return r;n=Reflect.getPrototypeOf(n)}}}function hr(t){return Object.getPrototypeOf(t)===Set.prototype}function pr(t){return Object.getPrototypeOf(t)===Map.prototype}function je(t){var e;return(e=t.copy)!==null&&e!==void 0?e:t.original}function mt(t){return!!H(t)}function H(t){return typeof t!="object"?null:t==null?void 0:t[Bi]}function _r(t){var e;const n=H(t);return n?(e=n.copy)!==null&&e!==void 0?e:n.original:t}function De(t,e){if(!t||typeof t!="object")return!1;let n;return Object.getPrototypeOf(t)===Object.prototype||Array.isArray(t)||t instanceof Map||t instanceof Set||!!(e!=null&&e.mark)&&((n=e.mark(t,Ce))===Ce.immutable||typeof n=="function")}function Li(t,e=[]){if(Object.hasOwnProperty.call(t,"key")){const n=t.parent.copy,r=H(nt(n,t.key));if(r!==null&&(r==null?void 0:r.original)!==t.original)return null;const i=t.parent.type===3,s=i?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(i&&n.size>s||Vt(n,s)))return null;e.push(s)}if(t.parent)return Li(t.parent,e);e.reverse();try{Bo(t.copy,e)}catch{return null}return e}function gt(t){return Array.isArray(t)?1:t instanceof Map?2:t instanceof Set?3:0}function nt(t,e){return gt(t)===2?t.get(e):t[e]}function zt(t,e,n){gt(t)===2?t.set(e,n):t[e]=n}function yr(t,e){const n=H(t);return(n?je(n):t)[e]}function rt(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function mr(t){if(t)for(;t.finalities.revoke.length>0;)t.finalities.revoke.pop()()}function vt(t,e){return e?t:[""].concat(t).map(n=>{const r=`${n}`;return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}function Bo(t,e){for(let n=0;n<e.length-1;n+=1){const r=e[n];if(t=nt(gt(t)===3?Array.from(t):t,r),typeof t!="object")throw new Error(`Cannot resolve patch at '${e.join("/")}'.`)}return t}function Do(t){const e=Object.create(Object.getPrototypeOf(t));return Reflect.ownKeys(t).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(t,n);if(r.enumerable&&r.configurable&&r.writable){e[n]=t[n];return}r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:t[n]}),Reflect.defineProperty(e,n,r)}),e}const Lo=Object.prototype.propertyIsEnumerable;function Fi(t,e){let n;if(Array.isArray(t))return Array.prototype.concat.call(t);if(t instanceof Set){if(!hr(t)){const r=Object.getPrototypeOf(t).constructor;return new r(t.values())}return Set.prototype.difference?Set.prototype.difference.call(t,new Set):new Set(t.values())}else if(t instanceof Map){if(!pr(t)){const r=Object.getPrototypeOf(t).constructor;return new r(t)}return new Map(t)}else if(e!=null&&e.mark&&(n=e.mark(t,Ce),n!==void 0)&&n!==Ce.mutable){if(n===Ce.immutable)return Do(t);if(typeof n=="function"){if(e.enablePatches||e.enableAutoFreeze)throw new Error("You can't use mark and patches or auto freeze together.");return n()}throw new Error(`Unsupported mark result: ${n}`)}else if(typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype){const r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),Object.getOwnPropertySymbols(t).forEach(i=>{Lo.call(t,i)&&(r[i]=t[i])}),r}else throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function Se(t){t.copy||(t.copy=Fi(t.original,t.options))}function Wt(t){if(!De(t))return _r(t);if(Array.isArray(t))return t.map(Wt);if(t instanceof Map){const n=Array.from(t.entries()).map(([r,i])=>[r,Wt(i)]);if(!pr(t)){const r=Object.getPrototypeOf(t).constructor;return new r(n)}return new Map(n)}if(t instanceof Set){const n=Array.from(t).map(Wt);if(!hr(t)){const r=Object.getPrototypeOf(t).constructor;return new r(n)}return new Set(n)}const e=Object.create(Object.getPrototypeOf(t));for(const n in t)e[n]=Wt(t[n]);return e}function xn(t){return mt(t)?Wt(t):t}function Ke(t){var e;t.assignedMap=(e=t.assignedMap)!==null&&e!==void 0?e:new Map,t.operated||(t.operated=!0,t.parent&&Ke(t.parent))}function Zi(){throw new Error("Cannot modify frozen object")}function jt(t,e,n,r,i){{n=n??new WeakMap,r=r??[],i=i??[];const o=n.has(t)?n.get(t):t;if(r.length>0){const a=r.indexOf(o);if(o&&typeof o=="object"&&a!==-1)throw r[0]===o?new Error("Forbids circular reference"):new Error(`Forbids circular reference: ~/${i.slice(0,a).map((l,d)=>{if(typeof l=="symbol")return`[${l.toString()}]`;const f=r[d];return typeof l=="object"&&(f instanceof Map||f instanceof Set)?Array.from(f.keys()).indexOf(l):l}).join("/")}`);r.push(o),i.push(e)}else r.push(o)}if(Object.isFrozen(t)||mt(t)){r.pop(),i.pop();return}switch(gt(t)){case 2:for(const[a,l]of t)jt(a,a,n,r,i),jt(l,a,n,r,i);t.set=t.clear=t.delete=Zi;break;case 3:for(const a of t)jt(a,a,n,r,i);t.add=t.clear=t.delete=Zi;break;case 1:Object.freeze(t);let o=0;for(const a of t)jt(a,o,n,r,i),o+=1;break;default:Object.freeze(t),Object.keys(t).forEach(a=>{const l=t[a];jt(l,a,n,r,i)})}r.pop(),i.pop()}function gr(t,e){const n=gt(t);if(n===0)Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)});else if(n===1){let r=0;for(const i of t)e(r,i,t),r+=1}else t.forEach((r,i)=>e(i,r,t))}function qi(t,e,n){if(mt(t)||!De(t,n)||e.has(t)||Object.isFrozen(t))return;const r=t instanceof Set,i=r?new Map:void 0;if(e.add(t),gr(t,(s,o)=>{var a;if(mt(o)){const l=H(o);Se(l);const d=!((a=l.assignedMap)===null||a===void 0)&&a.size||l.operated?l.copy:l.original;zt(r?i:t,s,d)}else qi(o,e,n)}),i){const s=t,o=Array.from(s);s.clear(),o.forEach(a=>{s.add(i.has(a)?i.get(a):a)})}}function Fo(t,e){const n=t.type===3?t.setMap:t.copy;t.finalities.revoke.length>1&&t.assignedMap.get(e)&&n&&qi(nt(n,e),t.finalities.handledSet,t.options)}function vr(t){t.type===3&&t.copy&&(t.copy.clear(),t.setMap.forEach(e=>{t.copy.add(_r(e))}))}function br(t,e,n,r){if(t.operated&&t.assignedMap&&t.assignedMap.size>0&&!t.finalized){if(n&&r){const s=Li(t);s&&e(t,s,n,r)}t.finalized=!0}}function wr(t,e,n,r){const i=H(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((s,o)=>{var a;const l=t.type===3?t.setMap:t.copy;if(rt(nt(l,e),n)){let d=i.original;i.copy&&(d=i.copy),vr(t),br(t,r,s,o),t.options.enableAutoFreeze&&(t.options.updatedValues=(a=t.options.updatedValues)!==null&&a!==void 0?a:new WeakMap,t.options.updatedValues.set(d,i.original)),zt(l,e,d)}}),t.options.enableAutoFreeze&&i.finalities!==t.finalities&&(t.options.enableAutoFreeze=!1)),De(n,t.options)&&t.finalities.draft.push(()=>{const s=t.type===3?t.setMap:t.copy;rt(nt(s,e),n)&&Fo(t,e)})}function Zo(t,e,n,r,i){let{original:s,assignedMap:o,options:a}=t,l=t.copy;l.length<s.length&&([s,l]=[l,s],[n,r]=[r,n]);for(let d=0;d<s.length;d+=1)if(o.get(d.toString())&&l[d]!==s[d]){const f=e.concat([d]),p=vt(f,i);n.push({op:_e.Replace,path:p,value:xn(l[d])}),r.push({op:_e.Replace,path:p,value:xn(s[d])})}for(let d=s.length;d<l.length;d+=1){const f=e.concat([d]),p=vt(f,i);n.push({op:_e.Add,path:p,value:xn(l[d])})}if(s.length<l.length){const{arrayLengthAssignment:d=!0}=a.enablePatches;if(d){const f=e.concat(["length"]),p=vt(f,i);r.push({op:_e.Replace,path:p,value:s.length})}else for(let f=l.length;s.length<f;f-=1){const p=e.concat([f-1]),m=vt(p,i);r.push({op:_e.Remove,path:m})}}}function qo({original:t,copy:e,assignedMap:n},r,i,s,o){n.forEach((a,l)=>{const d=nt(t,l),f=xn(nt(e,l)),p=a?Vt(t,l)?_e.Replace:_e.Add:_e.Remove;if(rt(d,f)&&p===_e.Replace)return;const m=r.concat(l),v=vt(m,o);i.push(p===_e.Remove?{op:p,path:v}:{op:p,path:v,value:f}),s.push(p===_e.Add?{op:_e.Remove,path:v}:p===_e.Remove?{op:_e.Add,path:v,value:d}:{op:_e.Replace,path:v,value:d})})}function Vo({original:t,copy:e},n,r,i,s){let o=0;t.forEach(a=>{if(!e.has(a)){const l=n.concat([o]),d=vt(l,s);r.push({op:_e.Remove,path:d,value:a}),i.unshift({op:_e.Add,path:d,value:a})}o+=1}),o=0,e.forEach(a=>{if(!t.has(a)){const l=n.concat([o]),d=vt(l,s);r.push({op:_e.Add,path:d,value:a}),i.unshift({op:_e.Remove,path:d,value:a})}o+=1})}function Kt(t,e,n,r){const{pathAsArray:i=!0}=t.options.enablePatches;switch(t.type){case 0:case 2:return qo(t,e,n,r,i);case 1:return Zo(t,e,n,r,i);case 3:return Vo(t,e,n,r,i)}}const Sn=(t,e,n=!1)=>{if(typeof t=="object"&&t!==null&&(!De(t,e)||n))throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},xr={get size(){return je(H(this)).size},has(t){return je(H(this)).has(t)},set(t,e){const n=H(this),r=je(n);return(!r.has(t)||!rt(r.get(t),e))&&(Se(n),Ke(n),n.assignedMap.set(t,!0),n.copy.set(t,e),wr(n,t,e,Kt)),this},delete(t){if(!this.has(t))return!1;const e=H(this);return Se(e),Ke(e),e.original.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.copy.delete(t),!0},clear(){const t=H(this);if(this.size){Se(t),Ke(t),t.assignedMap=new Map;for(const[e]of t.original)t.assignedMap.set(e,!1);t.copy.clear()}},forEach(t,e){const n=H(this);je(n).forEach((r,i)=>{t.call(e,this.get(i),i,this)})},get(t){var e,n;const r=H(this),i=je(r).get(t),s=((n=(e=r.options).mark)===null||n===void 0?void 0:n.call(e,i,Ce))===Ce.mutable;if(r.options.strict&&Sn(i,r.options,s),s||r.finalized||!De(i,r.options)||i!==r.original.get(t))return i;const o=fr.createDraft({original:i,parentDraft:r,key:t,finalities:r.finalities,options:r.options});return Se(r),r.copy.set(t,o),o},keys(){return je(H(this)).keys()},values(){const t=this.keys();return{[wn]:()=>this.values(),next:()=>{const e=t.next();return e.done?e:{done:!1,value:this.get(e.value)}}}},entries(){const t=this.keys();return{[wn]:()=>this.entries(),next:()=>{const e=t.next();if(e.done)return e;const n=this.get(e.value);return{done:!1,value:[e.value,n]}}}},[wn](){return this.entries()}},zo=Reflect.ownKeys(xr),Vi=(t,e,{isValuesIterator:n})=>()=>{var r,i;const s=e.next();if(s.done)return s;const o=s.value;let a=t.setMap.get(o);const l=H(a),d=((i=(r=t.options).mark)===null||i===void 0?void 0:i.call(r,a,Ce))===Ce.mutable;if(t.options.strict&&Sn(o,t.options,d),!d&&!l&&De(o,t.options)&&!t.finalized&&t.original.has(o)){const f=fr.createDraft({original:o,parentDraft:t,key:o,finalities:t.finalities,options:t.options});t.setMap.set(o,f),a=f}else l&&(a=l.proxy);return{done:!1,value:n?a:[a,a]}},kn={get size(){return H(this).setMap.size},has(t){const e=H(this);if(e.setMap.has(t))return!0;Se(e);const n=H(t);return!!(n&&e.setMap.has(n.original))},add(t){const e=H(this);return this.has(t)||(Se(e),Ke(e),e.assignedMap.set(t,!0),e.setMap.set(t,t),wr(e,t,t,Kt)),this},delete(t){if(!this.has(t))return!1;const e=H(this);Se(e),Ke(e);const n=H(t);return n&&e.setMap.has(n.original)?(e.assignedMap.set(n.original,!1),e.setMap.delete(n.original)):(!n&&e.setMap.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.setMap.delete(t))},clear(){if(!this.size)return;const t=H(this);Se(t),Ke(t);for(const e of t.original)t.assignedMap.set(e,!1);t.setMap.clear()},values(){const t=H(this);Se(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:Vi(t,e,{isValuesIterator:!0})}},entries(){const t=H(this);Se(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:Vi(t,e,{isValuesIterator:!1})}},keys(){return this.values()},[wn](){return this.values()},forEach(t,e){const n=this.values();let r=n.next();for(;!r.done;)t.call(e,r.value,r.value,this),r=n.next()}};Set.prototype.difference&&Object.assign(kn,{intersection(t){return Set.prototype.intersection.call(new Set(this.values()),t)},union(t){return Set.prototype.union.call(new Set(this.values()),t)},difference(t){return Set.prototype.difference.call(new Set(this.values()),t)},symmetricDifference(t){return Set.prototype.symmetricDifference.call(new Set(this.values()),t)},isSubsetOf(t){return Set.prototype.isSubsetOf.call(new Set(this.values()),t)},isSupersetOf(t){return Set.prototype.isSupersetOf.call(new Set(this.values()),t)},isDisjointFrom(t){return Set.prototype.isDisjointFrom.call(new Set(this.values()),t)}});const Wo=Reflect.ownKeys(kn),zi=new WeakSet,Wi={get(t,e,n){var r,i;const s=(r=t.copy)===null||r===void 0?void 0:r[e];if(s&&zi.has(s))return s;if(e===Bi)return t;let o;if(t.options.mark){const d=e==="size"&&(t.original instanceof Map||t.original instanceof Set)?Reflect.get(t.original,e):Reflect.get(t.original,e,n);if(o=t.options.mark(d,Ce),o===Ce.mutable)return t.options.strict&&Sn(d,t.options,!0),d}const a=je(t);if(a instanceof Map&&zo.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(xr,"size").get.call(t.proxy);const d=xr[e];if(d)return d.bind(t.proxy)}if(a instanceof Set&&Wo.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(kn,"size").get.call(t.proxy);const d=kn[e];if(d)return d.bind(t.proxy)}if(!Vt(a,e)){const d=Di(a,e);return d?"value"in d?d.value:(i=d.get)===null||i===void 0?void 0:i.call(t.proxy):void 0}const l=a[e];if(t.options.strict&&Sn(l,t.options),t.finalized||!De(l,t.options))return l;if(l===yr(t.original,e)){if(Se(t),t.copy[e]=Sr({original:t.original[e],parentDraft:t,key:t.type===1?Number(e):e,finalities:t.finalities,options:t.options}),typeof o=="function"){const d=H(t.copy[e]);return Se(d),Ke(d),d.copy}return t.copy[e]}return l},set(t,e,n){var r;if(t.type===3||t.type===2)throw new Error("Map/Set draft does not support any property assignment.");let i;if(t.type===1&&e!=="length"&&!(Number.isInteger(i=Number(e))&&i>=0&&(e===0||i===0||String(i)===String(e))))throw new Error("Only supports setting array indices and the 'length' property.");const s=Di(je(t),e);if(s!=null&&s.set)return s.set.call(t.proxy,n),!0;const o=yr(je(t),e),a=H(o);return a&&rt(a.original,n)?(t.copy[e]=n,t.assignedMap=(r=t.assignedMap)!==null&&r!==void 0?r:new Map,t.assignedMap.set(e,!1),!0):(rt(n,o)&&(n!==void 0||Vt(t.original,e))||(Se(t),Ke(t),Vt(t.original,e)&&rt(n,t.original[e])?t.assignedMap.delete(e):t.assignedMap.set(e,!0),t.copy[e]=n,wr(t,e,n,Kt)),!0)},has(t,e){return e in je(t)},ownKeys(t){return Reflect.ownKeys(je(t))},getOwnPropertyDescriptor(t,e){const n=je(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},getPrototypeOf(t){return Reflect.getPrototypeOf(t.original)},setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(t,e){var n;return t.type===1?Wi.set.call(this,t,e,void 0,t.proxy):(yr(t.original,e)!==void 0||e in t.original?(Se(t),Ke(t),t.assignedMap.set(e,!1)):(t.assignedMap=(n=t.assignedMap)!==null&&n!==void 0?n:new Map,t.assignedMap.delete(e)),t.copy&&delete t.copy[e],!0)}};function Sr(t){const{original:e,parentDraft:n,key:r,finalities:i,options:s}=t,o=gt(e),a={type:o,finalized:!1,parent:n,original:e,copy:null,proxy:null,finalities:i,options:s,setMap:o===3?new Map(e.entries()):void 0};(r||"key"in t)&&(a.key=r);const{proxy:l,revoke:d}=Proxy.revocable(o===1?Object.assign([],a):a,Wi);if(i.revoke.push(d),zi.add(l),a.proxy=l,n){const f=n;f.finalities.draft.push((p,m)=>{var v,S;const T=H(l);let R=f.type===3?f.setMap:f.copy;const E=nt(R,r),w=H(E);if(w){let k=w.original;w.operated&&(k=_r(E)),vr(w),br(w,Kt,p,m),f.options.enableAutoFreeze&&(f.options.updatedValues=(v=f.options.updatedValues)!==null&&v!==void 0?v:new WeakMap,f.options.updatedValues.set(k,w.original)),zt(R,r,k)}(S=T.callbacks)===null||S===void 0||S.forEach(k=>{k(p,m)})})}else{const f=H(l);f.finalities.draft.push((p,m)=>{vr(f),br(f,Kt,p,m)})}return l}fr.createDraft=Sr;function Ko(t,e,n,r,i){var s;const o=H(t),a=(s=o==null?void 0:o.original)!==null&&s!==void 0?s:t,l=!!e.length;if(o!=null&&o.operated)for(;o.finalities.draft.length>0;)o.finalities.draft.pop()(n,r);const d=l?e[0]:o?o.operated?o.copy:o.original:t;return o&&mr(o),i&&jt(d,d,o==null?void 0:o.options.updatedValues),[d,n&&l?[{op:_e.Replace,path:[],value:e[0]}]:n,r&&l?[{op:_e.Replace,path:[],value:a}]:r]}function Ho(t,e){var n;const r={draft:[],revoke:[],handledSet:new WeakSet};let i,s;e.enablePatches&&(i=[],s=[]);const a=((n=e.mark)===null||n===void 0?void 0:n.call(e,t,Ce))===Ce.mutable||!De(t,e)?t:Sr({original:t,parentDraft:null,finalities:r,options:e});return[a,(l=[])=>{const[d,f,p]=Ko(a,l,i,s,e.enableAutoFreeze);return e.enablePatches?[d,f,p]:d}]}function kr(t){const{rootDraft:e,value:n,useRawReturn:r=!1,isRoot:i=!0}=t;gr(n,(s,o,a)=>{const l=H(o);if(l&&e&&l.finalities===e.finalities){t.isContainDraft=!0;const d=l.original;if(a instanceof Set){const f=Array.from(a);a.clear(),f.forEach(p=>a.add(s===p?d:p))}else zt(a,s,d)}else typeof o=="object"&&o!==null&&(t.value=o,t.isRoot=!1,kr(t))}),i&&(t.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function Ki(t){var e;const n=H(t);if(!De(t,n==null?void 0:n.options))return t;const r=gt(t);if(n&&!n.operated)return n.original;let i;function s(){i=r===2?pr(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):r===3?Array.from(n.setMap.values()):Fi(t,n==null?void 0:n.options)}if(n){n.finalized=!0;try{s()}finally{n.finalized=!1}}else i=t;if(gr(i,(o,a)=>{if(n&&rt(nt(n.original,o),a))return;const l=Ki(a);l!==a&&(i===t&&s(),zt(i,o,l))}),r===3){const o=(e=n==null?void 0:n.original)!==null&&e!==void 0?e:i;return hr(o)?new Set(i):new(Object.getPrototypeOf(o)).constructor(i)}return i}function Hi(t){if(!mt(t))throw new Error(`current() is only used for Draft, parameter: ${t}`);return Ki(t)}const Or=(t=>function e(n,r,i){var s,o,a;if(typeof n=="function"&&typeof r!="function")return function(M,...W){return e(M,X=>n.call(this,X,...W),r)};const l=n,d=r;let f=i;if(typeof r!="function"&&(f=r),f!==void 0&&Object.prototype.toString.call(f)!=="[object Object]")throw new Error(`Invalid options: ${f}, 'options' should be an object.`);f=Object.assign(Object.assign({},t),f);const p=mt(l)?Hi(l):l,m=Array.isArray(f.mark)?(M,W)=>{for(const X of f.mark){if(typeof X!="function")throw new Error(`Invalid mark: ${X}, 'mark' should be a function.`);const ne=X(M,W);if(ne)return ne}}:f.mark,v=(s=f.enablePatches)!==null&&s!==void 0?s:!1,S=(o=f.strict)!==null&&o!==void 0?o:!1,R={enableAutoFreeze:(a=f.enableAutoFreeze)!==null&&a!==void 0?a:!1,mark:m,strict:S,enablePatches:v};if(!De(p,R)&&typeof p=="object"&&p!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");const[E,w]=Ho(p,R);if(typeof r!="function"){if(!De(p,R))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,w]}let k;try{k=d(E)}catch(M){throw mr(H(E)),M}const P=M=>{const W=H(E);if(!mt(M)){if(M!==void 0&&!rt(M,E)&&(W!=null&&W.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");const ne=M==null?void 0:M[No];if(ne){const Q=ne[0];return R.strict&&typeof M=="object"&&M!==null&&kr({rootDraft:W,value:M,useRawReturn:!0}),w([Q])}if(M!==void 0)return typeof M=="object"&&M!==null&&kr({rootDraft:W,value:M}),w([M])}if(M===E||M===void 0)return w([]);const X=H(M);if(R===X.options){if(X.operated)throw new Error("Cannot return a modified child draft.");return w([Hi(M)])}return w([M])};return k instanceof Promise?k.then(P,M=>{throw mr(H(E)),M}):P(k)})();Object.prototype.constructor.toString();function Ji(t,e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&Object.keys(t).every(i=>e.hasOwnProperty(i))}function Qi(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(n=>e.hasOwnProperty(n)&&t[n]===e[n])}function On(t,e){return typeof t!="object"||typeof e!="object"||t===null||e===null?t===e:Ji(t,e)?Object.keys(t).every(n=>On(t[n],e[n])):!1}function Gi(t){if(!Ht(t))return t;const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=r);return e}function Yi(t,e){if(!Ht(t)||!Ht(e))return e;const n=Object.assign({},t);for(const r of Object.keys(e)){if(e[r]===void 0)continue;if(e[r]===null){delete n[r];continue}const i=Ht(t[r])&&Ht(e[r]);n[r]=i?Yi(t[r],e[r]):e[r]}return n}function Ht(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Jo(t,e,n){if(!t||e.length===0)return;let r=t||{};for(let s=0;s<e.length-1;s++){const o=e[s];(!(o in r)||typeof r[o]!="object")&&(r[o]=typeof e[s+1]=="number"?[]:{}),r=r[o]}const i=e[e.length-1];Array.isArray(r)&&typeof i=="number"?r.splice(i,0,n):r[i]=n}function Xi(t,e,n){if(!t||e.length===0)return;let r=t||{};for(let i=0;i<e.length-1;i++){const s=e[i];(!(s in r)||typeof r[s]!="object")&&(r[s]=typeof e[i+1]=="number"?[]:{}),r=r[s]}r[e[e.length-1]]=n}function es(t,e){if(!t||e.length===0)return;const[n,...r]=e;if(n in t){if(r.length===0){Array.isArray(t)?t.splice(n,1):delete t[n];return}es(t[n],r),Qo(t[n])&&delete t[n]}}function Qo(t){return t&&Object.keys(t).length===0}function Go(t){return t.cardinality==="one"}function Er(t){return t["value-type"]==="ref"}function Tr(t){return t["value-type"]==="blob"}function En(t,e){return t[e]}function Ir(t,e){return e.reduce((n,r)=>n&&n.get(r),t)}function Le(t,e){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.delete(e[0]);return}const[n,...r]=e;t.has(n)&&Le(t.get(n),r)}function Ie(t,e,n){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.set(e[0],n);return}const[r,...i]=e;let s=t.get(r);s||(s=new Map,t.set(r,s)),Ie(s,i,n)}function ts(t,e){const n=new Map,r=new Map,i=new Map;for(const s of e){const[o,a,l,d]=s,f=En(t,a);if(!f){console.warn("no such attr",o,t);continue}Er(f)&&Ie(i,[l,a,o],s),Ie(n,[o,a,l],s),Ie(r,[a,o,l],s)}return{eav:n,aev:r,vae:i}}function ns(t){const e=new Map,n=new Map,r=new Map,i=new Map;for(const s of Object.values(t)){const o=s["forward-identity"],[a,l,d]=o,f=s["reverse-identity"];if(Ie(r,[l,d],s),Tr(s)&&Ie(e,[l,d],s),s["primary?"]&&Ie(n,[l],s),f){const[p,m,v]=f;Ie(i,[m,v],s)}}return{blobAttrs:e,primaryKeys:n,forwardIdents:r,revIdents:i}}function Yo(t){return{__type:t.__type,attrs:t.attrs,triples:Re(t.eav,3),cardinalityInference:t.cardinalityInference,linkIndex:t.linkIndex}}function Xo(t){return Cr(t.attrs,t.triples,t.cardinalityInference,t.linkIndex)}function Ar(t){t.attrIndexes=ns(t.attrs)}function Cr(t,e,n,r){const i=ts(t,e);return i.attrs=t,i.attrIndexes=ns(t),i.cardinalityInference=n,i.linkIndex=r,i.__type="store",i}function Tn(t,e){var n,r;let i;if(Array.isArray(e[0])){const[o,a]=e[0],l=t.aev.get(o);if(!l)return null;i=(n=Re(l,2).find(f=>f[2]===a))===null||n===void 0?void 0:n[0]}else i=e[0];if(!i)return null;const s=e[2];if(Array.isArray(s)&&s.length===2&&t.aev.get(s[0])){const[o,a]=s,l=t.aev.get(o);if(!l)return null;const f=(r=Re(l,2).find(T=>T[2]===a))===null||r===void 0?void 0:r[0];if(!f)return null;const[p,m,v,...S]=e;return[i,m,f,...S]}else{const[o,...a]=e;return[i,...a]}}function ea(t,e){const n=Tn(t,e);if(!n)return;const[r,i,s]=n,o=En(t.attrs,i);o&&(Le(t.eav,[r,i,s]),Le(t.aev,[i,r,s]),Er(o)&&Le(t.vae,[s,i,r]))}let ta=0;function rs(t,e,n){const[r,i,s]=n;let o;const a=Ir(t.ea,[r,i,s]);return a&&(o=a[3]),o||Date.now()*10+ta++}function na(t,e){var n;const r=Tn(t,e);if(!r)return;const[i,s,o]=r,a=En(t.attrs,s);if(!a)return;const l=Ir(t.eav,[i,s,o]),d=(n=l==null?void 0:l[3])!==null&&n!==void 0?n:rs(t,a,r),f=[i,s,o,d];Go(a)?(Ie(t.eav,[i,s],new Map([[o,f]])),Ie(t.aev,[s,i],new Map([[o,f]]))):(Ie(t.eav,[i,s,o],f),Ie(t.aev,[s,i,o],f)),Er(a)&&Ie(t.vae,[o,s,i],f)}function ra(t,e){var n;const r=Tn(t,e);if(!r)return;const[i,s,o]=r,a=En(t.attrs,s);if(!a)return;if(!Tr(a))throw new Error("merge operation is not supported for links");const l=Ir(t.eav,[i,s]);if(!l)return;const d=(n=l.values().next())===null||n===void 0?void 0:n.value;if(!d)return;const f=d[2],p=Yi(f,o),m=[i,s,p,rs(t,a,d)];Ie(t.eav,[i,s],new Map([[p,m]]))}function jr(t,e){var n,r;const[i,s]=e,o=Tn(t,[i]);if(!o)return;const[a]=o,l=t.eav.get(a);if(l){for(const f of l.keys()){const p=t.attrs[f];p&&p["on-delete-reverse"]==="cascade"&&Re(l.get(f),1).forEach(([m,v,S])=>{var T;return jr(t,[S,(T=p["reverse-identity"])===null||T===void 0?void 0:T[1]])}),(!s||!p||((n=p["forward-identity"])===null||n===void 0?void 0:n[1])===s)&&(Le(t.aev,[f,a]),Le(t.eav,[a,f]))}l.size===0&&Le(t.eav,[a])}const d=t.vae.get(a)&&Re(t.vae.get(a),2);d&&d.forEach(f=>{var p,m;const[v,S,T]=f,R=t.attrs[S];(!s||!R||((p=R["reverse-identity"])===null||p===void 0?void 0:p[1])===s)&&(Le(t.eav,[v,S,T]),Le(t.aev,[S,v,T]),Le(t.vae,[T,S,v])),R&&R["on-delete"]==="cascade"&&jr(t,[v,(m=R["forward-identity"])===null||m===void 0?void 0:m[1]])}),((r=t.vae.get(a))===null||r===void 0?void 0:r.size)===0&&Le(t.vae,[a])}function is(t,e){const n=ts(t.attrs,e);Object.keys(n).forEach(r=>{t[r]=n[r]})}function ia(t,[e]){t.attrs[e.id]=e,Ar(t)}function ss(t){return Re(t.eav,3)}function sa(t,[e]){if(!t.attrs[e])return;const n=ss(t).filter(([r,i])=>i!==e);delete t.attrs[e],Ar(t),is(t,n)}function oa(t,[e]){const n=t.attrs[e.id];n&&(t.attrs[e.id]=Object.assign(Object.assign({},n),e),Ar(t),is(t,ss(t)))}function aa(t,e){const[n,...r]=e;switch(n){case"add-triple":na(t,r);break;case"deep-merge-triple":ra(t,r);break;case"retract-triple":ea(t,r);break;case"delete-entity":jr(t,r);break;case"add-attr":ia(t,r);break;case"delete-attr":sa(t,r);break;case"update-attr":oa(t,r);break;case"rule-params":break;default:throw new Error(`unhandled transaction action: ${n}`)}}function Re(t,e,n=[]){if(!t||e===0)return n;if(e===1){for(const r of t.values())n.push(r);return n}for(const r of t.values())Re(r,e-1,n);return n}function In(t,e,n){var r,i;const s=[];if(n!=null&&n.hasOwnProperty("$not")){for(const a of e.keys())n.$not!==a&&s.push(e.get(a));return s}if(n!=null&&n.hasOwnProperty("$isNull")){const{attrId:a,isNull:l,reverse:d}=n.$isNull;if(d)for(const f of e.keys()){const p=t.vae.get(f),m=!p||((r=p.get(a))===null||r===void 0?void 0:r.get(null))||!p.get(a);(l?m:!m)&&s.push(e.get(f))}else{const f=t.aev.get(a);for(const p of e.keys()){const m=!f||((i=f.get(p))===null||i===void 0?void 0:i.get(null))||!f.get(p);(l?m:!m)&&s.push(e.get(p))}}return s}if(n!=null&&n.$comparator)return Re(e,1).filter(n.$op);const o=n.in||n.$in||[n];for(const a of o){const l=e.get(a);l&&s.push(l)}return s}function ca(t,e,n){let r="";return t!==void 0&&(r+="e"),e!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function ua(t,[e,n,r]){var i,s;switch(ca(e,n,r)){case"e":{const a=t.eav.get(e);return Re(a,2)}case"ea":{const a=(i=t.eav.get(e))===null||i===void 0?void 0:i.get(n);return Re(a,1)}case"eav":{const a=(s=t.eav.get(e))===null||s===void 0?void 0:s.get(n);return a?In(t,a,r):[]}case"ev":{const a=t.eav.get(e);if(!a)return[];const l=[];for(const d of a.values())l.push(...In(t,d,r));return l}case"a":{const a=t.aev.get(n);return Re(a,2)}case"av":{const a=t.aev.get(n);if(!a)return[];const l=[];for(const d of a.values())l.push(...In(t,d,r));return l}case"v":{const a=[];for(const l of t.eav.values())for(const d of l.values())a.push(...In(t,d,r))}default:return Re(t.eav,3)}}function la(t,e,n){var r;const i={};for(const[s,o]of e.entries()){const a=(r=t.eav.get(n))===null||r===void 0?void 0:r.get(o.id),l=Re(a,1);for(const d of l)i[s]=d[2]}return i}function Rt(t,e,n){var r;return(r=t.attrIndexes.forwardIdents.get(e))===null||r===void 0?void 0:r.get(n)}function os(t,e,n){var r;return(r=t.attrIndexes.revIdents.get(e))===null||r===void 0?void 0:r.get(n)}function da(t,e){return t.attrIndexes.blobAttrs.get(e)}function fa(t,e){var n;const r=t.attrIndexes.primaryKeys.get(e);return r||((n=t.attrIndexes.forwardIdents.get(e))===null||n===void 0?void 0:n.get("id"))}function as(t,e){return Or(t,n=>{e.forEach(r=>{aa(n,r)})})}function ha(t){return typeof t=="string"&&t.startsWith("?")}function pa(t,e,n){if(n.hasOwnProperty(t)){const r=n[t];return us(r,e,n)}return Object.assign(Object.assign({},n),{[t]:e})}function cs(t,e,n){return t===e?n:null}function _a(t){switch(typeof t){case"string":return t.startsWith("?")?pa:cs;default:return cs}}const ya=["in","$in","$not","$isNull","$comparator"];function ma(t){for(const e of ya)if(t.hasOwnProperty(e))return!0;return!1}function us(t,e,n){return n?typeof t=="object"?ma(t)?n:null:_a(t)(t,e,n):null}function ga(t,e,n){return t.reduce((r,i,s)=>{const o=e[s];return us(i,o,r)},n)}function va(t,e,n){return xa(t,e,n).map(r=>ga(e,r,n)).filter(r=>r)}function ba(t,e,n){return e.or?e.or.patterns.flatMap(r=>Rr(t,r,n)):e.and?e.and.patterns.reduce((r,i)=>Rr(t,i,r),n):n.flatMap(r=>va(t,e,r))}function Rr(t,e,n=[{}]){return e.reduce((r,i)=>ba(t,i,r),n)}function Pr(t,e){return Array.isArray(e)?e.map(n=>Pr(t,n)):ha(e)?t[e]:e}function wa(t,{find:e,where:n}){return Rr(t,n).map(i=>Pr(i,e))}function xa(t,e,n){return ua(t,Pr(n,e))}let An;const Sa=new Uint8Array(16);function ka(){if(!An&&(An=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!An))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return An(Sa)}const ve=[];for(let t=0;t<256;++t)ve.push((t+256).toString(16).slice(1));function Oa(t,e=0){return ve[t[e+0]]+ve[t[e+1]]+ve[t[e+2]]+ve[t[e+3]]+"-"+ve[t[e+4]]+ve[t[e+5]]+"-"+ve[t[e+6]]+ve[t[e+7]]+"-"+ve[t[e+8]]+ve[t[e+9]]+"-"+ve[t[e+10]]+ve[t[e+11]]+ve[t[e+12]]+ve[t[e+13]]+ve[t[e+14]]+ve[t[e+15]]}const ls={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ea(t,e,n){if(ls.randomUUID&&!t)return ls.randomUUID();t=t||{};const r=t.random||(t.rng||ka)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Oa(r)}function ds(t){const e=t.replace(/-/g,""),n=[];for(let r=0;r<e.length;r+=2)n.push(parseInt(e.substring(r,r+2),16));return n}function Ta(t,e){for(let n=0;n<t.length;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return 0}function Ia(t,e){return Ta(ds(t),ds(e))}function we(){return Ea()}let Aa=0;function Jt(t){return Cn(`_${t}`,Aa++)}function Cn(t,e){return`?${t}-${e}`}class Pt extends Error{constructor(e){super(e),this.name="AttrNotFoundError"}}function Ca(t,e){const n=fa(t,e);if(!n)throw new Pt(`Could not find id attr for ${e}`);return n}function fs(t,e,n,r){return[ja(t,e,n,r)]}function ja(t,e,n,r){return[t(n,r),Ca(e,n).id,t(n,r),t("time",r)]}function Ra(t,e,n){return t.map(r=>r===e?n:r)}function hs(t,e,n,r,i){const s=Rt(e,n,i),o=os(e,n,i),a=s||o;if(!a)throw new Pt(`Could not find attr for ${[n,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[l,d]=a["forward-identity"],[f,p]=a["reverse-identity"],m=r+1,v=s?[t(d,r),a.id,t(p,m),Jt("time")]:[t(d,m),a.id,t(p,r),Jt("time")];return[s?p:d,m,v,a,!!s]}function ps(t,e){if(typeof e!="string")return function(o){return!1};const r=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,"."),i=new RegExp(`^${r}$`,t?void 0:"i");return function(o){return typeof o!="string"?!1:i.test(o)}}function Pa(t,e){if(typeof e!="object"||e.hasOwnProperty("$in")||e.hasOwnProperty("in"))return e;const n=t["checked-data-type"]==="date";if(e.hasOwnProperty("$gt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>new Date(e.$gt)}:function(i){return i[2]>e.$gt}};if(e.hasOwnProperty("$gte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>=new Date(e.$gte)}:function(i){return i[2]>=e.$gte}};if(e.hasOwnProperty("$lt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<new Date(e.$lt)}:function(i){return i[2]<e.$lt}};if(e.hasOwnProperty("$lte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<=new Date(e.$lte)}:function(i){return i[2]<=e.$lte}};if(e.hasOwnProperty("$like")){const r=ps(!0,e.$like);return{$comparator:!0,$op:function(s){return r(s[2])}}}if(e.hasOwnProperty("$ilike")){const r=ps(!1,e.$ilike);return{$comparator:!0,$op:function(s){return r(s[2])}}}return e}function Ma(t,e,n,r,i,s){const o=Rt(e,n,i),a=os(e,n,i),l=o||a;if(!l)throw new Pt(`No attr for etype = ${n} label = ${i}`);if(s!=null&&s.hasOwnProperty("$isNull")){const d=Rt(e,n,"id");if(!d)throw new Pt(`No attr for etype = ${n} label = id`);return[t(n,r),d.id,{$isNull:{attrId:l.id,isNull:s.$isNull,reverse:!o}},Jt("time")]}return o?[t(n,r),l.id,Pa(l,s),Jt("time")]:[s,l.id,t(n,r),Jt("time")]}function $a(t,e,n,r,i){const[s,o,a]=i.reduce((l,d)=>{const[f,p,m]=l,[v,S,T]=hs(t,e,f,p,d);return[v,S,[...m,T]]},[n,r,[]]);return[s,o,a]}function Mr(t,e,n,r,i,s){const o=i.slice(0,i.length-1),a=i[i.length-1],[l,d,f]=$a(t,e,n,r,o),p=Ma(t,e,l,d,a,s);return f.concat([p])}function Ua(t,e){return e?[e].concat(t):t}function Na([t,e]){return t==="or"&&Array.isArray(e)}function Ba([t,e]){return t==="and"&&Array.isArray(e)}function Da(t,e,n){return(r,i)=>{const s=t(r,i);return e==s?s:`${s}-${n}`}}function _s(t,e,n,r,i,s){const o=t(r,i),a=s.map((l,d)=>{const f=Da(t,o,d);return ms(f,n,r,i,l)});return{[e]:{patterns:a,joinSym:o}}}function La(t){const e=[];for(let n=1;n<=t.length;n++)e.push(t.slice(0,n));return e}function ys(t,e,n,r,i){return La(i).map(s=>Mr(t,e,n,r,s,{$isNull:!0}))}function ms(t,e,n,r,i){return Object.entries(i).flatMap(([s,o])=>{if(Na([s,o]))return _s(t,"or",e,n,r,o);if(Ba([s,o]))return _s(t,"and",e,n,r,o);if(s==="$entityIdStartsWith")return[];const a=s.split(".");if(o!=null&&o.hasOwnProperty("$not")){const l=Mr(t,e,n,r,a,o),d=ys(t,e,n,r,a);return[{or:{patterns:[l,...d],joinSym:t(n,r)}}]}return o!=null&&o.hasOwnProperty("$isNull")&&o.$isNull===!0&&a.length>1?[{or:{patterns:ys(t,e,n,r,a),joinSym:t(n,r)}}]:Mr(t,e,n,r,a,o)})}function Fa(t,e,n,r){const i=Cn;return r?ms(i,t,e,n,r).concat(fs(i,t,e,n)):fs(i,t,e,n)}function Za(t,e,n){return[t(e,n),t("time",n)]}function qa(t,e,n,r,i,s){const[o,a,l,d,f]=hs(t,e,n,r,i),p=Ra(l,t(n,r),s);return[o,a,p,d,f]}function Va(t,e,{etype:n,level:r,form:i},s){const o=Object.keys(i).filter(a=>a!=="$");return o.length?Object.entries(s).map(function([l,d]){return o.map(function(m){var v,S,T;const R=!!(e.cardinalityInference&&(!((T=(S=(v=e.linkIndex)===null||v===void 0?void 0:v[n])===null||S===void 0?void 0:S[m])===null||T===void 0)&&T.isSingular));try{const[E,w,k]=qa(t,e,n,r,m,l),P=gs(e,{etype:E,level:w,form:i[m],join:k}),M=R?P[0]:P;return{[m]:M}}catch(E){if(E instanceof Pt)return{[m]:R?void 0:[]};throw E}}).reduce(function(m,v){return Object.assign(Object.assign({},m),v)},d)}):Object.values(s)}function jn([t,e],[n,r]){return e===r||e==null&&r==null?Ia(t,n):r==null?1:e==null?-1:e>r?1:-1}function $r(t){return t==null?t:new Date(t).getTime()}function za(t,e,n,r){var i;const[s,o,a,l]=t,d=n==="desc"?1:-1;if(((i=e["forward-identity"])===null||i===void 0?void 0:i[2])==="id")return jn(r,[s,l])===d;const[f,p]=r,m=e["checked-data-type"]==="date"?$r(p):p,v=e["checked-data-type"]==="date"?$r(a):a;return jn([f,m],[s,v])===d}function Wa(t,e){const n=e[1];return t.attrs[n]}function Ka(t,e,n){const r=Object.keys(n)[0];return Rt(t,e,r)}function Ha(t,e,n,r){if(n)return Wa(t,n);if(r)return Ka(t,e,r)}function Ja(t,e,n){var r,i;if(!Array.isArray(n.fields))return da(t,e);const s=new Map;for(const o of n.fields){const a=Rt(t,e,o),l=(r=a==null?void 0:a["forward-identity"])===null||r===void 0?void 0:r[2];l&&Tr(a)&&s.set(l,a)}if(!s.has("id")){const o=Rt(t,e,"id"),a=(i=o==null?void 0:o["forward-identity"])===null||i===void 0?void 0:i[2];a&&s.set(a,o)}return s}function Qa(t,e,n,r,i,s){var o;let a=wa(t,s);const l=r==null?void 0:r["start-cursor"],d=Ha(t,e,l,i);if(d&&((o=d==null?void 0:d["forward-identity"])===null||o===void 0?void 0:o[2])!=="id"){const m=d["checked-data-type"]==="date",v=d.id;a=a.map(([S])=>{var T,R,E,w,k;let P=(k=(w=(E=(R=(T=t.eav.get(S))===null||T===void 0?void 0:T.get(v))===null||R===void 0?void 0:R.values())===null||E===void 0?void 0:E.next())===null||w===void 0?void 0:w.value)===null||k===void 0?void 0:k[2];return m&&(P=$r(P)),[S,P]})}a.sort(n==="asc"?function(v,S){return jn(v,S)}:function(v,S){return jn(S,v)});let f={};const p=Ja(t,e,s);for(const m of a){const[v]=m;if(f[v]||l&&d&&za(l,d,n,m))continue;const S=la(t,p,v);S&&(f[v]=S)}return f}function Ga(t){var e;const n=(e=t.$)===null||e===void 0?void 0:e.order;return n&&n[Object.keys(n)[0]]||"asc"}function Ya(t,{etype:e,level:n,form:r,join:i,pageInfo:s}){var o,a,l,d,f,p,m,v,S;const T=((o=r.$)===null||o===void 0?void 0:o.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((l=r.$)===null||l===void 0?void 0:l.last),R=(d=r.$)===null||d===void 0?void 0:d.offset,E=(f=r.$)===null||f===void 0?void 0:f.before,w=(p=r.$)===null||p===void 0?void 0:p.after,k=(m=r.$)===null||m===void 0?void 0:m.order,P=(v=r.$)===null||v===void 0?void 0:v.fields;if((R||E||w)&&(!s||!s["start-cursor"]))return[];const M=Ua(Fa(t,e,n,(S=r.$)===null||S===void 0?void 0:S.where),i),W=Za(Cn,e,n),X=Qa(t,e,Ga(r),s,k,{where:M,find:W,fields:P});if(T!=null){const ne=Object.entries(X);return ne.length<=T?X:Object.fromEntries(ne.slice(0,T))}return X}function Xa(t,e){try{return Ya(t,e)}catch(n){if(n instanceof Pt)return{};throw n}}function gs(t,e){const n=Xa(t,e);return Va(Cn,t,e,n)}function ec(t){const e={};for(const[n,r]of Object.entries(t))e[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return e}function tc({store:t,pageInfo:e,aggregate:n},r){const s={data:Object.keys(r).reduce(function(a,l){return n!=null&&n[l]||l==="$$ruleParams"||(a[l]=gs(t,{etype:l,form:r[l],level:0,pageInfo:e==null?void 0:e[l]})),a},{})};return e&&(s.pageInfo=ec(e)),n&&(s.aggregate=n),s}function nc(){const e={__etype:1,__ops:1,update:1,link:1,unlink:1,delete:1,merge:1,ruleParams:1};return new Set(Object.keys(e))}const rc=nc();function Ur(t,e,n){const r={__etype:t,__ops:n};return new Proxy(r,{get:(i,s)=>{if(s==="__ops")return n;if(s==="__etype")return t;if(rc.has(s))return o=>Ur(t,e,[...n,[s,t,e,o]])}})}function Nr(t){return t.startsWith("lookup__")}function vs(t){const[e,n,...r]=t.split("__");return[n,JSON.parse(r.join("__"))]}function ic(t){return new Proxy({__etype:t},{get(e,n){if(n==="__etype")return t;const r=n;return Nr(r)?Ur(t,vs(r),[]):Ur(t,r,[])}})}function Br(){return new Proxy({},{get(t,e){return ic(e)}})}Br();function sc(t){return t.__ops}function oc(t,e){const{attrIdMap:n,refSwapAttrIds:r}=t,i=[];for(const o of e){const a=n[o];if(a)i.push(a);else if(Array.isArray(o)&&o.length==2&&n[o[0]]){const[l,d]=o;i.push([n[l],d])}else i.push(o)}const[s]=e;if((s==="add-triple"||s==="retract-triple")&&r.has(e[2])){const o=i[1];i[1]=i[3],i[3]=o}return i}function ke(t,e,n){return Object.values(t).find(r=>{const[i,s,o]=r["forward-identity"];return s===e&&o===n})}function bt(t,e,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[s,o,a]=i;return o===e&&a===n})}function ac(t){if(Array.isArray(t))return t;const e=Object.entries(t);if(e.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return e[0]}function Dr(t,e,n){return n.indexOf(".")!==-1&&!ke(t,e,n)}function Lr(t){const[e,n,...r]=t.split(".");if(r.length>0||n!=="id")throw new Error(`${t} is not a valid lookup attribute.`);return e}function cc(t,e,n){if(!Dr(t,e,n))return ke(t,e,n);const r=Lr(n),i=ke(t,e,r)||bt(t,e,r);if(i&&i["value-type"]!=="ref")throw new Error(`${n} does not reference a valid link attribute.`);return i}function Fr(t){return typeof t=="string"&&!Nr(t)?null:typeof t=="string"&&Nr(t)?vs(t):ac(t)}function Pe(t,e,n){const r=Fr(n);if(r===null)return n;const[i,s]=r,o=cc(t,e,i);if(!o||!o["unique?"])throw new Error(`${i} is not a unique attribute.`);return[o.id,s]}function bs(t,e,n,r){const i=Pe(t,e,n);return Array.isArray(i)?[["add-triple",i,ke(t,e,"id").id,i]].concat(r):r}function uc(t,[e,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],l=ke(t,e,s),d=bt(t,e,s);return a.map(f=>l?["add-triple",Pe(t,e,n),l.id,Pe(t,l["reverse-identity"][1],f)]:["add-triple",Pe(t,d["forward-identity"][1],f),d.id,Pe(t,e,n)])});return bs(t,e,n,i)}function lc(t,[e,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],l=ke(t,e,s),d=bt(t,e,s);return a.map(f=>l?["retract-triple",Pe(t,e,n),l.id,Pe(t,l["reverse-identity"][1],f)]:["retract-triple",Pe(t,d["forward-identity"][1],f),d.id,Pe(t,e,n)])});return bs(t,e,n,i)}function dc(t,[e,n,r]){const i=Gi(r),s=Pe(t,e,n);return[["id",s]].concat(Object.entries(i)).map(([a,l])=>{const d=ke(t,e,a);return["add-triple",s,d.id,l]})}function fc(t,[e,n]){return[["delete-entity",Pe(t,e,n),e]]}function hc(t,[e,n,r]){const i=Gi(r),s=Pe(t,e,n),o=Object.entries(i).map(([l,d])=>{const f=ke(t,e,l);return["deep-merge-triple",s,f.id,d]});return[["add-triple",s,ke(t,e,"id").id,s]].concat(o)}function pc(t,[e,n,r]){return[["rule-params",Pe(t,e,n),e,r]]}function _c(t){const[e,n,r,i]=t;if(!i)return t;const s=Object.assign({},i);return delete s.id,[e,n,r,s]}function yc(t,e){const[n,...r]=_c(e);switch(n){case"merge":return hc(t,r);case"update":return dc(t,r);case"link":return uc(t,r);case"unlink":return lc(t,r);case"delete":return fc(t,r);case"ruleParams":return pc(t,r);default:throw new Error(`unsupported action ${n}`)}}function mc(t){switch(t){case"string":case"date":case"boolean":case"number":return t;default:return}}function gc(t,e,n){var r,i;const s=(i=(r=t.entities[e])===null||r===void 0?void 0:r.attrs)===null||i===void 0?void 0:i[n];if(n==="id")return null;if(!s)throw new Error(`${e}.${n} does not exist in your schema`);const{unique:o,indexed:a}=s==null?void 0:s.config,l=mc(s==null?void 0:s.valueType);return{"index?":a,"unique?":o,"checked-data-type":l}}function Zr(t,e,n,r){const i=t?gc(t,e,n):null,s=we(),a=[we(),e,n];return Object.assign(Object.assign({id:s,"forward-identity":a,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}function vc(t,e,n){return Object.values(t.links).find(i=>i.forward.on===e&&i.forward.label===n||i.reverse.on===e&&i.reverse.label===n)}function bc(t,e,n){const r=vc(t,e,n);if(!r)throw new Error(`Couldn't find the link ${e}.${n} in your schema`);const{forward:i,reverse:s}=r;return{"forward-identity":[we(),i.on,i.label],"reverse-identity":[we(),s.on,s.label],cardinality:i.has==="one"?"one":"many","unique?":s.has==="one"}}function ws(t,e,n,r){const i=t?bc(t,e,n):null,s=we(),o=[we(),e,n],a=[we(),n,e];return Object.assign(Object.assign({id:s,"forward-identity":o,"reverse-identity":a,"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}const wc=new Set(["update","merge","link","unlink"]),xc=new Set(["link","unlink"]),Sc=new Set(["update","merge"]),kc=new Set(["link","unlink","update","merge","delete","ruleParams"]),qr={"unique?":!0,"index?":!0},Oc=Object.assign(Object.assign({},qr),{cardinality:"one"});function Ec(t){const e=[],[n,r,i,s]=t;if(!kc.has(n))return e;const o=Fr(i);if(o&&e.push({etype:r,lookupPair:o}),n==="link")for(const[a,l]of Object.entries(s)){const d=Array.isArray(l)?l:[l];for(const f of d){const p=Fr(f);p&&e.push({etype:r,lookupPair:p,linkLabel:a})}}return e}function Tc({attrs:t,schema:e},n){var r,i;const[s,o,a]=[new Set,Object.assign({},t),[]];function l(p){o[p.id]=p,a.push(["add-attr",p]),s.add(p.id)}function d(p){p!=null&&p.isUnsynced&&!s.has(p.id)&&(a.push(["add-attr",p]),s.add(p.id))}function f(p,m){const v=ke(o,p,m),S=bt(o,p,m);d(v),d(S),!v&&!S&&l(ws(e,p,m,Oc))}for(const p of n)for(const{etype:m,lookupPair:v,linkLabel:S}of Ec(p)){const T=v[0];if(S){f(m,S);const R=ke(o,m,S),E=bt(o,m,S);d(R),d(E);const w=((r=R==null?void 0:R["reverse-identity"])===null||r===void 0?void 0:r[1])||((i=E==null?void 0:E["forward-identity"])===null||i===void 0?void 0:i[1])||S;if(Dr(o,w,T))f(w,Lr(T));else{const k=ke(o,w,T);k||l(Zr(e,w,T,qr)),d(k)}}else if(Dr(o,m,T))f(m,Lr(T));else{const R=ke(o,m,T);R||l(Zr(e,m,T,qr)),d(R)}}for(const p of n){const[m,v,S,T]=p;if(wc.has(m)){const R=Object.keys(T);R.push("id");for(const E of R){const w=ke(o,v,E);if(d(w),Sc.has(m)&&(w||l(Zr(e,v,E,E==="id"?{"unique?":!0}:null))),xc.has(m)){const k=bt(o,v,E);!w&&!k&&l(ws(e,v,E)),d(k)}}}}return[o,a]}function Ic(t,e){const r=(Array.isArray(e)?e:[e]).flatMap(a=>sc(a)),[i,s]=Tc(t,r),o=r.flatMap(a=>yc(i,a));return[...s,...o]}var xs=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};class Ss{constructor(e){this.dbName=e,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((e,n)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{n(i)},r.onsuccess=i=>{e(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(e){return xs(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(e);a.onerror=l=>{i(l)},a.onsuccess=l=>{a.result?r(a.result):r(null)}})})}setItem(e,n){return xs(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,s)=>{const l=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,e);l.onerror=d=>{s(d)},l.onsuccess=d=>{i()}})})}}var Ac=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};class ks{static getIsOnline(){return Ac(this,void 0,void 0,function*(){return navigator.onLine})}static listen(e){const n=()=>{e(!0)},r=()=>{e(!1)};return addEventListener("online",n),addEventListener("offline",r),()=>{removeEventListener("online",n),removeEventListener("offline",r)}}}var Cc=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};class Vr extends Error{constructor(e){var n;const r=((n=e.body)===null||n===void 0?void 0:n.message)||`API Error (${e.status})`;super(r);const i=new.target.prototype;Object.setPrototypeOf&&Object.setPrototypeOf(this,i),Error.captureStackTrace&&Error.captureStackTrace(this,Vr),this.name="InstantAPIError",this.status=e.status,this.body=e.body}get[Symbol.toStringTag](){return"InstantAPIError"}}function He(t,e){return Cc(this,void 0,void 0,function*(){const n=yield fetch(t,e),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject(new Vr({status:n.status,body:r}))})}var Qt=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};function jc({apiURI:t,appId:e,email:n}){return He(`${t}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:n})})}function Rc(t){return Qt(this,arguments,void 0,function*({apiURI:e,appId:n,email:r,code:i}){return yield He(`${e}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,email:r,code:i})})})}function Pc(t){return Qt(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield He(`${e}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function Os(t){return Qt(this,arguments,void 0,function*({apiURI:e,appId:n,code:r,codeVerifier:i}){return yield He(`${e}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i})})})}function Mc(t){return Qt(this,arguments,void 0,function*({apiURI:e,appId:n,nonce:r,idToken:i,clientName:s,refreshToken:o}){return yield He(`${e}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:s,refresh_token:o})})})}function $c(t){return Qt(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield He(`${e}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,refresh_token:r})})})}var Gt=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};function Uc(t){return Gt(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,file:i,refreshToken:s,contentType:o,contentDisposition:a}){const l={app_id:n,path:r,authorization:`Bearer ${s}`,"content-type":o||i.type};return a&&(l["content-disposition"]=a),yield He(`${e}/storage/upload`,{method:"PUT",headers:l,body:i})})}function Nc(t){return Gt(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield He(`${e}/storage/files?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}function Bc(t){return Gt(this,arguments,void 0,function*({apiURI:e,appId:n,fileName:r,refreshToken:i,metadata:s={}}){const{data:o}=yield He(`${e}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return o})}function Dc(t,e){return Gt(this,void 0,void 0,function*(){return(yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}})).ok})}function Lc(t){return Gt(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield He(`${e}/storage/signed-download-url?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}let zr=!1,Es=!1,Ts=!1;typeof window<"u"&&typeof window.localStorage<"u"&&(zr=!!window.localStorage.getItem("devBackend"),Es=!!window.localStorage.getItem("__instantLogging"),Ts=!!window.localStorage.getItem("__devtoolLocalDash"));function Is(t,e){if(!e)return t;const n={};return e.forEach(r=>{n[r]=t[r]}),n}function Fc(t,e,n){var r,i;const s={peers:{}};if(e&&"user"in e?e.user:!0){const a=Is((r=t.user)!==null&&r!==void 0?r:{},e==null?void 0:e.keys);s.user=Object.assign(Object.assign({},a),{peerId:n})}for(const a of Object.keys((i=t.peers)!==null&&i!==void 0?i:{})){const l=(e==null?void 0:e.peers)===void 0,d=Array.isArray(e==null?void 0:e.peers)&&(e==null?void 0:e.peers.includes(a));if(l||d){const f=Is(t.peers[a],e==null?void 0:e.keys);s.peers[a]=Object.assign(Object.assign({},f),{peerId:a})}}return s}function Zc(t,e){if(t.isLoading!==e.isLoading||t.error!==e.error||(t.user||e.user)&&(!t.user||!e.user||!Qi(t.user,e.user))||!Ji(t.peers,e.peers))return!0;for(const r of Object.keys(t.peers))if(!Qi(t.peers[r],e.peers[r]))return!0;return!1}class As{constructor(){this.promise=new Promise((e,n)=>{this._resolve=e,this._reject=n})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}var Rn=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};class Cs{constructor(e,n,r,i,s=l=>JSON.stringify(l),o=l=>JSON.parse(l),a=100){this._subs=[],this._persister=e,this._key=n,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=s,this.fromJSON=o,this._saveThrottleMs=a,this._pendingSaveCbs=[],this._version=0,this._load()}_load(){return Rn(this,void 0,void 0,function*(){const e=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(e,this.currentValue);for(const n of this._loadedCbs)n()})}waitForLoaded(){return Rn(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(n=>{this._loadedCbs.push(n)})})}isLoading(){return this._isLoading}version(){return this._version}waitForSync(){return Rn(this,void 0,void 0,function*(){if(!this._nextSave)return;yield new Promise(n=>{this._pendingSaveCbs.push(n)})})}_writeToStorage(){this._persister.setItem(this._key,this.toJSON(this.currentValue));for(const e of this._pendingSaveCbs)e();this._pendingSaveCbs.length=0}flush(){return Rn(this,void 0,void 0,function*(){this._nextSave&&(clearTimeout(this._nextSave),this._writeToStorage())})}_enqueuePersist(e){if(this._nextSave){e&&this._pendingSaveCbs.push(e);return}this._nextSave=setTimeout(()=>{this._nextSave=null,this._writeToStorage()},this._saveThrottleMs)}set(e,n){this._version++,this.currentValue=e(this.currentValue),this._isLoading?this._loadedCbs.push(()=>this._enqueuePersist(n)):this._enqueuePersist(n);for(const r of this._subs)r(this.currentValue)}subscribe(e){return this._subs.push(e),e(this.currentValue),()=>{this._subs=this._subs.filter(n=>n!==e)}}}function js(t,e=[]){t.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":s}=i;for(const o of s)for(const a of o)e.push(a);js(n["child-nodes"],e)})}function Rs(t){const e=[];return js(t,e),e}function Ps(t){return Object.values(t.links).reduce((e,n)=>{var r,i,s,o;return(r=e[s=n.forward.on])!==null&&r!==void 0||(e[s]={}),e[n.forward.on][n.forward.label]={isForward:!0,isSingular:n.forward.has==="one",link:n},(i=e[o=n.reverse.on])!==null&&i!==void 0||(e[o]={}),e[n.reverse.on][n.reverse.label]={isForward:!1,isSingular:n.reverse.has==="one",link:n},e},{})}const Ms="v0.19.6";function qc(t){return{info:t?console.info.bind(console):()=>{},debug:t?console.debug.bind(console):()=>{},error:t?console.error.bind(console):()=>{}}}var ge=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};const it={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},Vc=3e4,zc=0,$s=1,Wc={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},Wr="_instant_oauth_redirect",Kr="currentUser";let Kc=0;function Hc(t){const e=new WebSocket(t);return e._id=Kc++,e}function Jc(){return typeof window<"u"||typeof chrome<"u"}const Us={"set-presence":!0,"set-presence-ok":!0,"refresh-presence":!0,"patch-presence":!0};function Qc(t){var e;const n=JSON.parse(t);for(const r in n){const i=n[r];!((e=i==null?void 0:i.result)===null||e===void 0)&&e.store&&(i.result.store=Xo(i.result.store))}return n}function Gc(t){var e;const n={};for(const r in t){const i=t[r],s=Object.assign({},i);!((e=i.result)===null||e===void 0)&&e.store&&(s.result=Object.assign(Object.assign({},i.result),{store:Yo(i.result.store)})),n[r]=s}return JSON.stringify(n)}class Yc{constructor(e,n=Ss,r=ks,i){this._isOnline=!0,this._isShutdown=!1,this.status=it.CONNECTING,this.queryCbs={},this.queryOnceDfds={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.connectionStatusCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._rooms={},this._roomsPendingLeave={},this._presence={},this._broadcastQueue=[],this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._beforeUnloadCbs=[],this._dataForQueryCache={},this._onMergeQuerySubs=(s,o)=>{const a=s||{},l=Object.assign({},o);Object.entries(o).forEach(([f,p])=>{var m;const v=(m=a==null?void 0:a[f])===null||m===void 0?void 0:m.result,S=p.result;v&&!S&&(l[f].result=v)}),Object.keys(a).filter(f=>!o[f]).slice(0,10).forEach(f=>{l[f]=a[f]}),this.querySubs.set(f=>l),this.loadedNotifyAll()},this._onMergePendingMutations=(s,o)=>{const a=new Map([...s.entries(),...o.entries()]);this.pendingMutations.set(d=>a),this.loadedNotifyAll(),this._rewriteMutations(this.attrs,s).forEach((d,f)=>{!o.has(f)&&!d["tx-id"]&&this._sendMutation(f,d)})},this.getPreviousResult=s=>{const o=Te(s);return this.dataForQuery(o)},this.notifyOne=s=>{var o,a;const l=(o=this.queryCbs[s])!==null&&o!==void 0?o:[],d=(a=this._dataForQueryCache[s])===null||a===void 0?void 0:a.data,f=this.dataForQuery(s);f&&(On(f,d)||l.forEach(p=>p.cb(f)))},this.notifyOneQueryOnce=s=>{var o;const a=(o=this.queryOnceDfds[s])!==null&&o!==void 0?o:[],l=this.dataForQuery(s);a.forEach(d=>{this._completeQueryOnce(d.q,s,d.dfd),d.dfd.resolve(l)})},this.notifyQueryError=(s,o)=>{(this.queryCbs[s]||[]).forEach(l=>l.cb({error:o}))},this.pushTx=s=>{try{const o=Ic({attrs:this.optimisticAttrs(),schema:this.config.schema},s);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(s,o)=>{const a=we(),l={op:"transact","tx-steps":s,error:o};this.pendingMutations.set(f=>(f.set(a,l),f));const d=new As;return this.mutationDeferredStore.set(a,d),this._sendMutation(a,l),this.notifyAll(),d.promise},this._wsOnOpen=s=>{const o=s.target;if(this._ws!==o){this._log.info("[socket][open]",o._id,"skip; this is no longer the current ws");return}this._log.info("[socket][open]",this._ws._id),this._setStatus(it.OPENED),this.getCurrentUser().then(a=>{var l;this._trySend(we(),{op:"init","app-id":this.config.appId,"refresh-token":(l=a.user)===null||l===void 0?void 0:l.refresh_token,versions:this.versions,"__admin-token":this.config.__adminToken})}).catch(a=>{this._log.error("[socket][error]",o._id,a)})},this._wsOnMessage=s=>{const o=s.target,a=JSON.parse(s.data.toString());if(this._ws!==o){this._log.info("[socket][message]",o._id,a,"skip; this is no longer the current ws");return}this._handleReceive(o._id,JSON.parse(s.data.toString()))},this._wsOnError=s=>{const o=s.target;if(this._ws!==o){this._log.info("[socket][error]",o._id,"skip; this is no longer the current ws");return}this._log.error("[socket][error]",o._id,s)},this._wsOnClose=s=>{const o=s.target;if(this._ws!==o){this._log.info("[socket][close]",o._id,"skip; this is no longer the current ws");return}this._setStatus(it.CLOSED);for(const a of Object.values(this._rooms))a.isConnected=!1;if(this._isShutdown){this._log.info("[socket][close]",o._id,"Reactor has been shut down and will not reconnect");return}this._log.info("[socket][close]",o._id,"schedule reconnect, ms =",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){this._log.info("[socket][close]",o._id,"we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},Wc),e),this._log=qc(e.verbose||zr||Es),this.versions=Object.assign(Object.assign({},i||{}),{"@instantdb/core":Ms}),this.config.schema&&(this._linkIndex=Ps(this.config.schema)),Jc()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",s=>ge(this,void 0,void 0,function*(){var o;try{if(((o=s.data)===null||o===void 0?void 0:o.type)==="auth"){const a=yield this.getCurrentUser();this.updateUser(a.user)}}catch(a){this._log.error("[error] handle broadcast channel",a)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(n),this.getCurrentUser(),r.getIsOnline().then(s=>{this._isOnline=s,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._log.info("[network] online =",o),this._isOnline=o,this._isOnline?this._startSocket():(this._log.info("Changing status from",this.status,"to",it.CLOSED),this._setStatus(it.CLOSED)))})}),typeof addEventListener<"u"&&(this._beforeUnload=this._beforeUnload.bind(this),addEventListener("beforeunload",this._beforeUnload)))}updateSchema(e){this.config=Object.assign(Object.assign({},this.config),{schema:e,cardinalityInference:!!e}),this._linkIndex=e?Ps(this.config.schema):null}_initStorage(e){this._persister=new e(`instant_${this.config.appId}_5`),this.querySubs=new Cs(this._persister,"querySubs",{},this._onMergeQuerySubs,Gc,Qc),this.pendingMutations=new Cs(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,n=>JSON.stringify([...n.entries()]),n=>new Map(JSON.parse(n))),this._beforeUnloadCbs.push(()=>{this.pendingMutations.flush(),this.querySubs.flush()})}_beforeUnload(){for(const e of this._beforeUnloadCbs)e()}_finishTransaction(e,n,r){const i=this.mutationDeferredStore.get(n);this.mutationDeferredStore.delete(n);const s=e!=="error"&&e!=="timeout";!i&&!s&&console.error("Mutation failed",Object.assign({status:e,clientId:n},r)),i&&(s?i.resolve({status:e,clientId:n}):i.reject(Object.assign({status:e,clientId:n},r)))}_setStatus(e,n){this.status=e,this._errorMessage=n,this.notifyConnectionStatusSubs(e)}_flushEnqueuedRoomData(e){var n,r;const i=(r=(n=this._presence[e])===null||n===void 0?void 0:n.result)===null||r===void 0?void 0:r.user,s=this._broadcastQueue[e];if(this._broadcastQueue[e]=[],i&&this._trySetPresence(e,i),s)for(const o of s){const{topic:a,roomType:l,data:d}=o;this._tryBroadcast(e,l,a,d)}}_handleReceive(e,n){var r,i,s,o,a,l;const d=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(Us[n.op]||this._log.info("[receive]",e,n.op,n),n.op){case"init-ok":this._setStatus(it.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(n.attrs),this._flushPendingMessages(),this._sessionId=n["session-id"];for(const b of Object.keys(this._rooms)){const j=(i=(r=this._presence[b])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.user;this._tryJoinRoom(b,j)}break;case"add-query-exists":this.notifyOneQueryOnce(Te(n.q));break;case"add-query-ok":const{q:f,result:p}=n,m=Te(f),v=(o=(s=p==null?void 0:p[0])===null||s===void 0?void 0:s.data)===null||o===void 0?void 0:o["page-info"],S=(l=(a=p==null?void 0:p[0])===null||a===void 0?void 0:a.data)===null||l===void 0?void 0:l.aggregate,T=Rs(p),R=Cr(this.attrs,T,d,this._linkIndex);this.querySubs.set(b=>(b[m].result={store:R,pageInfo:v,aggregate:S},b)),this.notifyOne(m),this.notifyOneQueryOnce(m);break;case"refresh-ok":const{computations:E,attrs:w}=n;this._setAttrs(w);const k=E.map(b=>{var j,F,D,Z;const C=b["instaql-query"],$=b["instaql-result"],re=Te(C),ie=Rs($),ee=Cr(this.attrs,ie,d,this._linkIndex),se=(F=(j=$==null?void 0:$[0])===null||j===void 0?void 0:j.data)===null||F===void 0?void 0:F["page-info"],J=(Z=(D=$==null?void 0:$[0])===null||D===void 0?void 0:D.data)===null||Z===void 0?void 0:Z.aggregate;return{hash:re,store:ee,pageInfo:se,aggregate:J}});k.forEach(({hash:b,store:j,pageInfo:F,aggregate:D})=>{this.querySubs.set(Z=>(Z[b].result={store:j,pageInfo:F,aggregate:D},Z))}),k.forEach(({hash:b})=>{this.notifyOne(b)});break;case"transact-ok":const{"client-event-id":P,"tx-id":M}=n,X=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(P);if(!X)break;this.pendingMutations.set(b=>(b.delete(P),b));const ne=X["tx-steps"];this.querySubs.set(b=>{var j;for(const[F,D]of Object.entries(b)){const Z=(j=D==null?void 0:D.result)===null||j===void 0?void 0:j.store;if(!Z)continue;const C=as(Z,ne);b[F].result.store=C}return b});const Q=X["tx-steps"].filter(([b,...j])=>b==="add-attr").map(([b,j])=>j).concat(Object.values(this.attrs));this._setAttrs(Q),this._finishTransaction("synced",P);break;case"patch-presence":{const b=n["room-id"];this._patchPresencePeers(b,n.edits),this._notifyPresenceSubs(b);break}case"refresh-presence":{const b=n["room-id"];this._setPresencePeers(b,n.data),this._notifyPresenceSubs(b);break}case"server-broadcast":const Ne=n["room-id"],me=n.topic;this._notifyBroadcastSubs(Ne,me,n);break;case"join-room-ok":const ye=n["room-id"],Ye=this._rooms[ye];if(!Ye){this._roomsPendingLeave[ye]&&(this._tryLeaveRoom(ye),delete this._roomsPendingLeave[ye]);break}Ye.isConnected=!0,this._notifyPresenceSubs(ye),this._flushEnqueuedRoomData(ye);break;case"join-room-error":const Tt=n["room-id"],le=this._rooms[Tt];le&&(le.error=n.error),this._notifyPresenceSubs(Tt);break;case"error":this._handleReceiveError(n);break}}_handleMutationError(e,n,r){const i=this.pendingMutations.currentValue.get(n);i&&(e!=="timeout"||!i["tx-id"])&&(this.pendingMutations.set(s=>(s.delete(n),s)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(r),this._finishTransaction(e,n,r))}_handleReceiveError(e){var n,r,i,s,o;const a=e["client-event-id"],l=this.pendingMutations.currentValue.get(a),d={message:e.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};if(e.hint&&(d.hint=e.hint),l){const m={message:e.message,hint:e.hint};this._handleMutationError("error",a,m);return}if(!((n=e["original-event"])===null||n===void 0)&&n.hasOwnProperty("q")&&((r=e["original-event"])===null||r===void 0?void 0:r.op)==="add-query"){const m=(i=e["original-event"])===null||i===void 0?void 0:i.q,v=Te(m);this.notifyQueryError(Te(m),d),this.notifyQueryOnceError(m,v,a,d);return}if(((s=e["original-event"])===null||s===void 0?void 0:s.op)==="init"){if(e.type==="record-not-found"&&((o=e.hint)===null||o===void 0?void 0:o["record-type"])==="app-user"){this.changeCurrentUser(null);return}this._setStatus(it.ERRORED,d),this.notifyAll();return}const p=Object.assign({},e);delete p.message,delete p.hint,console.error(e.message,p),e.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,e.hint)}notifyQueryOnceError(e,n,r,i){var s;const o=(s=this.queryOnceDfds[n])===null||s===void 0?void 0:s.find(a=>a.eventId===r);o&&(o.dfd.reject(i),this._completeQueryOnce(e,n,o.dfd))}_setAttrs(e){this.attrs=e.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}_startQuerySub(e,n){const r=we();return this.querySubs.set(i=>(i[n]=i[n]||{q:e,result:null,eventId:r},i)),this._trySendAuthed(r,{op:"add-query",q:e}),r}subscribeQuery(e,n,r){var i;r&&"ruleParams"in r&&(e=Object.assign({$$ruleParams:r.ruleParams},e));const s=Te(e),o=this.getPreviousResult(e);return o&&n(o),this.queryCbs[s]=(i=this.queryCbs[s])!==null&&i!==void 0?i:[],this.queryCbs[s].push({q:e,cb:n}),this._startQuerySub(e,s),()=>{this._unsubQuery(e,s,n)}}queryOnce(e,n){var r;n&&"ruleParams"in n&&(e=Object.assign({$$ruleParams:n.ruleParams},e));const i=new As;if(!this._isOnline)return i.reject(new Error("We can't run `queryOnce`, because the device is offline.")),i.promise;if(!this.querySubs)return i.reject(new Error("We can't run `queryOnce` on the backend. Use adminAPI.query instead: https://www.instantdb.com/docs/backend#query")),i.promise;const s=Te(e),o=this._startQuerySub(e,s);return this.queryOnceDfds[s]=(r=this.queryOnceDfds[s])!==null&&r!==void 0?r:[],this.queryOnceDfds[s].push({q:e,dfd:i,eventId:o}),setTimeout(()=>i.reject(new Error("Query timed out")),Vc),i.promise}_completeQueryOnce(e,n,r){this.queryOnceDfds[n]&&(this.queryOnceDfds[n]=this.queryOnceDfds[n].filter(i=>i.dfd!==r),this._cleanupQuery(e,n))}_unsubQuery(e,n,r){this.queryCbs[n]&&(this.queryCbs[n]=this.queryCbs[n].filter(i=>i.cb!==r),this._cleanupQuery(e,n))}_cleanupQuery(e,n){var r,i;!((r=this.queryCbs[n])===null||r===void 0)&&r.length||!((i=this.queryOnceDfds[n])===null||i===void 0)&&i.length||(delete this.queryCbs[n],delete this.queryOnceDfds[n],this._trySendAuthed(we(),{op:"remove-query",q:e}))}_rewriteMutations(e,n){if(!e)return n;const r=l=>{const[d,f,p]=l["forward-identity"];return ke(e,f,p)},i=l=>{const[d,f,p]=l["forward-identity"];return bt(e,f,p)},s={attrIdMap:{},refSwapAttrIds:new Set},o=l=>{const d=[];for(const f of l){const[p]=f;if(p==="add-attr"){const[v,S]=f,T=r(S);if(T){s.attrIdMap[S.id]=T.id;continue}if(S["value-type"]==="ref"){const R=i(S);if(R){s.attrIdMap[S.id]=R.id,s.refSwapAttrIds.add(S.id);continue}}}const m=oc(s,f);d.push(m)}return d},a=new Map;for(const[l,d]of n.entries())a.set(l,Object.assign(Object.assign({},d),{"tx-steps":o(d["tx-steps"])}));return a}optimisticAttrs(){var e;const n=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(n.filter(([a,l])=>a==="delete-attr").map(([a,l])=>l)),i=[];for(const[a,l]of n)if(a==="add-attr")i.push(l);else if(a==="update-attr"&&l.id&&(!((e=this.attrs)===null||e===void 0)&&e[l.id])){const d=Object.assign(Object.assign({},this.attrs[l.id]),l);i.push(d)}const s=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(s.map(a=>[a.id,a]))}dataForQuery(e){const n=this._errorMessage;if(n)return{error:n};if(!this.querySubs||!this.pendingMutations)return;const r=this.querySubs.version(),i=this.querySubs.currentValue,s=this.pendingMutations.version(),o=this.pendingMutations.currentValue,{q:a,result:l}=i[e]||{};if(!l)return;const d=this._dataForQueryCache[e];if(d&&r===d.querySubVersion&&s===d.pendingMutationsVersion)return d.data;const{store:f,pageInfo:p,aggregate:m}=l,S=[...this._rewriteMutations(f.attrs,o).values()].flatMap(E=>E["tx-steps"]),T=as(f,S),R=tc({store:T,pageInfo:p,aggregate:m},a);return this._dataForQueryCache[e]={querySubVersion:r,pendingMutationsVersion:s,data:R},R}notifyAll(){Object.keys(this.queryCbs).forEach(e=>{this.notifyOne(e)})}loadedNotifyAll(){this.pendingMutations.isLoading()||this.querySubs.isLoading()||this.notifyAll()}shutdown(){var e;this._log.info("[shutdown]",this.config.appId),this._isShutdown=!0,(e=this._ws)===null||e===void 0||e.close()}_sendMutation(e,n){if(n.error){this._handleMutationError("error",e,{error:n.error,message:n.error.message});return}if(this.status!==it.AUTHENTICATED){this._finishTransaction("enqueued",e);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(e,n),setTimeout(()=>{this._finishTransaction("pending",e)},3e3),setTimeout(()=>{this._isOnline&&this._handleMutationError("timeout",e,{message:"transaction timed out"})},r)):this._finishTransaction("enqueued",e)}_flushPendingMessages(){Object.keys(this.queryCbs).map(i=>this.querySubs.currentValue[i]).filter(i=>i).forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),Object.values(this.queryOnceDfds).flat().forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((i,s)=>{i["tx-id"]||this._sendMutation(s,i)})}_trySendAuthed(...e){this.status===it.AUTHENTICATED&&this._trySend(...e)}_trySend(e,n,r){this._ws.readyState===$s&&(Us[n.op]||this._log.info("[send]",this._ws._id,n.op,n),this._ws.send(JSON.stringify(Object.assign({"client-event-id":e},n))))}_startSocket(){if(this._isShutdown){this._log.info("[socket][start]",this.config.appId,"Reactor has been shut down and will not start a new socket");return}if(this._ws&&this._ws.readyState==zc){this._log.info("[socket][start]",this._ws._id,"maintained as current ws, we were still in a connecting state");return}const e=this._ws;this._ws=Hc(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose,this._ws.onerror=this._wsOnError,this._log.info("[socket][start]",this._ws._id),(e==null?void 0:e.readyState)===$s&&(this._log.info("[socket][start]",this._ws._id,"close previous ws id = ",e._id),e.close())}getLocalId(e){return ge(this,void 0,void 0,function*(){const n=`localToken_${e}`,r=yield this._persister.getItem(n);if(r)return r;if(this._localIdPromises[n])return this._localIdPromises[n];const i=we();return this._localIdPromises[n]=this._persister.setItem(n,i).then(()=>i),this._localIdPromises[n]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const e=new URL(window.location.href);if(e.searchParams.get(Wr)){const n=e.toString();e.searchParams.delete(Wr),e.searchParams.delete("code"),e.searchParams.delete("error");const r=e.pathname+(e.searchParams.size?"?"+e.searchParams:"")+e.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const s=o=>{var a;i||(i=!0,navigation.removeEventListener("navigate",s),!o.userInitiated&&o.navigationType==="replace"&&((a=o.destination)===null||a===void 0?void 0:a.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",s)}}}_oauthLoginInit(){return ge(this,void 0,void 0,function*(){var e,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const s=new URLSearchParams(window.location.search);if(!s.get(Wr))return null;const o=s.get("error");if(o)return this._replaceUrlAfterOAuth(),{error:{message:o}};const a=s.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:l}=yield Os({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(l),null}catch(l){return((e=l==null?void 0:l.body)===null||e===void 0?void 0:e.type)==="record-not-found"&&((r=(n=l==null?void 0:l.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=l==null?void 0:l.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return ge(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(e){return this.mutationErrorCbs.push(e),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==e)}}subscribeAuth(e){this.authCbs.push(e);const n=this._currentUserCached;n.isLoading||e(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||On(i,n)||e(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==e)}}getAuth(){return ge(this,void 0,void 0,function*(){const{user:e,error:n}=yield this.getCurrentUser();if(n)throw n;return e})}subscribeConnectionStatus(e){return this.connectionStatusCbs.push(e),()=>{this.connectionStatusCbs=this.connectionStatusCbs.filter(n=>n!==e)}}subscribeAttrs(e){return this.attrsCbs.push(e),this.attrs&&e(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==e)}}notifyAuthSubs(e){this.authCbs.forEach(n=>n(e))}notifyMutationErrorSubs(e){this.mutationErrorCbs.forEach(n=>n(e))}notifyAttrsSubs(){if(!this.attrs)return;const e=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(e))}notifyConnectionStatusSubs(e){this.connectionStatusCbs.forEach(n=>n(e))}setCurrentUser(e){return ge(this,void 0,void 0,function*(){yield this._persister.setItem(Kr,JSON.stringify(e))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return ge(this,void 0,void 0,function*(){const e=yield this._waitForOAuthCallbackResponse();if(e!=null&&e.error){const i={error:e.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const n=yield this._persister.getItem(Kr),r={user:JSON.parse(n),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return ge(this,void 0,void 0,function*(){const e=yield this._persister.getItem(Kr);return JSON.parse(e)!=null})}changeCurrentUser(e){return ge(this,void 0,void 0,function*(){var n;const{user:r}=yield this.getCurrentUser();if(!On(r,e)){yield this.setCurrentUser(e),this.updateUser(e);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(e){const n={error:void 0,user:e};this._currentUserCached=Object.assign({isLoading:!1},n),this._dataForQueryCache={},this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(n)}sendMagicCode({email:e}){return jc({apiURI:this.config.apiURI,appId:this.config.appId,email:e})}signInWithMagicCode(e){return ge(this,arguments,void 0,function*({email:n,code:r}){const i=yield Rc({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r});return yield this.changeCurrentUser(i.user),i})}signInWithCustomToken(e){return ge(this,void 0,void 0,function*(){const n=yield Pc({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:e});return yield this.changeCurrentUser(n.user),n})}potentiallyInvalidateToken(e,n){var r;const i=(r=e==null?void 0:e.user)===null||r===void 0?void 0:r.refresh_token;if(!i)return;if(n.invalidateToken===!1){this._log.info("[auth-invalidate] skipped invalidateToken");return}$c({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:i}).then(()=>{this._log.info("[auth-invalidate] completed invalidateToken")}).catch(o=>{})}signOut(e){return ge(this,void 0,void 0,function*(){const n=yield this.getCurrentUser();this.potentiallyInvalidateToken(n,e),yield this.changeCurrentUser(null)})}createAuthorizationURL({clientName:e,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${e}&redirect_uri=${n}`}exchangeCodeForToken(e){return ge(this,arguments,void 0,function*({code:n,codeVerifier:r}){const i=yield Os({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r});return yield this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:e,appId:n}=this.config;return`${e}/runtime/${n}`}signInWithIdToken(e){return ge(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){var s;const o=yield this.getCurrentUser(),a=(s=o==null?void 0:o.user)===null||s===void 0?void 0:s.refresh_token,l=yield Mc({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i,refreshToken:a});return yield this.changeCurrentUser(l.user),l})}joinRoom(e,n){return this._rooms[e]||(this._rooms[e]={isConnected:!1,error:void 0}),this._presence[e]=this._presence[e]||{},n&&(this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=n,this._notifyPresenceSubs(e)),this._tryJoinRoom(e,n),()=>{this._cleanupRoom(e)}}_cleanupRoom(e){var n,r,i,s;if(!(!((r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[e])!==null&&i!==void 0?i:{}).length){const o=(s=this._rooms[e])===null||s===void 0?void 0:s.isConnected;delete this._rooms[e],delete this._presence[e],delete this._broadcastSubs[e],o?this._tryLeaveRoom(e):this._roomsPendingLeave[e]=!0}}getPresence(e,n,r={}){const i=this._rooms[n],s=this._presence[n];return!i||!s||!s.result?null:Object.assign(Object.assign({},Fc(s.result,r,this._sessionId)),{isLoading:!i.isConnected,error:i.error})}publishPresence(e,n,r){const i=this._rooms[n],s=this._presence[n];if(!i||!s)return;s.result=s.result||{};const o=Object.assign(Object.assign({},s.result.user),r);s.result.user=o,i.isConnected&&(this._trySetPresence(n,o),this._notifyPresenceSubs(n))}_trySetPresence(e,n){this._trySendAuthed(we(),{op:"set-presence","room-id":e,data:n})}_tryJoinRoom(e,n){this._trySendAuthed(we(),{op:"join-room","room-id":e,data:n}),delete this._roomsPendingLeave[e]}_tryLeaveRoom(e){this._trySendAuthed(we(),{op:"leave-room","room-id":e})}subscribePresence(e,n,r,i){const s=this.joinRoom(n,r.data),o=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(o),this._notifyPresenceSub(n,o),()=>{var a,l,d;this._presence[n].handlers=(d=(l=(a=this._presence[n])===null||a===void 0?void 0:a.handlers)===null||l===void 0?void 0:l.filter(f=>f!==o))!==null&&d!==void 0?d:[],s()}}_notifyPresenceSubs(e){var n,r;(r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(e,i)})}_notifyPresenceSub(e,n){const r=this.getPresence("",e,n);r&&(n.prev&&!Zc(r,n.prev)||(n.prev=r,n.cb(r)))}_patchPresencePeers(e,n){var r,i,s;const o=((i=(r=this._presence[e])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.peers)||{};let a=Object.fromEntries(Object.entries(o).map(([d,f])=>[d,{data:f}]));(s=this._presence[e])===null||s===void 0||s.result;const l=Or(a,d=>{for(let[f,p,m]of n)switch(p){case"+":Jo(d,f,m);break;case"r":Xi(d,f,m);break;case"-":es(d,f);break}delete d[this._sessionId]});this._setPresencePeers(e,l)}_setPresencePeers(e,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([s,o])=>[s,o.data]));this._presence=Or(this._presence,s=>{Xi(s,[e,"result","peers"],i)})}publishTopic({roomType:e,roomId:n,topic:r,data:i}){var s;const o=this._rooms[n];if(o){if(!o.isConnected){this._broadcastQueue[n]=(s=this._broadcastQueue[n])!==null&&s!==void 0?s:[],this._broadcastQueue[n].push({topic:r,roomType:e,data:i});return}this._tryBroadcast(n,e,r,i)}}_tryBroadcast(e,n,r,i){this._trySendAuthed(we(),{op:"client-broadcast","room-id":e,roomType:n,topic:r,data:i})}subscribeTopic(e,n,r){const i=this.joinRoom(e);return this._broadcastSubs[e]=this._broadcastSubs[e]||{},this._broadcastSubs[e][n]=this._broadcastSubs[e][n]||[],this._broadcastSubs[e][n].push(r),this._presence[e]=this._presence[e]||{},()=>{this._broadcastSubs[e][n]=this._broadcastSubs[e][n].filter(s=>s!==r),this._broadcastSubs[e][n].length||delete this._broadcastSubs[e][n],i()}}_notifyBroadcastSubs(e,n,r){var i,s,o;(o=(s=(i=this._broadcastSubs)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s[n])===null||o===void 0||o.forEach(a=>{var l,d,f,p,m,v;const S=(l=r.data)===null||l===void 0?void 0:l.data,T=r.data["peer-id"]===this._sessionId?(f=(d=this._presence[e])===null||d===void 0?void 0:d.result)===null||f===void 0?void 0:f.user:(v=(m=(p=this._presence[e])===null||p===void 0?void 0:p.result)===null||m===void 0?void 0:m.peers)===null||v===void 0?void 0:v[r.data["peer-id"]];return a(S,T)})}uploadFile(e,n,r){return ge(this,void 0,void 0,function*(){var i;const s=yield this.getCurrentUser(),o=(i=s==null?void 0:s.user)===null||i===void 0?void 0:i.refresh_token;return Uc(Object.assign(Object.assign({},r),{apiURI:this.config.apiURI,appId:this.config.appId,path:e,file:n,refreshToken:o}))})}deleteFile(e){return ge(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield Nc({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}upload(e,n){return ge(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),s=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,o=e||n.name,a=yield Bc({apiURI:this.config.apiURI,appId:this.config.appId,fileName:o,refreshToken:s});return yield Dc(a,n)})}getDownloadUrl(e){return ge(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield Lc({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}}class Fe{constructor(e,n,r={indexed:!1,unique:!1}){this.valueType=e,this.required=n,this.config=r}clientRequired(){return new Fe(this.valueType,!1,this.config)}optional(){return new Fe(this.valueType,!1,this.config)}unique(){return new Fe(this.valueType,this.required,Object.assign(Object.assign({},this.config),{unique:!0}))}indexed(){return new Fe(this.valueType,this.required,Object.assign(Object.assign({},this.config),{indexed:!0}))}}class Pn{constructor(e,n){this.attrs=e,this.links=n}asType(){return new Pn(this.attrs,this.links)}}class Mn{constructor(e,n,r){this.entities=e,this.links=n,this.rooms=r}withRoomSchema(){return new Mn(this.entities,this.links,{})}}function Xc(t,e){return new Mn(Ns(t,e),e,void 0)}function eu(t){return new Pn(t,{})}function tu(){return new Fe("string",!0)}function nu(){return new Fe("number",!0)}function ru(){return new Fe("boolean",!0)}function iu(){return new Fe("date",!0)}function su(){return new Fe("json",!0)}function ou(){return new Fe("json",!0)}function Ns(t,e){var n,r,i,s;const o={fwd:{},rev:{}};for(const l of Object.values(e))(n=o.fwd)[r=l.forward.on]||(n[r]={}),(i=o.rev)[s=l.reverse.on]||(i[s]={}),o.fwd[l.forward.on][l.forward.label]={entityName:l.reverse.on,cardinality:l.forward.has},o.rev[l.reverse.on][l.reverse.label]={entityName:l.forward.on,cardinality:l.reverse.has};return Object.fromEntries(Object.entries(t).map(([l,d])=>[l,new Pn(d.attrs,Object.assign(Object.assign({},o.fwd[l]),o.rev[l]))]))}function au({entities:t,links:e,rooms:n}){const r=e??{},i=n??{};return new Mn(Ns(t,r),r,i)}const ue={graph:Xc,schema:au,entity:eu,string:tu,number:nu,boolean:ru,date:iu,json:su,any:ou};let $n;function cu(t,e){$n==null||$n.dispose();const n=pu(e),r=du(e,a),i=lu(uu(t));function s(f){var p;f.source===i.element.contentWindow&&((p=f.data)===null||p===void 0?void 0:p.type)==="close"&&n.isVisible()&&a()}function o(f){const p=f.shiftKey&&f.ctrlKey&&f.key==="0",m=f.key==="Escape"||f.key==="Esc";(p||m&&n.isVisible())&&a()}function a(){n.isVisible()?n.element.style.display="none":(n.element.style.display="block",n.element.contains(i.element)||n.element.appendChild(i.element))}function l(){n.element.remove(),r.element.remove(),removeEventListener("keydown",o),removeEventListener("message",s)}function d(){document.body.appendChild(n.element),document.body.appendChild(r.element),addEventListener("keydown",o),addEventListener("message",s),$n={dispose:l}}return d()}function uu(t){return`${zr||Ts?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${t}`}function lu(t){const e=document.createElement("iframe");return e.src=t,e.className="instant-devtool-iframe",Object.assign(e.style,{width:"100%",height:"100%",backgroundColor:"white",border:"none"}),{element:e}}function du(t,e){const n=`
    <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,r=document.createElement("button");return r.innerHTML=n,r.className="instant-devtool-toggler",Object.assign(r.style,Object.assign(Object.assign({position:"fixed"},fu(t.position)),{height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"9010",padding:"0",margin:"0",border:"none",cursor:"pointer"})),r.addEventListener("click",e),{element:r}}function fu(t){switch(t){case"bottom-left":return{bottom:"24px",left:"24px"};case"bottom-right":return{bottom:"24px",right:"24px"};case"top-right":return{top:"24px",right:"24px"};case"top-left":return{top:"24px",left:"24px"}}}function hu(t){switch(t){case"bottom-left":return{bottom:"24px",right:"24px",left:"60px",top:"72px"};case"bottom-right":return{bottom:"24px",left:"24px",right:"60px",top:"72px"};case"top-right":return{top:"24px",left:"24px",right:"60px",bottom:"72px"};case"top-left":return{top:"24px",right:"24px",left:"60px",bottom:"72px"}}}function pu(t){const e=document.createElement("div");Object.assign(e.style,Object.assign(Object.assign({position:"fixed"},hu(t.position)),{display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"})),e.style.display="none",e.className="instant-devtool-container";function n(){return e.style.display!=="none"}return{element:e,isVisible:n}}const _u={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function yu(){var t;return globalThis.__instantDbSchemaHashStore=(t=globalThis.__instantDbSchemaHashStore)!==null&&t!==void 0?t:new WeakMap,globalThis.__instantDbSchemaHashStore}function mu(){var t;return globalThis.__instantDbStore=(t=globalThis.__instantDbStore)!==null&&t!==void 0?t:{},globalThis.__instantDbStore}function Hr(t){const e=t.__adminToken;return t.appId+"_"+(t.websocketURI||"default_ws_uri")+"_"+(t.apiURI||"default_api_uri")+"_"+(e||"client_only")}const Jr=mu(),Qr=yu();class gu{constructor(e){this.db=e,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=(n={invalidateToken:!0})=>this.db.signOut(n)}}class vu{constructor(e){this.db=e,this.uploadFile=(n,r,i={})=>this.db.uploadFile(n,r,i),this.delete=n=>this.db.deleteFile(n),this.upload=(n,r)=>this.db.upload(n,r),this.put=this.upload,this.getDownloadUrl=n=>this.db.getDownloadUrl(n)}}function bu(t){return JSON.parse(JSON.stringify(t))}class wu{constructor(e){this.tx=Br(),this._reactor=e,this.auth=new gu(this._reactor),this.storage=new vu(this._reactor)}transact(e){return this._reactor.pushTx(e)}getLocalId(e){return this._reactor.getLocalId(e)}subscribeQuery(e,n,r){return this._reactor.subscribeQuery(e,n,r)}subscribeAuth(e){return this._reactor.subscribeAuth(e)}getAuth(){return this._reactor.getAuth()}subscribeConnectionStatus(e){return this._reactor.subscribeConnectionStatus(e)}joinRoom(e="_defaultRoomType",n="_defaultRoomId",r){return{leaveRoom:this._reactor.joinRoom(n,r==null?void 0:r.initialPresence),subscribeTopic:(s,o)=>this._reactor.subscribeTopic(n,s,o),subscribePresence:(s,o)=>this._reactor.subscribePresence(e,n,s,o),publishTopic:(s,o)=>this._reactor.publishTopic({roomType:e,roomId:n,topic:s,data:o}),publishPresence:s=>this._reactor.publishPresence(e,n,s),getPresence:s=>this._reactor.getPresence(e,n,s)}}shutdown(){delete Jr[Hr(this._reactor.config)],this._reactor.shutdown()}queryOnce(e,n){return this._reactor.queryOnce(e,n)}}function Bs(t){if(!t)return"0";if(Qr.get(t))return Qr.get(t);const e=Te(t);return Qr.set(t,e),e}function xu(t,e){return Bs(t._reactor.config.schema)!==Bs(e)}function Su(t,e,n,r){const i=Jr[Hr(t)];if(i)return xu(i,t.schema)&&i._reactor.updateSchema(t.schema),i;const s=new Yc(Object.assign(Object.assign(Object.assign({},_u),t),{cardinalityInference:!!t.schema}),e||Ss,n||ks,Object.assign(Object.assign({},r||{}),{"@instantdb/core":Ms})),o=new wu(s);return Jr[Hr(t)]=o,ku(t.appId,t.devtool),o}function ku(t,e){if(typeof window>"u"||typeof window.location>"u"||typeof document>"u"||typeof e=="boolean"&&!e)return;const n=Object.assign({position:"bottom-right",allowedHosts:["localhost"]},typeof e=="object"?e:{});n.allowedHosts.includes(window.location.hostname)&&cu(t,n)}function Ou(t,e){for(var n in e)t[n]=e[n];return t}function Ds(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Gr(t,e){var n=e(),r=$e({t:{__:n,u:e}}),i=r[0].t,s=r[1];return Mo(function(){i.__=n,i.u=e,Yr(i)&&s({t:i})},[t,n,e]),Ae(function(){return Yr(i)&&s({t:i}),t(function(){Yr(i)&&s({t:i})})},[t]),n}function Yr(t){var e,n,r=t.u,i=t.__;try{var s=r();return!((e=i)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Ls(t,e){this.props=t,this.context=e}(Ls.prototype=new tt).isPureReactComponent=!0,Ls.prototype.shouldComponentUpdate=function(t,e){return Ds(this.props,t)||Ds(this.state,e)};var Fs=V.__b;V.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Fs&&Fs(t)};var Eu=V.__e;V.__e=function(t,e,n,r){if(t.then){for(var i,s=e;s=s.__;)if((i=s.__c)&&i.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),i.__c(t,e)}Eu(t,e,n,r)};var Zs=V.unmount;function qs(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=Ou({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return qs(r,e,n)})),t}function Vs(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return Vs(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function Xr(){this.__u=0,this.o=null,this.__b=null}function zs(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Un(){this.i=null,this.l=null}V.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),Zs&&Zs(t)},(Xr.prototype=new tt).__c=function(t,e){var n=e.__c,r=this;r.o==null&&(r.o=[]),r.o.push(n);var i=zs(r.__v),s=!1,o=function(){s||(s=!0,n.__R=null,i?i(a):a())};n.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var l=r.state.__a;r.__v.__k[0]=Vs(l,l.__c.__P,l.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.o.pop();)d.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(o,o)},Xr.prototype.componentWillUnmount=function(){this.o=[]},Xr.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=qs(this.__b,n,r.__O=r.__P)}this.__b=null}var i=e.__a&&or(It,null,t.fallback);return i&&(i.__u&=-33),[or(It,null,e.__a?null:t.children),i]};var Ws=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};(Un.prototype=new tt).__a=function(t){var e=this,n=zs(e.__v),r=e.l.get(t);return r[0]++,function(i){var s=function(){e.props.revealOrder?(r.push(i),Ws(e,t,r)):i()};n?n(s):s()}},Un.prototype.render=function(t){this.i=null,this.l=new Map;var e=mn(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Un.prototype.componentDidUpdate=Un.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Ws(t,n,e)})};var Tu=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Iu=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Au=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Cu=/[A-Z0-9]/g,ju=typeof document<"u",Ru=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};tt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(tt.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Ks=V.event;function Pu(){}function Mu(){return this.cancelBubble}function $u(){return this.defaultPrevented}V.event=function(t){return Ks&&(t=Ks(t)),t.persist=Pu,t.isPropagationStopped=Mu,t.isDefaultPrevented=$u,t.nativeEvent=t};var Uu={enumerable:!1,configurable:!0,get:function(){return this.class}},Hs=V.vnode;V.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,i={},s=r.indexOf("-")===-1;for(var o in n){var a=n[o];if(!(o==="value"&&"defaultValue"in n&&a==null||ju&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||r!=="input"&&r!=="textarea"||Ru(n.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":Au.test(o)&&(o=l):l=o="oninput":s&&Iu.test(o)?o=o.replace(Cu,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[o=l]&&(o="oninputCapture"),i[o]=a}}r=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=mn(n.children).forEach(function(d){d.props.selected=i.value.indexOf(d.props.value)!=-1})),r=="select"&&i.defaultValue!=null&&(i.value=mn(n.children).forEach(function(d){d.props.selected=i.multiple?i.defaultValue.indexOf(d.props.value)!=-1:i.defaultValue==d.props.value})),n.class&&!n.className?(i.class=n.class,Object.defineProperty(i,"className",Uu)):(n.className&&!n.class||n.class&&n.className)&&(i.class=i.className=n.className),e.props=i}(t),t.$$typeof=Tu,Hs&&Hs(t)};var Js=V.__r;V.__r=function(t){Js&&Js(t),t.__c};var Qs=V.diffed;V.diffed=function(t){Qs&&Qs(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value)};function Nu(t){return Object.assign({isLoading:!t,data:void 0,pageInfo:void 0,error:void 0},t||{})}function Bu(t,e,n){e&&n&&"ruleParams"in n&&(e=Object.assign({$$ruleParams:n.ruleParams},e));const r=e?bu(e):null,i=Te(r),s=yt(Nu(t._reactor.getPreviousResult(r))),o=ct(l=>r?t.subscribeQuery(r,f=>{s.current=Object.assign({isLoading:!f,data:void 0,pageInfo:void 0,error:void 0},f),l()}):()=>{},[i]);return{state:Gr(o,()=>s.current),query:r}}function Du(){const t=yt(null);Ae(()=>{n()},[]);function e(r,i){clearTimeout(t.current),t.current=setTimeout(i,r)}function n(){clearTimeout(t.current)}return{set:e,clear:n}}const Lu=1e3;function Fu(t,e,n){Ae(()=>t._core._reactor.subscribeTopic(t.id,e,(i,s)=>{n(i,s)}),[t.id,e])}function Zu(t,e){return Ae(()=>t._core._reactor.joinRoom(t.id),[t.id]),ct(r=>{t._core._reactor.publishTopic({roomType:t.type,roomId:t.id,topic:e,data:r})},[t.id,e])}function qu(t,e={}){var n,r;const[i,s]=$e(()=>{var l;return(l=t._core._reactor.getPresence(t.type,t.id,e))!==null&&l!==void 0?l:{peers:{},isLoading:!0}});Ae(()=>t._core._reactor.subscribePresence(t.type,t.id,e,d=>{s(d)}),[t.id,e.user,(n=e.peers)===null||n===void 0?void 0:n.join(),(r=e.keys)===null||r===void 0?void 0:r.join()]);const o=ct(l=>{t._core._reactor.publishPresence(t.type,t.id,l)},[t.type,t.id]);return qt(()=>Object.assign(Object.assign({},i),{publishPresence:o}),[i,o])}function Vu(t,e,n){Ae(()=>t._core._reactor.joinRoom(t.id,e),[t.id]),Ae(()=>t._core._reactor.publishPresence(t.type,t.id,e),[t.type,t.id,n??JSON.stringify(e)])}function zu(t,e,n={}){const r=Du(),i=wt.usePresence(t,{keys:[e]}),s=qt(()=>{var f;const p=t._core._reactor.getPresence(t.type,t.id);return n!=null&&n.writeOnly?[]:Object.values((f=p==null?void 0:p.peers)!==null&&f!==void 0?f:{}).filter(m=>m[e]===!0)},[n==null?void 0:n.writeOnly,i]),o=ct(f=>{var p;t._core._reactor.publishPresence(t.type,t.id,{[e]:f}),f&&((n==null?void 0:n.timeout)===null||(n==null?void 0:n.timeout)===0||r.set((p=n==null?void 0:n.timeout)!==null&&p!==void 0?p:Lu,()=>{t._core._reactor.publishPresence(t.type,t.id,{[e]:null})}))},[t.type,t.id,e,n==null?void 0:n.timeout,r]),a=ct(f=>{const m=!((n==null?void 0:n.stopOnEnter)&&f.key==="Enter");o(m)},[n.stopOnEnter,o]),l=ct(()=>{o(!1)},[o]),d=qt(()=>({onKeyDown:a,onBlur:l}),[a,l]);return{active:s,setActive:o,inputProps:d}}const wt={useTopicEffect:Fu,usePublishTopic:Zu,usePresence:qu,useSyncPresence:Vu,useTypingIndicator:zu};class Wu{constructor(e,n,r){this.useTopicEffect=(i,s)=>{wt.useTopicEffect(this,i,s)},this.usePublishTopic=i=>wt.usePublishTopic(this,i),this.usePresence=(i={})=>wt.usePresence(this,i),this.useSyncPresence=(i,s)=>wt.useSyncPresence(this,i,s),this.useTypingIndicator=(i,s={})=>wt.useTypingIndicator(this,i,s),this._core=e,this.type=n,this.id=r}}var Ku=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(f){try{d(r.next(f))}catch(p){o(p)}}function l(f){try{d(r.throw(f))}catch(p){o(p)}}function d(f){f.done?s(f.value):i(f.value).then(a,l)}d((r=r.apply(t,e||[])).next())})};class Hu{constructor(e,n){this.tx=Br(),this.getLocalId=r=>this._core.getLocalId(r),this.useLocalId=r=>{const[i,s]=$e(null);return Ae(()=>{Ku(this,void 0,void 0,function*(){const a=yield this.getLocalId(r);s(a)})},[r]),i},this.rooms=wt,this.transact=r=>this._core.transact(r),this.useQuery=(r,i)=>Bu(this._core,r,i).state,this.useAuth=()=>{const r=yt(this._core._reactor._currentUserCached),i=ct(o=>this._core.subscribeAuth(l=>{r.current=Object.assign({isLoading:!1},l),o()}),[]);return Gr(i,()=>r.current)},this.useConnectionStatus=()=>{const r=yt(this._core._reactor.status),i=ct(o=>this._core.subscribeConnectionStatus(l=>{l!==r.current&&(r.current=l,o())}),[]);return Gr(i,()=>r.current)},this.queryOnce=(r,i)=>this._core.queryOnce(r,i),this._core=Su(e,this.constructor.Storage,this.constructor.NetworkListener,n),this.auth=this._core.auth,this.storage=this._core.storage}room(e="_defaultRoomType",n="_defaultRoomId"){return new Wu(this._core,e,n)}getAuth(){return this._core.getAuth()}}class Ju extends Hu{}const Qu="v0.19.6";function Gu(t){return new Ju(t,{"@instantdb/react":Qu})}const xt=t=>t,Yu=t=>async e=>{const n=await fetch(t,{method:"POST",body:JSON.stringify(e)});return n.status!==200?Promise.reject(await n.text()):n.json()},Xu=(t,e)=>n=>t(n);var Y;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},t.getValidEnumValues=i=>{const s=t.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return t.objectValues(o)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},t.find=(i,s)=>{for(const o of i)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=r,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Y||(Y={}));var ei;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(ei||(ei={}));const I=Y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ut=t=>{switch(typeof t){case"undefined":return I.undefined;case"string":return I.string;case"number":return isNaN(t)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(t)?I.array:t===null?I.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?I.promise:typeof Map<"u"&&t instanceof Map?I.map:typeof Set<"u"&&t instanceof Set?I.set:typeof Date<"u"&&t instanceof Date?I.date:I.object;default:return I.unknown}},O=Y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),el=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Ze extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const n=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let a=r,l=0;for(;l<o.path.length;){const d=o.path[l];l===o.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(n(o))):a[d]=a[d]||{_errors:[]},a=a[d],l++}}};return i(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,Y.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const i of this.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Ze.create=t=>new Ze(t);const Yt=(t,e)=>{let n;switch(t.code){case O.invalid_type:t.received===I.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Y.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:n=`Unrecognized key(s) in object: ${Y.joinValues(t.keys,", ")}`;break;case O.invalid_union:n="Invalid input";break;case O.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Y.joinValues(t.options)}`;break;case O.invalid_enum_value:n=`Invalid enum value. Expected ${Y.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:n="Invalid function arguments";break;case O.invalid_return_type:n="Invalid function return type";break;case O.invalid_date:n="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Y.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case O.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case O.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case O.custom:n="Invalid input";break;case O.invalid_intersection_types:n="Intersection results could not be merged";break;case O.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:n="Number must be finite";break;default:n=e.defaultError,Y.assertNever(t)}return{message:n}};let Gs=Yt;function tl(t){Gs=t}function Nn(){return Gs}const Bn=t=>{const{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o={...i,path:s};let a="";const l=r.filter(d=>!!d).slice().reverse();for(const d of l)a=d(o,{data:e,defaultError:a}).message;return{...i,path:s,message:i.message||a}},nl=[];function A(t,e){const n=Bn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Nn(),Yt].filter(r=>!!r)});t.common.issues.push(n)}class xe{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const i of n){if(i.status==="aborted")return L;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const i of n)r.push({key:await i.key,value:await i.value});return xe.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const i of n){const{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return L;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}}const L=Object.freeze({status:"aborted"}),Ys=t=>({status:"dirty",value:t}),Oe=t=>({status:"valid",value:t}),ti=t=>t.status==="aborted",ni=t=>t.status==="dirty",Xt=t=>t.status==="valid",Dn=t=>typeof Promise<"u"&&t instanceof Promise;var U;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(U||(U={}));class Je{constructor(e,n,r,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Xs=(t,e)=>{if(Xt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Ze(t.common.issues);return this._error=n,this._error}}};function q(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>o.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:r??a.defaultError}:{message:n??a.defaultError},description:i}}class z{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ut(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:ut(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new xe,ctx:{common:e.parent.common,data:e.data,parsedType:ut(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Dn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;const i={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ut(e)},s=this._parseSync({data:e,path:i.path,parent:i});return Xs(i,s)}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ut(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(Dn(i)?i:Promise.resolve(i));return Xs(r,s)}refine(e,n){const r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,s)=>{const o=e(i),a=()=>s.addIssue({code:O.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,n){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(e){return new ze({schema:this,typeName:N.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ot.create(this,this._def)}nullable(){return Et.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ve.create(this,this._def)}promise(){return Nt.create(this,this._def)}or(e){return rn.create([this,e],this._def)}and(e){return sn.create(this,e,this._def)}transform(e){return new ze({...q(this._def),schema:this,typeName:N.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ln({...q(this._def),innerType:this,defaultValue:n,typeName:N.ZodDefault})}brand(){return new to({typeName:N.ZodBranded,type:this,...q(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new zn({...q(this._def),innerType:this,catchValue:n,typeName:N.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return dn.create(this,e)}readonly(){return Kn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const rl=/^c[^\s-]{8,}$/i,il=/^[a-z][a-z0-9]*$/,sl=/^[0-9A-HJKMNP-TV-Z]{26}$/,ol=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,al=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,cl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ri;const ul=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ll=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,dl=t=>t.precision?t.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}Z$`):t.precision===0?t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function fl(t,e){return!!((e==="v4"||!e)&&ul.test(t)||(e==="v6"||!e)&&ll.test(t))}class qe extends z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){const s=this._getOrReturnCtx(e);return A(s,{code:O.invalid_type,expected:I.string,received:s.parsedType}),L}const r=new xe;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),A(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),A(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?A(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&A(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")al.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"email",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")ri||(ri=new RegExp(cl,"u")),ri.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"emoji",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")ol.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"uuid",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")rl.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"cuid",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")il.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")sl.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"ulid",code:O.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),A(i,{validation:"url",code:O.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"regex",code:O.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),A(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),A(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),A(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?dl(s).test(e.data)||(i=this._getOrReturnCtx(e,i),A(i,{code:O.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="ip"?fl(e.data,s.version)||(i=this._getOrReturnCtx(e,i),A(i,{validation:"ip",code:O.invalid_string,message:s.message}),r.dirty()):Y.assertNever(s);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(i=>e.test(i),{validation:n,code:O.invalid_string,...U.errToObj(r)})}_addCheck(e){return new qe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...U.errToObj(e)})}url(e){return this._addCheck({kind:"url",...U.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...U.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...U.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...U.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...U.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...U.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...U.errToObj(e)})}datetime(e){var n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,...U.errToObj(e==null?void 0:e.message)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...U.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...U.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...U.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...U.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...U.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...U.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...U.errToObj(n)})}nonempty(e){return this.min(1,U.errToObj(e))}trim(){return new qe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}qe.create=t=>{var e;return new qe({checks:[],typeName:N.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...q(t)})};function hl(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r,s=parseInt(t.toFixed(i).replace(".","")),o=parseInt(e.toFixed(i).replace(".",""));return s%o/Math.pow(10,i)}class lt extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){const s=this._getOrReturnCtx(e);return A(s,{code:O.invalid_type,expected:I.number,received:s.parsedType}),L}let r;const i=new xe;for(const s of this._def.checks)s.kind==="int"?Y.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?hl(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:O.not_finite,message:s.message}),i.dirty()):Y.assertNever(s);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,i){return new lt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(i)}]})}_addCheck(e){return new lt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:U.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:U.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:U.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:U.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Y.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}lt.create=t=>new lt({checks:[],typeName:N.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...q(t)});class dt extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==I.bigint){const s=this._getOrReturnCtx(e);return A(s,{code:O.invalid_type,expected:I.bigint,received:s.parsedType}),L}let r;const i=new xe;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),A(r,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Y.assertNever(s);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,i){return new dt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(i)}]})}_addCheck(e){return new dt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}dt.create=t=>{var e;return new dt({checks:[],typeName:N.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...q(t)})};class en extends z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==I.boolean){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.boolean,received:r.parsedType}),L}return Oe(e.data)}}en.create=t=>new en({typeName:N.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...q(t)});class St extends z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){const s=this._getOrReturnCtx(e);return A(s,{code:O.invalid_type,expected:I.date,received:s.parsedType}),L}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return A(s,{code:O.invalid_date}),L}const r=new xe;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),A(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),A(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Y.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new St({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:U.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:U.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}St.create=t=>new St({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:N.ZodDate,...q(t)});class Ln extends z{_parse(e){if(this._getType(e)!==I.symbol){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.symbol,received:r.parsedType}),L}return Oe(e.data)}}Ln.create=t=>new Ln({typeName:N.ZodSymbol,...q(t)});class tn extends z{_parse(e){if(this._getType(e)!==I.undefined){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.undefined,received:r.parsedType}),L}return Oe(e.data)}}tn.create=t=>new tn({typeName:N.ZodUndefined,...q(t)});class nn extends z{_parse(e){if(this._getType(e)!==I.null){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.null,received:r.parsedType}),L}return Oe(e.data)}}nn.create=t=>new nn({typeName:N.ZodNull,...q(t)});class Mt extends z{constructor(){super(...arguments),this._any=!0}_parse(e){return Oe(e.data)}}Mt.create=t=>new Mt({typeName:N.ZodAny,...q(t)});class kt extends z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Oe(e.data)}}kt.create=t=>new kt({typeName:N.ZodUnknown,...q(t)});class st extends z{_parse(e){const n=this._getOrReturnCtx(e);return A(n,{code:O.invalid_type,expected:I.never,received:n.parsedType}),L}}st.create=t=>new st({typeName:N.ZodNever,...q(t)});class Fn extends z{_parse(e){if(this._getType(e)!==I.undefined){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.void,received:r.parsedType}),L}return Oe(e.data)}}Fn.create=t=>new Fn({typeName:N.ZodVoid,...q(t)});class Ve extends z{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),i=this._def;if(n.parsedType!==I.array)return A(n,{code:O.invalid_type,expected:I.array,received:n.parsedType}),L;if(i.exactLength!==null){const o=n.data.length>i.exactLength.value,a=n.data.length<i.exactLength.value;(o||a)&&(A(n,{code:o?O.too_big:O.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(A(n,{code:O.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(A(n,{code:O.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,a)=>i.type._parseAsync(new Je(n,o,n.path,a)))).then(o=>xe.mergeArray(r,o));const s=[...n.data].map((o,a)=>i.type._parseSync(new Je(n,o,n.path,a)));return xe.mergeArray(r,s)}get element(){return this._def.type}min(e,n){return new Ve({...this._def,minLength:{value:e,message:U.toString(n)}})}max(e,n){return new Ve({...this._def,maxLength:{value:e,message:U.toString(n)}})}length(e,n){return new Ve({...this._def,exactLength:{value:e,message:U.toString(n)}})}nonempty(e){return this.min(1,e)}}Ve.create=(t,e)=>new Ve({type:t,minLength:null,maxLength:null,exactLength:null,typeName:N.ZodArray,...q(e)});function $t(t){if(t instanceof ae){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=ot.create($t(r))}return new ae({...t._def,shape:()=>e})}else return t instanceof Ve?new Ve({...t._def,type:$t(t.element)}):t instanceof ot?ot.create($t(t.unwrap())):t instanceof Et?Et.create($t(t.unwrap())):t instanceof Qe?Qe.create(t.items.map(e=>$t(e))):t}class ae extends z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Y.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==I.object){const d=this._getOrReturnCtx(e);return A(d,{code:O.invalid_type,expected:I.object,received:d.parsedType}),L}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof st&&this._def.unknownKeys==="strip"))for(const d in i.data)o.includes(d)||a.push(d);const l=[];for(const d of o){const f=s[d],p=i.data[d];l.push({key:{status:"valid",value:d},value:f._parse(new Je(i,p,i.path,d)),alwaysSet:d in i.data})}if(this._def.catchall instanceof st){const d=this._def.unknownKeys;if(d==="passthrough")for(const f of a)l.push({key:{status:"valid",value:f},value:{status:"valid",value:i.data[f]}});else if(d==="strict")a.length>0&&(A(i,{code:O.unrecognized_keys,keys:a}),r.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const f of a){const p=i.data[f];l.push({key:{status:"valid",value:f},value:d._parse(new Je(i,p,i.path,f)),alwaysSet:f in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const d=[];for(const f of l){const p=await f.key;d.push({key:p,value:await f.value,alwaysSet:f.alwaysSet})}return d}).then(d=>xe.mergeObjectSync(r,d)):xe.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return U.errToObj,new ae({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var i,s,o,a;const l=(o=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,n,r).message)!==null&&o!==void 0?o:r.defaultError;return n.code==="unrecognized_keys"?{message:(a=U.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new ae({...this._def,unknownKeys:"strip"})}passthrough(){return new ae({...this._def,unknownKeys:"passthrough"})}extend(e){return new ae({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ae({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:N.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ae({...this._def,catchall:e})}pick(e){const n={};return Y.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new ae({...this._def,shape:()=>n})}omit(e){const n={};return Y.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new ae({...this._def,shape:()=>n})}deepPartial(){return $t(this)}partial(e){const n={};return Y.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?n[r]=i:n[r]=i.optional()}),new ae({...this._def,shape:()=>n})}required(e){const n={};return Y.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof ot;)s=s._def.innerType;n[r]=s}}),new ae({...this._def,shape:()=>n})}keyof(){return eo(Y.objectKeys(this.shape))}}ae.create=(t,e)=>new ae({shape:()=>t,unknownKeys:"strip",catchall:st.create(),typeName:N.ZodObject,...q(e)}),ae.strictCreate=(t,e)=>new ae({shape:()=>t,unknownKeys:"strict",catchall:st.create(),typeName:N.ZodObject,...q(e)}),ae.lazycreate=(t,e)=>new ae({shape:t,unknownKeys:"strip",catchall:st.create(),typeName:N.ZodObject,...q(e)});class rn extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function i(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new Ze(a.ctx.common.issues));return A(n,{code:O.invalid_union,unionErrors:o}),L}if(n.common.async)return Promise.all(r.map(async s=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(i);{let s;const o=[];for(const l of r){const d={...n,common:{...n.common,issues:[]},parent:null},f=l._parseSync({data:n.data,path:n.path,parent:d});if(f.status==="valid")return f;f.status==="dirty"&&!s&&(s={result:f,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(l=>new Ze(l));return A(n,{code:O.invalid_union,unionErrors:a}),L}}get options(){return this._def.options}}rn.create=(t,e)=>new rn({options:t,typeName:N.ZodUnion,...q(e)});const Zn=t=>t instanceof an?Zn(t.schema):t instanceof ze?Zn(t.innerType()):t instanceof cn?[t.value]:t instanceof ft?t.options:t instanceof un?Object.keys(t.enum):t instanceof ln?Zn(t._def.innerType):t instanceof tn?[void 0]:t instanceof nn?[null]:null;class qn extends z{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==I.object)return A(n,{code:O.invalid_type,expected:I.object,received:n.parsedType}),L;const r=this.discriminator,i=n.data[r],s=this.optionsMap.get(i);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(A(n,{code:O.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),L)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const i=new Map;for(const s of n){const o=Zn(s.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,s)}}return new qn({typeName:N.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:i,...q(r)})}}function ii(t,e){const n=ut(t),r=ut(e);if(t===e)return{valid:!0,data:t};if(n===I.object&&r===I.object){const i=Y.objectKeys(e),s=Y.objectKeys(t).filter(a=>i.indexOf(a)!==-1),o={...t,...e};for(const a of s){const l=ii(t[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(n===I.array&&r===I.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<t.length;s++){const o=t[s],a=e[s],l=ii(o,a);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return n===I.date&&r===I.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class sn extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=(s,o)=>{if(ti(s)||ti(o))return L;const a=ii(s.value,o.value);return a.valid?((ni(s)||ni(o))&&n.dirty(),{status:n.value,value:a.data}):(A(r,{code:O.invalid_intersection_types}),L)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}sn.create=(t,e,n)=>new sn({left:t,right:e,typeName:N.ZodIntersection,...q(n)});class Qe extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.array)return A(r,{code:O.invalid_type,expected:I.array,received:r.parsedType}),L;if(r.data.length<this._def.items.length)return A(r,{code:O.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),L;!this._def.rest&&r.data.length>this._def.items.length&&(A(r,{code:O.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((o,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new Je(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>xe.mergeArray(n,o)):xe.mergeArray(n,s)}get items(){return this._def.items}rest(e){return new Qe({...this._def,rest:e})}}Qe.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Qe({items:t,typeName:N.ZodTuple,rest:null,...q(e)})};class on extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.object)return A(r,{code:O.invalid_type,expected:I.object,received:r.parsedType}),L;const i=[],s=this._def.keyType,o=this._def.valueType;for(const a in r.data)i.push({key:s._parse(new Je(r,a,r.path,a)),value:o._parse(new Je(r,r.data[a],r.path,a))});return r.common.async?xe.mergeObjectAsync(n,i):xe.mergeObjectSync(n,i)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof z?new on({keyType:e,valueType:n,typeName:N.ZodRecord,...q(r)}):new on({keyType:qe.create(),valueType:e,typeName:N.ZodRecord,...q(n)})}}class Vn extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.map)return A(r,{code:O.invalid_type,expected:I.map,received:r.parsedType}),L;const i=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,l],d)=>({key:i._parse(new Je(r,a,r.path,[d,"key"])),value:s._parse(new Je(r,l,r.path,[d,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of o){const d=await l.key,f=await l.value;if(d.status==="aborted"||f.status==="aborted")return L;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),a.set(d.value,f.value)}return{status:n.value,value:a}})}else{const a=new Map;for(const l of o){const d=l.key,f=l.value;if(d.status==="aborted"||f.status==="aborted")return L;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),a.set(d.value,f.value)}return{status:n.value,value:a}}}}Vn.create=(t,e,n)=>new Vn({valueType:e,keyType:t,typeName:N.ZodMap,...q(n)});class Ot extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.set)return A(r,{code:O.invalid_type,expected:I.set,received:r.parsedType}),L;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(A(r,{code:O.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(A(r,{code:O.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const s=this._def.valueType;function o(l){const d=new Set;for(const f of l){if(f.status==="aborted")return L;f.status==="dirty"&&n.dirty(),d.add(f.value)}return{status:n.value,value:d}}const a=[...r.data.values()].map((l,d)=>s._parse(new Je(r,l,r.path,d)));return r.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,n){return new Ot({...this._def,minSize:{value:e,message:U.toString(n)}})}max(e,n){return new Ot({...this._def,maxSize:{value:e,message:U.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Ot.create=(t,e)=>new Ot({valueType:t,minSize:null,maxSize:null,typeName:N.ZodSet,...q(e)});class Ut extends z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==I.function)return A(n,{code:O.invalid_type,expected:I.function,received:n.parsedType}),L;function r(a,l){return Bn({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Nn(),Yt].filter(d=>!!d),issueData:{code:O.invalid_arguments,argumentsError:l}})}function i(a,l){return Bn({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Nn(),Yt].filter(d=>!!d),issueData:{code:O.invalid_return_type,returnTypeError:l}})}const s={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof Nt){const a=this;return Oe(async function(...l){const d=new Ze([]),f=await a._def.args.parseAsync(l,s).catch(v=>{throw d.addIssue(r(l,v)),d}),p=await Reflect.apply(o,this,f);return await a._def.returns._def.type.parseAsync(p,s).catch(v=>{throw d.addIssue(i(p,v)),d})})}else{const a=this;return Oe(function(...l){const d=a._def.args.safeParse(l,s);if(!d.success)throw new Ze([r(l,d.error)]);const f=Reflect.apply(o,this,d.data),p=a._def.returns.safeParse(f,s);if(!p.success)throw new Ze([i(f,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ut({...this._def,args:Qe.create(e).rest(kt.create())})}returns(e){return new Ut({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new Ut({args:e||Qe.create([]).rest(kt.create()),returns:n||kt.create(),typeName:N.ZodFunction,...q(r)})}}class an extends z{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}an.create=(t,e)=>new an({getter:t,typeName:N.ZodLazy,...q(e)});class cn extends z{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return A(n,{received:n.data,code:O.invalid_literal,expected:this._def.value}),L}return{status:"valid",value:e.data}}get value(){return this._def.value}}cn.create=(t,e)=>new cn({value:t,typeName:N.ZodLiteral,...q(e)});function eo(t,e){return new ft({values:t,typeName:N.ZodEnum,...q(e)})}class ft extends z{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return A(n,{expected:Y.joinValues(r),received:n.parsedType,code:O.invalid_type}),L}if(this._def.values.indexOf(e.data)===-1){const n=this._getOrReturnCtx(e),r=this._def.values;return A(n,{received:n.data,code:O.invalid_enum_value,options:r}),L}return Oe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e){return ft.create(e)}exclude(e){return ft.create(this.options.filter(n=>!e.includes(n)))}}ft.create=eo;class un extends z{_parse(e){const n=Y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==I.string&&r.parsedType!==I.number){const i=Y.objectValues(n);return A(r,{expected:Y.joinValues(i),received:r.parsedType,code:O.invalid_type}),L}if(n.indexOf(e.data)===-1){const i=Y.objectValues(n);return A(r,{received:r.data,code:O.invalid_enum_value,options:i}),L}return Oe(e.data)}get enum(){return this._def.values}}un.create=(t,e)=>new un({values:t,typeName:N.ZodNativeEnum,...q(e)});class Nt extends z{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==I.promise&&n.common.async===!1)return A(n,{code:O.invalid_type,expected:I.promise,received:n.parsedType}),L;const r=n.parsedType===I.promise?n.data:Promise.resolve(n.data);return Oe(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Nt.create=(t,e)=>new Nt({type:t,typeName:N.ZodPromise,...q(e)});class ze extends z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===N.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:o=>{A(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const o=i.transform(r.data,s);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(o).then(a=>this._def.schema._parseAsync({data:a,path:r.path,parent:r})):this._def.schema._parseSync({data:o,path:r.path,parent:r})}if(i.type==="refinement"){const o=a=>{const l=i.refinement(a,s);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?L:(a.status==="dirty"&&n.dirty(),o(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?L:(a.status==="dirty"&&n.dirty(),o(a.value).then(()=>({status:n.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Xt(o))return o;const a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>Xt(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:n.value,value:a})):o);Y.assertNever(i)}}ze.create=(t,e,n)=>new ze({schema:t,typeName:N.ZodEffects,effect:e,...q(n)}),ze.createWithPreprocess=(t,e,n)=>new ze({schema:e,effect:{type:"preprocess",transform:t},typeName:N.ZodEffects,...q(n)});class ot extends z{_parse(e){return this._getType(e)===I.undefined?Oe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ot.create=(t,e)=>new ot({innerType:t,typeName:N.ZodOptional,...q(e)});class Et extends z{_parse(e){return this._getType(e)===I.null?Oe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Et.create=(t,e)=>new Et({innerType:t,typeName:N.ZodNullable,...q(e)});class ln extends z{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===I.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ln.create=(t,e)=>new ln({innerType:t,typeName:N.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...q(e)});class zn extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Dn(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ze(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ze(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}zn.create=(t,e)=>new zn({innerType:t,typeName:N.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...q(e)});class Wn extends z{_parse(e){if(this._getType(e)!==I.nan){const r=this._getOrReturnCtx(e);return A(r,{code:O.invalid_type,expected:I.nan,received:r.parsedType}),L}return{status:"valid",value:e.data}}}Wn.create=t=>new Wn({typeName:N.ZodNaN,...q(t)});const pl=Symbol("zod_brand");class to extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class dn extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?L:s.status==="dirty"?(n.dirty(),Ys(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?L:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,n){return new dn({in:e,out:n,typeName:N.ZodPipeline})}}class Kn extends z{_parse(e){const n=this._def.innerType._parse(e);return Xt(n)&&(n.value=Object.freeze(n.value)),n}}Kn.create=(t,e)=>new Kn({innerType:t,typeName:N.ZodReadonly,...q(e)});const no=(t,e={},n)=>t?Mt.create().superRefine((r,i)=>{var s,o;if(!t(r)){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,l=(o=(s=a.fatal)!==null&&s!==void 0?s:n)!==null&&o!==void 0?o:!0,d=typeof a=="string"?{message:a}:a;i.addIssue({code:"custom",...d,fatal:l})}}):Mt.create(),_l={object:ae.lazycreate};var N;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(N||(N={}));const yl=(t,e={message:`Input not instance of ${t.name}`})=>no(n=>n instanceof t,e),ro=qe.create,io=lt.create,ml=Wn.create,gl=dt.create,so=en.create,vl=St.create,bl=Ln.create,wl=tn.create,xl=nn.create,Sl=Mt.create,kl=kt.create,Ol=st.create,El=Fn.create,Tl=Ve.create,Il=ae.create,Al=ae.strictCreate,Cl=rn.create,jl=qn.create,Rl=sn.create,Pl=Qe.create,Ml=on.create,$l=Vn.create,Ul=Ot.create,Nl=Ut.create,Bl=an.create,Dl=cn.create,Ll=ft.create,Fl=un.create,Zl=Nt.create,oo=ze.create,ql=ot.create,Vl=Et.create,zl=ze.createWithPreprocess,Wl=dn.create;var B=Object.freeze({__proto__:null,defaultErrorMap:Yt,setErrorMap:tl,getErrorMap:Nn,makeIssue:Bn,EMPTY_PATH:nl,addIssueToContext:A,ParseStatus:xe,INVALID:L,DIRTY:Ys,OK:Oe,isAborted:ti,isDirty:ni,isValid:Xt,isAsync:Dn,get util(){return Y},get objectUtil(){return ei},ZodParsedType:I,getParsedType:ut,ZodType:z,ZodString:qe,ZodNumber:lt,ZodBigInt:dt,ZodBoolean:en,ZodDate:St,ZodSymbol:Ln,ZodUndefined:tn,ZodNull:nn,ZodAny:Mt,ZodUnknown:kt,ZodNever:st,ZodVoid:Fn,ZodArray:Ve,ZodObject:ae,ZodUnion:rn,ZodDiscriminatedUnion:qn,ZodIntersection:sn,ZodTuple:Qe,ZodRecord:on,ZodMap:Vn,ZodSet:Ot,ZodFunction:Ut,ZodLazy:an,ZodLiteral:cn,ZodEnum:ft,ZodNativeEnum:un,ZodPromise:Nt,ZodEffects:ze,ZodTransformer:ze,ZodOptional:ot,ZodNullable:Et,ZodDefault:ln,ZodCatch:zn,ZodNaN:Wn,BRAND:pl,ZodBranded:to,ZodPipeline:dn,ZodReadonly:Kn,custom:no,Schema:z,ZodSchema:z,late:_l,get ZodFirstPartyTypeKind(){return N},coerce:{string:t=>qe.create({...t,coerce:!0}),number:t=>lt.create({...t,coerce:!0}),boolean:t=>en.create({...t,coerce:!0}),bigint:t=>dt.create({...t,coerce:!0}),date:t=>St.create({...t,coerce:!0})},any:Sl,array:Tl,bigint:gl,boolean:so,date:vl,discriminatedUnion:jl,effect:oo,enum:Ll,function:Nl,instanceof:yl,intersection:Rl,lazy:Bl,literal:Dl,map:$l,nan:ml,nativeEnum:Fl,never:Ol,null:xl,nullable:Vl,number:io,object:Il,oboolean:()=>so().optional(),onumber:()=>io().optional(),optional:ql,ostring:()=>ro().optional(),pipeline:Wl,preprocess:zl,promise:Zl,record:Ml,set:Ul,strictObject:Al,string:ro,symbol:bl,transformer:oo,tuple:Pl,undefined:wl,union:Cl,unknown:kl,void:El,NEVER:L,ZodIssueCode:O,quotelessJson:el,ZodError:Ze});xt({authRequired:!1,input:B.object({conversationId:B.string(),publicSignKey:B.string()}),output:B.union([B.object({conversationKey:B.string()}),B.object({error:B.literal("no-such-key")})])}),xt({authRequired:!1,input:B.object({publicSignKeyToEncryptedSymmetricKey:B.record(B.string(),B.string()),title:B.string()}),output:B.union([B.object({conversationId:B.string()}),B.object({error:B.enum(["invalid-participants","must-own-an-identity"])})])}),xt({authRequired:!1,input:B.object({}),output:B.object({success:B.literal(!0),accountId:B.string(),accessToken:B.string()})}),xt({authRequired:!1,input:B.object({name:B.string(),publicSignKey:B.string(),publicEncryptKey:B.string()}),output:B.object({})}),xt({authRequired:!0,input:B.object({publicSignKey:B.string(),publicEncryptKey:B.string()}),output:B.object({})}),xt({authRequired:!1,input:B.object({encryptedMessage:B.string(),conversation:B.string()}),output:B.object({messageId:B.string()})}),xt({authRequired:!1,input:B.object({url:B.string(),publicSignKey:B.string()}),output:B.union([B.object({success:B.literal(!0)}),B.object({success:B.literal(!1),error:B.literal("identity-does-not-exist")})])});const si=Xu(Yu("https://alice-and-bot.deno.dev")),Kl=t=>({publicSignKey:e})=>{const{data:n,error:r}=t.useQuery({conversations:{participants:{},$:{where:{"participants.publicSignKey":e}}}});return r&&console.error("Error fetching conversations:",r),(n==null?void 0:n.conversations)??[]},Hn=t=>typeof(t==null?void 0:t.then)=="function"&&typeof(t==null?void 0:t.catch)=="function"&&typeof(t==null?void 0:t.finally)=="function",ao=t=>t[0],Hl=t=>t[1],Jl=t=>[t],co=(t,e,n,r)=>{let i=e;for(let s=r;s<n.length;s++){if(Hn(i))return i.then(o=>co(t,o,n,s));i=t(i,n[s])}return i},Ql=(t,e)=>n=>co(t,e(),n,0),Gl=({line:t,file:e,column:n})=>`${e}:${t}:${n}`,Yl=t=>{const e=/\s+at\s+(.+\s)?\(?(.+):(\d+):(\d+)\)?/.exec(t)||/(.+)@(.+):(\d+):(\d+)/g.exec(t);if(!e)return null;const[,,n,r,i]=e;return{file:n,line:parseInt(r),column:parseInt(i)}},Xl=(t,e)=>Yl(e(t.split(`
`))),ed=t=>{const e=Xl(new Error().stack,n=>n[t]);return e?Gl(e):"stack line could not be parsed"},td=(...t)=>(...e)=>Ql((n,r)=>r(n),()=>t[0](...e))(t.slice(1)),uo=t=>e=>{if(e===void 0)throw console.error(`undefined error within ${t}`),e;try{e.message=(e.message?e.message+`
`:"")+t}catch(n){console.error(`error within ${t}, gamla could not augment error stack`,n,e)}throw e},lo=t=>{const e=ed(4);return(...n)=>{try{const r=t(...n);return Hn(r)?r.catch(uo(e)):r}catch(r){uo(e)(r)}}},ht=(...t)=>lo(td(...t)),nd=t=>t,rd=t=>e=>{const n=[];for(const r of e)n.push(t(r));return n.some(Hn)?Promise.all(n):n},Bt=(...t)=>lo(rd(...t)),id=(...t)=>(...e)=>{const n=[];let r=!1;for(const i of t)n.push(i(...e)),r=r||Hn(n[n.length-1]);return r?Promise.all(n):n},sd=t=>id(nd,t),od=t=>ht(Bt(sd(t)),e=>e.filter(Hl),Bt(ao));/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;const ad=new TextEncoder().encode("0123456789abcdef"),fo=new Uint8Array(128).fill(16);ad.forEach((t,e)=>fo[t]=e),new TextEncoder().encode("ABCDEF").forEach((t,e)=>fo[t]=e+10);const cd=new TextEncoder().encode("0123456789abcdef"),ho=new Uint8Array(128).fill(16);cd.forEach((t,e)=>ho[t]=e),new TextEncoder().encode("ABCDEF").forEach((t,e)=>ho[t]=e+10);const ud=(t,e,n)=>r=>{const i={};for(const s of r)for(const o of t(s))i[o]=e(o in i?i[o]:n(),s);return i};((t,e,n)=>ud(ht(t,Jl),e,n))(ao,(t,[e,n])=>(t.add(n),t),()=>new Set);const po=t=>ht(Object.entries,t,Object.fromEntries);ht(Bt,po),ht(od,po);function ld(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oi={exports:{}};(function(t,e){const{hasOwnProperty:n}=Object.prototype,r=E();r.configure=E,r.stringify=r,r.default=r,e.stringify=r,e.configure=E,t.exports=r;const i=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function s(w){return w.length<5e3&&!i.test(w)?`"${w}"`:JSON.stringify(w)}function o(w,k){if(w.length>200||k)return w.sort(k);for(let P=1;P<w.length;P++){const M=w[P];let W=P;for(;W!==0&&w[W-1]>M;)w[W]=w[W-1],W--;w[W]=M}return w}const a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function l(w){return a.call(w)!==void 0&&w.length!==0}function d(w,k,P){w.length<P&&(P=w.length);const M=k===","?"":" ";let W=`"0":${M}${w[0]}`;for(let X=1;X<P;X++)W+=`${k}"${X}":${M}${w[X]}`;return W}function f(w){if(n.call(w,"circularValue")){const k=w.circularValue;if(typeof k=="string")return`"${k}"`;if(k==null)return k;if(k===Error||k===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function p(w){let k;if(n.call(w,"deterministic")&&(k=w.deterministic,typeof k!="boolean"&&typeof k!="function"))throw new TypeError('The "deterministic" argument must be of type boolean or comparator function');return k===void 0?!0:k}function m(w,k){let P;if(n.call(w,k)&&(P=w[k],typeof P!="boolean"))throw new TypeError(`The "${k}" argument must be of type boolean`);return P===void 0?!0:P}function v(w,k){let P;if(n.call(w,k)){if(P=w[k],typeof P!="number")throw new TypeError(`The "${k}" argument must be of type number`);if(!Number.isInteger(P))throw new TypeError(`The "${k}" argument must be an integer`);if(P<1)throw new RangeError(`The "${k}" argument must be >= 1`)}return P===void 0?1/0:P}function S(w){return w===1?"1 item":`${w} items`}function T(w){const k=new Set;for(const P of w)(typeof P=="string"||typeof P=="number")&&k.add(String(P));return k}function R(w){if(n.call(w,"strict")){const k=w.strict;if(typeof k!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(k)return P=>{let M=`Object can not safely be stringified. Received type ${typeof P}`;throw typeof P!="function"&&(M+=` (${P.toString()})`),new Error(M)}}}function E(w){w={...w};const k=R(w);k&&(w.bigint===void 0&&(w.bigint=!1),"circularValue"in w||(w.circularValue=Error));const P=f(w),M=m(w,"bigint"),W=p(w),X=typeof W=="function"?W:void 0,ne=v(w,"maximumDepth"),Q=v(w,"maximumBreadth");function Ne(le,b,j,F,D,Z){let C=b[le];switch(typeof C=="object"&&C!==null&&typeof C.toJSON=="function"&&(C=C.toJSON(le)),C=F.call(b,le,C),typeof C){case"string":return s(C);case"object":{if(C===null)return"null";if(j.indexOf(C)!==-1)return P;let $="",re=",";const ie=Z;if(Array.isArray(C)){if(C.length===0)return"[]";if(ne<j.length+1)return'"[Array]"';j.push(C),D!==""&&(Z+=D,$+=`
${Z}`,re=`,
${Z}`);const be=Math.min(C.length,Q);let Be=0;for(;Be<be-1;Be++){const We=Ne(String(Be),C,j,F,D,Z);$+=We!==void 0?We:"null",$+=re}const Me=Ne(String(Be),C,j,F,D,Z);if($+=Me!==void 0?Me:"null",C.length-1>Q){const We=C.length-Q-1;$+=`${re}"... ${S(We)} not stringified"`}return D!==""&&($+=`
${ie}`),j.pop(),`[${$}]`}let ee=Object.keys(C);const se=ee.length;if(se===0)return"{}";if(ne<j.length+1)return'"[Object]"';let J="",de="";D!==""&&(Z+=D,re=`,
${Z}`,J=" ");const Ee=Math.min(se,Q);W&&!l(C)&&(ee=o(ee,X)),j.push(C);for(let be=0;be<Ee;be++){const Be=ee[be],Me=Ne(Be,C,j,F,D,Z);Me!==void 0&&($+=`${de}${s(Be)}:${J}${Me}`,de=re)}if(se>Q){const be=se-Q;$+=`${de}"...":${J}"${S(be)} not stringified"`,de=re}return D!==""&&de.length>1&&($=`
${Z}${$}
${ie}`),j.pop(),`{${$}}`}case"number":return isFinite(C)?String(C):k?k(C):"null";case"boolean":return C===!0?"true":"false";case"undefined":return;case"bigint":if(M)return String(C);default:return k?k(C):void 0}}function me(le,b,j,F,D,Z){switch(typeof b=="object"&&b!==null&&typeof b.toJSON=="function"&&(b=b.toJSON(le)),typeof b){case"string":return s(b);case"object":{if(b===null)return"null";if(j.indexOf(b)!==-1)return P;const C=Z;let $="",re=",";if(Array.isArray(b)){if(b.length===0)return"[]";if(ne<j.length+1)return'"[Array]"';j.push(b),D!==""&&(Z+=D,$+=`
${Z}`,re=`,
${Z}`);const se=Math.min(b.length,Q);let J=0;for(;J<se-1;J++){const Ee=me(String(J),b[J],j,F,D,Z);$+=Ee!==void 0?Ee:"null",$+=re}const de=me(String(J),b[J],j,F,D,Z);if($+=de!==void 0?de:"null",b.length-1>Q){const Ee=b.length-Q-1;$+=`${re}"... ${S(Ee)} not stringified"`}return D!==""&&($+=`
${C}`),j.pop(),`[${$}]`}j.push(b);let ie="";D!==""&&(Z+=D,re=`,
${Z}`,ie=" ");let ee="";for(const se of F){const J=me(se,b[se],j,F,D,Z);J!==void 0&&($+=`${ee}${s(se)}:${ie}${J}`,ee=re)}return D!==""&&ee.length>1&&($=`
${Z}${$}
${C}`),j.pop(),`{${$}}`}case"number":return isFinite(b)?String(b):k?k(b):"null";case"boolean":return b===!0?"true":"false";case"undefined":return;case"bigint":if(M)return String(b);default:return k?k(b):void 0}}function ye(le,b,j,F,D){switch(typeof b){case"string":return s(b);case"object":{if(b===null)return"null";if(typeof b.toJSON=="function"){if(b=b.toJSON(le),typeof b!="object")return ye(le,b,j,F,D);if(b===null)return"null"}if(j.indexOf(b)!==-1)return P;const Z=D;if(Array.isArray(b)){if(b.length===0)return"[]";if(ne<j.length+1)return'"[Array]"';j.push(b),D+=F;let J=`
${D}`;const de=`,
${D}`,Ee=Math.min(b.length,Q);let be=0;for(;be<Ee-1;be++){const Me=ye(String(be),b[be],j,F,D);J+=Me!==void 0?Me:"null",J+=de}const Be=ye(String(be),b[be],j,F,D);if(J+=Be!==void 0?Be:"null",b.length-1>Q){const Me=b.length-Q-1;J+=`${de}"... ${S(Me)} not stringified"`}return J+=`
${Z}`,j.pop(),`[${J}]`}let C=Object.keys(b);const $=C.length;if($===0)return"{}";if(ne<j.length+1)return'"[Object]"';D+=F;const re=`,
${D}`;let ie="",ee="",se=Math.min($,Q);l(b)&&(ie+=d(b,re,Q),C=C.slice(b.length),se-=b.length,ee=re),W&&(C=o(C,X)),j.push(b);for(let J=0;J<se;J++){const de=C[J],Ee=ye(de,b[de],j,F,D);Ee!==void 0&&(ie+=`${ee}${s(de)}: ${Ee}`,ee=re)}if($>Q){const J=$-Q;ie+=`${ee}"...": "${S(J)} not stringified"`,ee=re}return ee!==""&&(ie=`
${D}${ie}
${Z}`),j.pop(),`{${ie}}`}case"number":return isFinite(b)?String(b):k?k(b):"null";case"boolean":return b===!0?"true":"false";case"undefined":return;case"bigint":if(M)return String(b);default:return k?k(b):void 0}}function Ye(le,b,j){switch(typeof b){case"string":return s(b);case"object":{if(b===null)return"null";if(typeof b.toJSON=="function"){if(b=b.toJSON(le),typeof b!="object")return Ye(le,b,j);if(b===null)return"null"}if(j.indexOf(b)!==-1)return P;let F="";const D=b.length!==void 0;if(D&&Array.isArray(b)){if(b.length===0)return"[]";if(ne<j.length+1)return'"[Array]"';j.push(b);const ie=Math.min(b.length,Q);let ee=0;for(;ee<ie-1;ee++){const J=Ye(String(ee),b[ee],j);F+=J!==void 0?J:"null",F+=","}const se=Ye(String(ee),b[ee],j);if(F+=se!==void 0?se:"null",b.length-1>Q){const J=b.length-Q-1;F+=`,"... ${S(J)} not stringified"`}return j.pop(),`[${F}]`}let Z=Object.keys(b);const C=Z.length;if(C===0)return"{}";if(ne<j.length+1)return'"[Object]"';let $="",re=Math.min(C,Q);D&&l(b)&&(F+=d(b,",",Q),Z=Z.slice(b.length),re-=b.length,$=","),W&&(Z=o(Z,X)),j.push(b);for(let ie=0;ie<re;ie++){const ee=Z[ie],se=Ye(ee,b[ee],j);se!==void 0&&(F+=`${$}${s(ee)}:${se}`,$=",")}if(C>Q){const ie=C-Q;F+=`${$}"...":"${S(ie)} not stringified"`}return j.pop(),`{${F}}`}case"number":return isFinite(b)?String(b):k?k(b):"null";case"boolean":return b===!0?"true":"false";case"undefined":return;case"bigint":if(M)return String(b);default:return k?k(b):void 0}}function Tt(le,b,j){if(arguments.length>1){let F="";if(typeof j=="number"?F=" ".repeat(Math.min(j,10)):typeof j=="string"&&(F=j.slice(0,10)),b!=null){if(typeof b=="function")return Ne("",{"":le},[],b,F,"");if(Array.isArray(b))return me("",le,[],T(b),F,"")}if(F.length!==0)return ye("",le,[],F,"")}return Ye("",le,[])}return Tt}})(oi,oi.exports);var dd=oi.exports;const _o=ld(dd);_o.configure;var at={},Jn={};Jn.byteLength=pd,Jn.toByteArray=yd,Jn.fromByteArray=vd;for(var Ge=[],Ue=[],fd=typeof Uint8Array<"u"?Uint8Array:Array,ai="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dt=0,hd=ai.length;Dt<hd;++Dt)Ge[Dt]=ai[Dt],Ue[ai.charCodeAt(Dt)]=Dt;Ue[45]=62,Ue[95]=63;function yo(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function pd(t){var e=yo(t),n=e[0],r=e[1];return(n+r)*3/4-r}function _d(t,e,n){return(e+n)*3/4-n}function yd(t){var e,n=yo(t),r=n[0],i=n[1],s=new fd(_d(t,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)e=Ue[t.charCodeAt(l)]<<18|Ue[t.charCodeAt(l+1)]<<12|Ue[t.charCodeAt(l+2)]<<6|Ue[t.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Ue[t.charCodeAt(l)]<<2|Ue[t.charCodeAt(l+1)]>>4,s[o++]=e&255),i===1&&(e=Ue[t.charCodeAt(l)]<<10|Ue[t.charCodeAt(l+1)]<<4|Ue[t.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function md(t){return Ge[t>>18&63]+Ge[t>>12&63]+Ge[t>>6&63]+Ge[t&63]}function gd(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(md(r));return i.join("")}function vd(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(gd(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Ge[e>>2]+Ge[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Ge[e>>10]+Ge[e>>4&63]+Ge[e<<2&63]+"=")),i.join("")}var ci={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ci.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,l=(1<<a)-1,d=l>>1,f=-7,p=n?i-1:0,m=n?-1:1,v=t[e+p];for(p+=m,s=v&(1<<-f)-1,v>>=-f,f+=a;f>0;s=s*256+t[e+p],p+=m,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=r;f>0;o=o*256+t[e+p],p+=m,f-=8);if(s===0)s=1-d;else{if(s===l)return o?NaN:(v?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-d}return(v?-1:1)*o*Math.pow(2,s-r)},ci.write=function(t,e,n,r,i,s){var o,a,l,d=s*8-i-1,f=(1<<d)-1,p=f>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=r?0:s-1,S=r?1:-1,T=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+p>=1?e+=m/l:e+=m*Math.pow(2,1-p),e*l>=2&&(o++,l/=2),o+p>=f?(a=0,o=f):o+p>=1?(a=(e*l-1)*Math.pow(2,i),o=o+p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),o=0));i>=8;t[n+v]=a&255,v+=S,a/=256,i-=8);for(o=o<<i|a,d+=i;d>0;t[n+v]=o&255,v+=S,o/=256,d-=8);t[n+v-S]|=T*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Jn,n=ci,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=w,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const h=new Uint8Array(1),c={foo:function(){return 42}};return Object.setPrototypeOf(c,Uint8Array.prototype),Object.setPrototypeOf(h,c),h.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(h){if(h>i)throw new RangeError('The value "'+h+'" is invalid for option "size"');const c=new Uint8Array(h);return Object.setPrototypeOf(c,a.prototype),c}function a(h,c,u){if(typeof h=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(h)}return l(h,c,u)}a.poolSize=8192;function l(h,c,u){if(typeof h=="string")return m(h,c);if(ArrayBuffer.isView(h))return S(h);if(h==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(Xe(h,ArrayBuffer)||h&&Xe(h.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Xe(h,SharedArrayBuffer)||h&&Xe(h.buffer,SharedArrayBuffer)))return T(h,c,u);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const _=h.valueOf&&h.valueOf();if(_!=null&&_!==h)return a.from(_,c,u);const y=R(h);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return a.from(h[Symbol.toPrimitive]("string"),c,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}a.from=function(h,c,u){return l(h,c,u)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function f(h,c,u){return d(h),h<=0?o(h):c!==void 0?typeof u=="string"?o(h).fill(c,u):o(h).fill(c):o(h)}a.alloc=function(h,c,u){return f(h,c,u)};function p(h){return d(h),o(h<0?0:E(h)|0)}a.allocUnsafe=function(h){return p(h)},a.allocUnsafeSlow=function(h){return p(h)};function m(h,c){if((typeof c!="string"||c==="")&&(c="utf8"),!a.isEncoding(c))throw new TypeError("Unknown encoding: "+c);const u=k(h,c)|0;let _=o(u);const y=_.write(h,c);return y!==u&&(_=_.slice(0,y)),_}function v(h){const c=h.length<0?0:E(h.length)|0,u=o(c);for(let _=0;_<c;_+=1)u[_]=h[_]&255;return u}function S(h){if(Xe(h,Uint8Array)){const c=new Uint8Array(h);return T(c.buffer,c.byteOffset,c.byteLength)}return v(h)}function T(h,c,u){if(c<0||h.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<c+(u||0))throw new RangeError('"length" is outside of buffer bounds');let _;return c===void 0&&u===void 0?_=new Uint8Array(h):u===void 0?_=new Uint8Array(h,c):_=new Uint8Array(h,c,u),Object.setPrototypeOf(_,a.prototype),_}function R(h){if(a.isBuffer(h)){const c=E(h.length)|0,u=o(c);return u.length===0||h.copy(u,0,0,c),u}if(h.length!==void 0)return typeof h.length!="number"||fi(h.length)?o(0):v(h);if(h.type==="Buffer"&&Array.isArray(h.data))return v(h.data)}function E(h){if(h>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return h|0}function w(h){return+h!=h&&(h=0),a.alloc(+h)}a.isBuffer=function(c){return c!=null&&c._isBuffer===!0&&c!==a.prototype},a.compare=function(c,u){if(Xe(c,Uint8Array)&&(c=a.from(c,c.offset,c.byteLength)),Xe(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(c)||!a.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(c===u)return 0;let _=c.length,y=u.length;for(let g=0,x=Math.min(_,y);g<x;++g)if(c[g]!==u[g]){_=c[g],y=u[g];break}return _<y?-1:y<_?1:0},a.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(c,u){if(!Array.isArray(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return a.alloc(0);let _;if(u===void 0)for(u=0,_=0;_<c.length;++_)u+=c[_].length;const y=a.allocUnsafe(u);let g=0;for(_=0;_<c.length;++_){let x=c[_];if(Xe(x,Uint8Array))g+x.length>y.length?(a.isBuffer(x)||(x=a.from(x)),x.copy(y,g)):Uint8Array.prototype.set.call(y,x,g);else if(a.isBuffer(x))x.copy(y,g);else throw new TypeError('"list" argument must be an Array of Buffers');g+=x.length}return y};function k(h,c){if(a.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||Xe(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);const u=h.length,_=arguments.length>2&&arguments[2]===!0;if(!_&&u===0)return 0;let y=!1;for(;;)switch(c){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return di(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Oo(h).length;default:if(y)return _?-1:di(h).length;c=(""+c).toLowerCase(),y=!0}}a.byteLength=k;function P(h,c,u){let _=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,c>>>=0,u<=c))return"";for(h||(h="utf8");;)switch(h){case"hex":return D(this,c,u);case"utf8":case"utf-8":return Tt(this,c,u);case"ascii":return j(this,c,u);case"latin1":case"binary":return F(this,c,u);case"base64":return Ye(this,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,c,u);default:if(_)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),_=!0}}a.prototype._isBuffer=!0;function M(h,c,u){const _=h[c];h[c]=h[u],h[u]=_}a.prototype.swap16=function(){const c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<c;u+=2)M(this,u,u+1);return this},a.prototype.swap32=function(){const c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<c;u+=4)M(this,u,u+3),M(this,u+1,u+2);return this},a.prototype.swap64=function(){const c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<c;u+=8)M(this,u,u+7),M(this,u+1,u+6),M(this,u+2,u+5),M(this,u+3,u+4);return this},a.prototype.toString=function(){const c=this.length;return c===0?"":arguments.length===0?Tt(this,0,c):P.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(c){if(!a.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:a.compare(this,c)===0},a.prototype.inspect=function(){let c="";const u=t.INSPECT_MAX_BYTES;return c=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(c+=" ... "),"<Buffer "+c+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(c,u,_,y,g){if(Xe(c,Uint8Array)&&(c=a.from(c,c.offset,c.byteLength)),!a.isBuffer(c))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof c);if(u===void 0&&(u=0),_===void 0&&(_=c?c.length:0),y===void 0&&(y=0),g===void 0&&(g=this.length),u<0||_>c.length||y<0||g>this.length)throw new RangeError("out of range index");if(y>=g&&u>=_)return 0;if(y>=g)return-1;if(u>=_)return 1;if(u>>>=0,_>>>=0,y>>>=0,g>>>=0,this===c)return 0;let x=g-y,K=_-u;const fe=Math.min(x,K),oe=this.slice(y,g),he=c.slice(u,_);for(let te=0;te<fe;++te)if(oe[te]!==he[te]){x=oe[te],K=he[te];break}return x<K?-1:K<x?1:0};function W(h,c,u,_,y){if(h.length===0)return-1;if(typeof u=="string"?(_=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,fi(u)&&(u=y?0:h.length-1),u<0&&(u=h.length+u),u>=h.length){if(y)return-1;u=h.length-1}else if(u<0)if(y)u=0;else return-1;if(typeof c=="string"&&(c=a.from(c,_)),a.isBuffer(c))return c.length===0?-1:X(h,c,u,_,y);if(typeof c=="number")return c=c&255,typeof Uint8Array.prototype.indexOf=="function"?y?Uint8Array.prototype.indexOf.call(h,c,u):Uint8Array.prototype.lastIndexOf.call(h,c,u):X(h,[c],u,_,y);throw new TypeError("val must be string, number or Buffer")}function X(h,c,u,_,y){let g=1,x=h.length,K=c.length;if(_!==void 0&&(_=String(_).toLowerCase(),_==="ucs2"||_==="ucs-2"||_==="utf16le"||_==="utf-16le")){if(h.length<2||c.length<2)return-1;g=2,x/=2,K/=2,u/=2}function fe(he,te){return g===1?he[te]:he.readUInt16BE(te*g)}let oe;if(y){let he=-1;for(oe=u;oe<x;oe++)if(fe(h,oe)===fe(c,he===-1?0:oe-he)){if(he===-1&&(he=oe),oe-he+1===K)return he*g}else he!==-1&&(oe-=oe-he),he=-1}else for(u+K>x&&(u=x-K),oe=u;oe>=0;oe--){let he=!0;for(let te=0;te<K;te++)if(fe(h,oe+te)!==fe(c,te)){he=!1;break}if(he)return oe}return-1}a.prototype.includes=function(c,u,_){return this.indexOf(c,u,_)!==-1},a.prototype.indexOf=function(c,u,_){return W(this,c,u,_,!0)},a.prototype.lastIndexOf=function(c,u,_){return W(this,c,u,_,!1)};function ne(h,c,u,_){u=Number(u)||0;const y=h.length-u;_?(_=Number(_),_>y&&(_=y)):_=y;const g=c.length;_>g/2&&(_=g/2);let x;for(x=0;x<_;++x){const K=parseInt(c.substr(x*2,2),16);if(fi(K))return x;h[u+x]=K}return x}function Q(h,c,u,_){return er(di(c,h.length-u),h,u,_)}function Ne(h,c,u,_){return er(sf(c),h,u,_)}function me(h,c,u,_){return er(Oo(c),h,u,_)}function ye(h,c,u,_){return er(of(c,h.length-u),h,u,_)}a.prototype.write=function(c,u,_,y){if(u===void 0)y="utf8",_=this.length,u=0;else if(_===void 0&&typeof u=="string")y=u,_=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(_)?(_=_>>>0,y===void 0&&(y="utf8")):(y=_,_=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const g=this.length-u;if((_===void 0||_>g)&&(_=g),c.length>0&&(_<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");let x=!1;for(;;)switch(y){case"hex":return ne(this,c,u,_);case"utf8":case"utf-8":return Q(this,c,u,_);case"ascii":case"latin1":case"binary":return Ne(this,c,u,_);case"base64":return me(this,c,u,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ye(this,c,u,_);default:if(x)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),x=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ye(h,c,u){return c===0&&u===h.length?e.fromByteArray(h):e.fromByteArray(h.slice(c,u))}function Tt(h,c,u){u=Math.min(h.length,u);const _=[];let y=c;for(;y<u;){const g=h[y];let x=null,K=g>239?4:g>223?3:g>191?2:1;if(y+K<=u){let fe,oe,he,te;switch(K){case 1:g<128&&(x=g);break;case 2:fe=h[y+1],(fe&192)===128&&(te=(g&31)<<6|fe&63,te>127&&(x=te));break;case 3:fe=h[y+1],oe=h[y+2],(fe&192)===128&&(oe&192)===128&&(te=(g&15)<<12|(fe&63)<<6|oe&63,te>2047&&(te<55296||te>57343)&&(x=te));break;case 4:fe=h[y+1],oe=h[y+2],he=h[y+3],(fe&192)===128&&(oe&192)===128&&(he&192)===128&&(te=(g&15)<<18|(fe&63)<<12|(oe&63)<<6|he&63,te>65535&&te<1114112&&(x=te))}}x===null?(x=65533,K=1):x>65535&&(x-=65536,_.push(x>>>10&1023|55296),x=56320|x&1023),_.push(x),y+=K}return b(_)}const le=4096;function b(h){const c=h.length;if(c<=le)return String.fromCharCode.apply(String,h);let u="",_=0;for(;_<c;)u+=String.fromCharCode.apply(String,h.slice(_,_+=le));return u}function j(h,c,u){let _="";u=Math.min(h.length,u);for(let y=c;y<u;++y)_+=String.fromCharCode(h[y]&127);return _}function F(h,c,u){let _="";u=Math.min(h.length,u);for(let y=c;y<u;++y)_+=String.fromCharCode(h[y]);return _}function D(h,c,u){const _=h.length;(!c||c<0)&&(c=0),(!u||u<0||u>_)&&(u=_);let y="";for(let g=c;g<u;++g)y+=af[h[g]];return y}function Z(h,c,u){const _=h.slice(c,u);let y="";for(let g=0;g<_.length-1;g+=2)y+=String.fromCharCode(_[g]+_[g+1]*256);return y}a.prototype.slice=function(c,u){const _=this.length;c=~~c,u=u===void 0?_:~~u,c<0?(c+=_,c<0&&(c=0)):c>_&&(c=_),u<0?(u+=_,u<0&&(u=0)):u>_&&(u=_),u<c&&(u=c);const y=this.subarray(c,u);return Object.setPrototypeOf(y,a.prototype),y};function C(h,c,u){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+c>u)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(c,u,_){c=c>>>0,u=u>>>0,_||C(c,u,this.length);let y=this[c],g=1,x=0;for(;++x<u&&(g*=256);)y+=this[c+x]*g;return y},a.prototype.readUintBE=a.prototype.readUIntBE=function(c,u,_){c=c>>>0,u=u>>>0,_||C(c,u,this.length);let y=this[c+--u],g=1;for(;u>0&&(g*=256);)y+=this[c+--u]*g;return y},a.prototype.readUint8=a.prototype.readUInt8=function(c,u){return c=c>>>0,u||C(c,1,this.length),this[c]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(c,u){return c=c>>>0,u||C(c,2,this.length),this[c]|this[c+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(c,u){return c=c>>>0,u||C(c,2,this.length),this[c]<<8|this[c+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(c,u){return c=c>>>0,u||C(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(c,u){return c=c>>>0,u||C(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},a.prototype.readBigUInt64LE=pt(function(c){c=c>>>0,We(c,"offset");const u=this[c],_=this[c+7];(u===void 0||_===void 0)&&hn(c,this.length-8);const y=u+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24,g=this[++c]+this[++c]*2**8+this[++c]*2**16+_*2**24;return BigInt(y)+(BigInt(g)<<BigInt(32))}),a.prototype.readBigUInt64BE=pt(function(c){c=c>>>0,We(c,"offset");const u=this[c],_=this[c+7];(u===void 0||_===void 0)&&hn(c,this.length-8);const y=u*2**24+this[++c]*2**16+this[++c]*2**8+this[++c],g=this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+_;return(BigInt(y)<<BigInt(32))+BigInt(g)}),a.prototype.readIntLE=function(c,u,_){c=c>>>0,u=u>>>0,_||C(c,u,this.length);let y=this[c],g=1,x=0;for(;++x<u&&(g*=256);)y+=this[c+x]*g;return g*=128,y>=g&&(y-=Math.pow(2,8*u)),y},a.prototype.readIntBE=function(c,u,_){c=c>>>0,u=u>>>0,_||C(c,u,this.length);let y=u,g=1,x=this[c+--y];for(;y>0&&(g*=256);)x+=this[c+--y]*g;return g*=128,x>=g&&(x-=Math.pow(2,8*u)),x},a.prototype.readInt8=function(c,u){return c=c>>>0,u||C(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},a.prototype.readInt16LE=function(c,u){c=c>>>0,u||C(c,2,this.length);const _=this[c]|this[c+1]<<8;return _&32768?_|4294901760:_},a.prototype.readInt16BE=function(c,u){c=c>>>0,u||C(c,2,this.length);const _=this[c+1]|this[c]<<8;return _&32768?_|4294901760:_},a.prototype.readInt32LE=function(c,u){return c=c>>>0,u||C(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},a.prototype.readInt32BE=function(c,u){return c=c>>>0,u||C(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},a.prototype.readBigInt64LE=pt(function(c){c=c>>>0,We(c,"offset");const u=this[c],_=this[c+7];(u===void 0||_===void 0)&&hn(c,this.length-8);const y=this[c+4]+this[c+5]*2**8+this[c+6]*2**16+(_<<24);return(BigInt(y)<<BigInt(32))+BigInt(u+this[++c]*256+this[++c]*65536+this[++c]*16777216)}),a.prototype.readBigInt64BE=pt(function(c){c=c>>>0,We(c,"offset");const u=this[c],_=this[c+7];(u===void 0||_===void 0)&&hn(c,this.length-8);const y=(u<<24)+this[++c]*2**16+this[++c]*2**8+this[++c];return(BigInt(y)<<BigInt(32))+BigInt(this[++c]*16777216+this[++c]*65536+this[++c]*256+_)}),a.prototype.readFloatLE=function(c,u){return c=c>>>0,u||C(c,4,this.length),n.read(this,c,!0,23,4)},a.prototype.readFloatBE=function(c,u){return c=c>>>0,u||C(c,4,this.length),n.read(this,c,!1,23,4)},a.prototype.readDoubleLE=function(c,u){return c=c>>>0,u||C(c,8,this.length),n.read(this,c,!0,52,8)},a.prototype.readDoubleBE=function(c,u){return c=c>>>0,u||C(c,8,this.length),n.read(this,c,!1,52,8)};function $(h,c,u,_,y,g){if(!a.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>y||c<g)throw new RangeError('"value" argument is out of bounds');if(u+_>h.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(c,u,_,y){if(c=+c,u=u>>>0,_=_>>>0,!y){const K=Math.pow(2,8*_)-1;$(this,c,u,_,K,0)}let g=1,x=0;for(this[u]=c&255;++x<_&&(g*=256);)this[u+x]=c/g&255;return u+_},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(c,u,_,y){if(c=+c,u=u>>>0,_=_>>>0,!y){const K=Math.pow(2,8*_)-1;$(this,c,u,_,K,0)}let g=_-1,x=1;for(this[u+g]=c&255;--g>=0&&(x*=256);)this[u+g]=c/x&255;return u+_},a.prototype.writeUint8=a.prototype.writeUInt8=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,1,255,0),this[u]=c&255,u+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,2,65535,0),this[u]=c&255,this[u+1]=c>>>8,u+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,2,65535,0),this[u]=c>>>8,this[u+1]=c&255,u+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,4,4294967295,0),this[u+3]=c>>>24,this[u+2]=c>>>16,this[u+1]=c>>>8,this[u]=c&255,u+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,4,4294967295,0),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4};function re(h,c,u,_,y){Me(c,_,y,h,u,7);let g=Number(c&BigInt(4294967295));h[u++]=g,g=g>>8,h[u++]=g,g=g>>8,h[u++]=g,g=g>>8,h[u++]=g;let x=Number(c>>BigInt(32)&BigInt(4294967295));return h[u++]=x,x=x>>8,h[u++]=x,x=x>>8,h[u++]=x,x=x>>8,h[u++]=x,u}function ie(h,c,u,_,y){Me(c,_,y,h,u,7);let g=Number(c&BigInt(4294967295));h[u+7]=g,g=g>>8,h[u+6]=g,g=g>>8,h[u+5]=g,g=g>>8,h[u+4]=g;let x=Number(c>>BigInt(32)&BigInt(4294967295));return h[u+3]=x,x=x>>8,h[u+2]=x,x=x>>8,h[u+1]=x,x=x>>8,h[u]=x,u+8}a.prototype.writeBigUInt64LE=pt(function(c,u=0){return re(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=pt(function(c,u=0){return ie(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(c,u,_,y){if(c=+c,u=u>>>0,!y){const fe=Math.pow(2,8*_-1);$(this,c,u,_,fe-1,-fe)}let g=0,x=1,K=0;for(this[u]=c&255;++g<_&&(x*=256);)c<0&&K===0&&this[u+g-1]!==0&&(K=1),this[u+g]=(c/x>>0)-K&255;return u+_},a.prototype.writeIntBE=function(c,u,_,y){if(c=+c,u=u>>>0,!y){const fe=Math.pow(2,8*_-1);$(this,c,u,_,fe-1,-fe)}let g=_-1,x=1,K=0;for(this[u+g]=c&255;--g>=0&&(x*=256);)c<0&&K===0&&this[u+g+1]!==0&&(K=1),this[u+g]=(c/x>>0)-K&255;return u+_},a.prototype.writeInt8=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,1,127,-128),c<0&&(c=255+c+1),this[u]=c&255,u+1},a.prototype.writeInt16LE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,2,32767,-32768),this[u]=c&255,this[u+1]=c>>>8,u+2},a.prototype.writeInt16BE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,2,32767,-32768),this[u]=c>>>8,this[u+1]=c&255,u+2},a.prototype.writeInt32LE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,4,2147483647,-2147483648),this[u]=c&255,this[u+1]=c>>>8,this[u+2]=c>>>16,this[u+3]=c>>>24,u+4},a.prototype.writeInt32BE=function(c,u,_){return c=+c,u=u>>>0,_||$(this,c,u,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4},a.prototype.writeBigInt64LE=pt(function(c,u=0){return re(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=pt(function(c,u=0){return ie(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ee(h,c,u,_,y,g){if(u+_>h.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function se(h,c,u,_,y){return c=+c,u=u>>>0,y||ee(h,c,u,4),n.write(h,c,u,_,23,4),u+4}a.prototype.writeFloatLE=function(c,u,_){return se(this,c,u,!0,_)},a.prototype.writeFloatBE=function(c,u,_){return se(this,c,u,!1,_)};function J(h,c,u,_,y){return c=+c,u=u>>>0,y||ee(h,c,u,8),n.write(h,c,u,_,52,8),u+8}a.prototype.writeDoubleLE=function(c,u,_){return J(this,c,u,!0,_)},a.prototype.writeDoubleBE=function(c,u,_){return J(this,c,u,!1,_)},a.prototype.copy=function(c,u,_,y){if(!a.isBuffer(c))throw new TypeError("argument should be a Buffer");if(_||(_=0),!y&&y!==0&&(y=this.length),u>=c.length&&(u=c.length),u||(u=0),y>0&&y<_&&(y=_),y===_||c.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(_<0||_>=this.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),c.length-u<y-_&&(y=c.length-u+_);const g=y-_;return this===c&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,_,y):Uint8Array.prototype.set.call(c,this.subarray(_,y),u),g},a.prototype.fill=function(c,u,_,y){if(typeof c=="string"){if(typeof u=="string"?(y=u,u=0,_=this.length):typeof _=="string"&&(y=_,_=this.length),y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!a.isEncoding(y))throw new TypeError("Unknown encoding: "+y);if(c.length===1){const x=c.charCodeAt(0);(y==="utf8"&&x<128||y==="latin1")&&(c=x)}}else typeof c=="number"?c=c&255:typeof c=="boolean"&&(c=Number(c));if(u<0||this.length<u||this.length<_)throw new RangeError("Out of range index");if(_<=u)return this;u=u>>>0,_=_===void 0?this.length:_>>>0,c||(c=0);let g;if(typeof c=="number")for(g=u;g<_;++g)this[g]=c;else{const x=a.isBuffer(c)?c:a.from(c,y),K=x.length;if(K===0)throw new TypeError('The value "'+c+'" is invalid for argument "value"');for(g=0;g<_-u;++g)this[g+u]=x[g%K]}return this};const de={};function Ee(h,c,u){de[h]=class extends u{constructor(){super(),Object.defineProperty(this,"message",{value:c.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${h}]`,this.stack,delete this.name}get code(){return h}set code(y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:y,writable:!0})}toString(){return`${this.name} [${h}]: ${this.message}`}}}Ee("ERR_BUFFER_OUT_OF_BOUNDS",function(h){return h?`${h} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ee("ERR_INVALID_ARG_TYPE",function(h,c){return`The "${h}" argument must be of type number. Received type ${typeof c}`},TypeError),Ee("ERR_OUT_OF_RANGE",function(h,c,u){let _=`The value of "${h}" is out of range.`,y=u;return Number.isInteger(u)&&Math.abs(u)>4294967296?y=be(String(u)):typeof u=="bigint"&&(y=String(u),(u>BigInt(2)**BigInt(32)||u<-(BigInt(2)**BigInt(32)))&&(y=be(y)),y+="n"),_+=` It must be ${c}. Received ${y}`,_},RangeError);function be(h){let c="",u=h.length;const _=h[0]==="-"?1:0;for(;u>=_+4;u-=3)c=`_${h.slice(u-3,u)}${c}`;return`${h.slice(0,u)}${c}`}function Be(h,c,u){We(c,"offset"),(h[c]===void 0||h[c+u]===void 0)&&hn(c,h.length-(u+1))}function Me(h,c,u,_,y,g){if(h>u||h<c){const x=typeof c=="bigint"?"n":"";let K;throw c===0||c===BigInt(0)?K=`>= 0${x} and < 2${x} ** ${(g+1)*8}${x}`:K=`>= -(2${x} ** ${(g+1)*8-1}${x}) and < 2 ** ${(g+1)*8-1}${x}`,new de.ERR_OUT_OF_RANGE("value",K,h)}Be(_,y,g)}function We(h,c){if(typeof h!="number")throw new de.ERR_INVALID_ARG_TYPE(c,"number",h)}function hn(h,c,u){throw Math.floor(h)!==h?(We(h,u),new de.ERR_OUT_OF_RANGE("offset","an integer",h)):c<0?new de.ERR_BUFFER_OUT_OF_BOUNDS:new de.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${c}`,h)}const nf=/[^+/0-9A-Za-z-_]/g;function rf(h){if(h=h.split("=")[0],h=h.trim().replace(nf,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function di(h,c){c=c||1/0;let u;const _=h.length;let y=null;const g=[];for(let x=0;x<_;++x){if(u=h.charCodeAt(x),u>55295&&u<57344){if(!y){if(u>56319){(c-=3)>-1&&g.push(239,191,189);continue}else if(x+1===_){(c-=3)>-1&&g.push(239,191,189);continue}y=u;continue}if(u<56320){(c-=3)>-1&&g.push(239,191,189),y=u;continue}u=(y-55296<<10|u-56320)+65536}else y&&(c-=3)>-1&&g.push(239,191,189);if(y=null,u<128){if((c-=1)<0)break;g.push(u)}else if(u<2048){if((c-=2)<0)break;g.push(u>>6|192,u&63|128)}else if(u<65536){if((c-=3)<0)break;g.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((c-=4)<0)break;g.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return g}function sf(h){const c=[];for(let u=0;u<h.length;++u)c.push(h.charCodeAt(u)&255);return c}function of(h,c){let u,_,y;const g=[];for(let x=0;x<h.length&&!((c-=2)<0);++x)u=h.charCodeAt(x),_=u>>8,y=u%256,g.push(y),g.push(_);return g}function Oo(h){return e.toByteArray(rf(h))}function er(h,c,u,_){let y;for(y=0;y<_&&!(y+u>=c.length||y>=h.length);++y)c[y+u]=h[y];return y}function Xe(h,c){return h instanceof c||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===c.name}function fi(h){return h!==h}const af=function(){const h="0123456789abcdef",c=new Array(256);for(let u=0;u<16;++u){const _=u*16;for(let y=0;y<16;++y)c[_+y]=h[u]+h[y]}return c}();function pt(h){return typeof BigInt>"u"?cf:h}function cf(){throw new Error("BigInt not supported")}})(at);const Qn={name:"RSA-OAEP",hash:"SHA-256"},Gn={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},mo="spki",go="pkcs8",Yn={name:"AES-GCM",length:256},ui=12,bd=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},wd=async(t,e)=>JSON.parse(new TextDecoder().decode(await crypto.subtle.decrypt(Qn,await Xn(t,"decrypt"),bd(e)))),Xn=(t,e)=>crypto.subtle.importKey(e==="decrypt"||e==="sign"?go:mo,at.Buffer.from(t,"base64"),e==="decrypt"||e==="encrypt"?Qn:Gn,!1,[e]),vo=(t,e)=>crypto.subtle.importKey("raw",at.Buffer.from(t,"base64"),Yn,!1,e),xd=async(t,e)=>at.Buffer.from(await crypto.subtle.encrypt(Qn,await Xn(t,"encrypt"),new TextEncoder().encode(JSON.stringify(e)))).toString("base64"),bo=async(t,e)=>btoa(String.fromCharCode(...new Uint8Array(await crypto.subtle.exportKey(e,t)))),Sd=async({publicKey:t,privateKey:e})=>({publicKey:await bo(t,mo),privateKey:await bo(e,go)}),wo=async t=>Sd(await crypto.subtle.generateKey({...t==="encrypt"?Qn:Gn,modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},!0,t==="encrypt"?["encrypt","decrypt"]:["sign","verify"])),kd=async(t,e)=>at.Buffer.from(await crypto.subtle.sign(Gn,await Xn(t,"sign"),new TextEncoder().encode(e))).toString("base64"),Od=async(t,e,n)=>crypto.subtle.verify(Gn,await Xn(e,"verify"),at.Buffer.from(t,"base64"),new TextEncoder().encode(n)),Ed=async(t,e)=>{const n=crypto.getRandomValues(new Uint8Array(ui)),r=await vo(t,["encrypt"]),i=new TextEncoder().encode(JSON.stringify(e)),s=new Uint8Array(await crypto.subtle.encrypt({...Yn,iv:n},r,i)),o=new Uint8Array(n.length+s.length);return o.set(n,0),o.set(s,n.length),at.Buffer.from(o).toString("base64")},Td=async(t,e)=>{const n=at.Buffer.from(e,"base64"),r=n.subarray(0,ui),i=n.subarray(ui),s=await vo(t,["decrypt"]),o=await crypto.subtle.decrypt({...Yn,iv:r},s,i);return JSON.parse(new TextDecoder().decode(o))},Id=async()=>{const t=await crypto.subtle.generateKey(Yn,!0,["encrypt","decrypt"]),e=await crypto.subtle.exportKey("raw",t);return at.Buffer.from(new Uint8Array(e)).toString("base64")},Ad="8f3bebac-da7b-44ab-9cf5-46a6cc11557e",xo=_o,Cd=async({conversationKey:t,conversation:e,credentials:{privateSignKey:n,publicSignKey:r},message:i})=>{const s=await Ed(t,{payload:i,publicSignKey:r,signature:await kd(n,xo(i))});return si({endpoint:"sendMessage",payload:{conversation:e,encryptedMessage:s}})},jd=t=>async e=>{const n=await Td(t,e.payload);if(!n)throw new Error("Failed to decrypt message");if(!await Od(n.signature,n.publicSignKey,xo(n.payload)))throw new Error("Invalid signature");return{publicSignKey:n.publicSignKey,timestamp:e.timestamp,...n.payload}},Rd=({queryOnce:t})=>async(e,n)=>{const{data:{identities:r}}=await t({identities:{account:{},$:{where:{publicSignKey:{$in:e}}}}});if(r.length!==e.length)return{error:"invalid-participants"};const i=ht(Bt(({publicSignKey:o,publicEncryptKey:a})=>[o,a]),Object.fromEntries)(r),s=await Id();return ht(Bt(async o=>[o,await xd(i[o],s)]),Object.fromEntries,o=>si({endpoint:"createConversation",payload:{publicSignKeyToEncryptedSymmetricKey:o,title:n}}))(e)},Pd=async t=>{const e=await wo("sign"),n=await wo("encrypt");return await si({endpoint:"createAnonymousIdentity",payload:{name:t,publicSignKey:e.publicKey,publicEncryptKey:n.publicKey}}),{publicSignKey:e.publicKey,privateSignKey:e.privateKey,privateEncryptKey:n.privateKey}},Md=[{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"week",seconds:604800},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60},{unit:"second",seconds:1}];function $d(t,e=Date.now()){const n=t instanceof Date?t.getTime():t,i=((e instanceof Date?e.getTime():e)-n)/1e3;if(i<0)throw new Error("Time cannot be in the future");if(i<1)return"just now";for(const{unit:s,seconds:o}of Md)if(i>=o){const a=Math.round(i/o);return`${a===1?s==="hour"?"an":"a":a} ${s}${a>1?"s":""} ago`}}const fn=()=>typeof globalThis<"u"&&"matchMedia"in globalThis&&globalThis.matchMedia("(prefers-color-scheme: dark)").matches,Ud={border:"1px solid #ccc",padding:8,background:fn()?"#1a202c":"#fff",color:fn()?"#f3f4f6":"#222",borderColor:fn()?"#374151":"#ccc",transition:"background 0.2s, color 0.2s, border-color 0.2s"},Nd={height:700,width:400,overflowY:"auto",marginBottom:8,gap:8,display:"flex",flexDirection:"column-reverse",background:fn()?"#111827":"#f9fafb",transition:"background 0.2s"},Bd={fontSize:12,color:"#bbb"},Dd=t=>{let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);return`hsl(${Math.abs(e)%360}, 60%, 70%)`},So=t=>{const e=t.match(/hsl\(\d+, *\d+%, *(\d+)%\)/);return!e||parseInt(e[1],10)>60},Ld=({bubbleColor:t,textColor:e,isOwn:n,showAvatar:r,align:i})=>({background:t,color:e,borderRadius:16,padding:"6px 12px",maxWidth:220,marginLeft:n||!n&&r?0:36,marginRight:n?r?0:36:0,alignSelf:i}),Fd=({msg:{authorId:t,authorName:e,authorAvatar:n,text:r,timestamp:i},next:s,isOwn:o})=>{const a=!s||s.authorId!==t,l=Dd(t),d=a,f=So(l)?"#222":"#fff";return G("div",{style:{display:"flex",gap:4,flexDirection:o?"row-reverse":"row"},children:[d&&G("div",{style:{width:28,height:28,borderRadius:"50%",marginRight:8,background:l,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:n?G("img",{src:n,alt:e,style:{width:28,height:28,objectFit:"cover",borderRadius:"50%"}}):G("span",{style:{color:So(l)?"#222":"#fff",fontWeight:700,fontSize:14},children:e.slice(0,2).toUpperCase()})}),G("div",{style:Ld({textColor:f,bubbleColor:l,isOwn:o,showAvatar:d,align:o?"flex-end":"flex-start"}),children:[G("b",{style:{fontSize:11},children:e}),G("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:r}),G("span",{style:{color:f==="#222"?"#555":"#eee",fontSize:10,float:"right"},children:$d(i)})]})]})},Zd=({onClose:t})=>{const e=fn(),n=e?"#23272f":"#f3f4f6",r=e?"#374151":"#e5e7eb",i=e?"#eee":"#222";return G("button",{type:"button",onClick:t,title:"Close chat",style:{position:"absolute",top:8,right:8,background:n,border:"none",borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.07)",cursor:"pointer",fontSize:22,color:i,zIndex:10,transition:"background 0.2s, color 0.2s",padding:0,fontWeight:700,lineHeight:1},onMouseOver:s=>s.currentTarget.style.background=r,onMouseOut:s=>s.currentTarget.style.background=n,children:G("span",{style:{fontSize:22,fontWeight:700,lineHeight:1,color:i},children:""})})},qd=({limit:t,setLimit:e,userId:n,onSend:r,messages:i,onClose:s})=>{const[o,a]=$e(!1),l=yt(null),[d,f]=$e(""),p=yt(null),m=yt(null),v=()=>{m.current&&!o&&m.current.scrollTop===0&&(i==null?void 0:i.length)===t&&(a(!0),e(S=>S+100),a(!1))};return Ae(()=>{if(m.current)return m.current.addEventListener("scroll",v),()=>{var S;return(S=m.current)==null?void 0:S.removeEventListener("scroll",v)}},[t,i,o]),G("div",{style:{...Ud,position:"relative"},children:[s&&G(Zd,{onClose:s}),G("div",{ref:m,style:Nd,children:[i.map((S,T)=>G(Fd,{isOwn:S.authorId===n,msg:S,next:i[T+1]},T)),G("div",{ref:l})]}),G("div",{className:"flex items-center mt-2 gap-2",children:[G("input",{ref:p,value:d,onChange:S=>f(S.currentTarget.value),onKeyDown:S=>{S.key==="Enter"&&d.trim()&&(r(d.trim()),f(""))},placeholder:"Type a message...",className:`flex-grow p-2 border rounded-md 
                     bg-gray-50 dark:bg-gray-700 
                     border-gray-300 dark:border-gray-600 
                     text-gray-900 dark:text-white 
                     placeholder-gray-500 dark:placeholder-gray-400
                     focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500`}),G("button",{type:"button",disabled:!d.trim(),onClick:()=>r(d.trim()),className:`p-2 border border-blue-500 rounded-md 
                     bg-blue-500 hover:bg-blue-600 
                     text-white 
                     focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 
                     disabled:opacity-50 disabled:cursor-not-allowed`,children:"Send"})]}),o&&G("div",{style:Bd,children:"Loading more..."})]})},Vd=t=>e=>{var n,r;return{authorId:e.publicSignKey,authorName:((n=t[e.publicSignKey])==null?void 0:n.name)||e.publicSignKey,authorAvatar:(r=t[e.publicSignKey])==null?void 0:r.avatar,text:e.text,timestamp:e.timestamp}},zd=(t,e,n,r)=>{const[i,s]=$e([]),{data:o,error:a}=t.useQuery({messages:{conversation:{},$:{where:{conversation:r},order:{timestamp:"desc"},limit:e}}});a&&console.error(a);const l=o==null?void 0:o.messages;Ae(()=>{if(n&&l){const p=[...l].sort((m,v)=>v.timestamp-m.timestamp);ht(Bt(jd(n)),s)(p)}},[n,l]);const{data:d}=t.useQuery({identities:{$:{where:{publicSignKey:{$in:i.map(p=>p.publicSignKey)}}}}}),f=Object.fromEntries(((d==null?void 0:d.identities)??[]).map(p=>[p.publicSignKey,{name:p.name||p.publicSignKey,avatar:p.avatar}]));return i.map(Vd(f))},Wd=t=>({credentials:e,conversationId:n,onClose:r})=>{const i=Kd(t)(n,e),[s,o]=$e(100);return G(qd,{onClose:r,limit:s,setLimit:o,userId:e.publicSignKey,messages:zd(t,s,i,n),onSend:a=>{if(!i)return null;Cd({conversationKey:i,credentials:e,message:{type:"text",text:a},conversation:n}).catch(l=>{console.error("Failed to send message",l)})}})},Kd=({useQuery:t})=>(e,{publicSignKey:n,privateEncryptKey:r})=>{var d;const[i,s]=$e(null),{isLoading:o,error:a,data:l}=t({keys:{$:{where:{"owner.publicSignKey":n,conversation:e}}}});return a?(console.error("Failed to fetch conversation key",a),null):o?null:(Ae(()=>{var f;if((f=l.keys[0])!=null&&f.key){if(l.keys.length>1)throw new Error("Multiple keys found");wd(r,l.keys[0].key).then(p=>{s(p)})}},[(d=l.keys[0])==null?void 0:d.key,r]),i)},Hd=ue.schema({entities:{$files:ue.entity({path:ue.string().unique().indexed(),url:ue.any()}),$users:ue.entity({email:ue.string().unique().indexed()}),accounts:ue.entity({email:ue.string().unique().indexed().optional(),accessToken:ue.string().optional().unique().indexed()}),messages:ue.entity({payload:ue.json(),timestamp:ue.number().indexed()}),identities:ue.entity({name:ue.string().optional(),avatar:ue.string().optional(),publicEncryptKey:ue.string().unique().indexed(),publicSignKey:ue.string().unique().indexed(),webhook:ue.string().indexed().optional()}),conversations:ue.entity({title:ue.string()}),keys:ue.entity({key:ue.json()})},links:{conversationMessages:{forward:{on:"conversations",label:"messages",has:"many"},reverse:{on:"messages",label:"conversation",has:"one"}},accountIdentities:{forward:{on:"accounts",label:"identities",has:"many"},reverse:{on:"identities",label:"account",has:"one"}},conversationKeys:{forward:{on:"conversations",label:"keys",has:"many"},reverse:{on:"keys",label:"conversation",has:"one"}},identityKeys:{forward:{on:"identities",label:"keys",has:"many"},reverse:{on:"keys",label:"owner",has:"one"}},conversationParent:{forward:{on:"conversations",label:"parent",has:"one"},reverse:{on:"conversations",label:"child",has:"one"}},conversationParticipants:{forward:{on:"conversations",label:"participants",has:"many"},reverse:{on:"identities",label:"conversations",has:"many"}},conversationAdmins:{forward:{on:"conversations",label:"admins",has:"many"},reverse:{on:"identities",label:"managedConversations",has:"many"}}},rooms:{}}),li=Gu({appId:Ad,schema:Hd}),Jd=Kl(li),Qd=Wd(li),Gd=Rd(li),Yd=(t,e)=>{const[n,r]=$e(null),i=Jd(t);return Ae(()=>{if(n)return;const s=i.find(({participants:o})=>o.some(({publicSignKey:a})=>a===e));if(s){r(s.id);return}Gd([t.publicSignKey,e],"Chat")},[n,i]),n},Xd=t=>{const[e,n]=$e(null);return Ae(()=>{const r=localStorage.getItem("aliceAndBotCredentials");if(r){n(JSON.parse(r));return}t&&Pd(t).then(i=>{n(i),localStorage.setItem("aliceAndBotCredentials",JSON.stringify(i))})},[t]),e},ef=({dialTo:t})=>{const[e,n]=$e(!1),[r,i]=$e(null),s=Xd(r),o=e&&s&&Yd(s,t);return e?o?G(Qd,{onClose:()=>{n(!1)},credentials:s,conversationId:o}):s?G("div",{children:G("p",{children:"Getting/creating conversation..."})}):G("div",{children:G("p",{children:"Loading credentials..."})}):e?null:o?G("div",{children:G("button",{type:"button",onClick:()=>n(!0),children:"Open Chat"})}):s?G("div",{children:G("button",{type:"button",onClick:()=>{n(!0)},children:"Start Chat"})}):G("div",{children:G("button",{type:"button",onClick:()=>{const a=prompt("Enter your name:");a?(i(a),n(!0)):alert("Name is required to start a chat.")},children:"Start Chat"})})},ko="alice-and-bot-widget-root",tf=t=>{if(document.getElementById(ko))return;const n=document.createElement("div");n.id=ko,document.body.appendChild(n),jo(G(ef,{dialTo:t.dialingTo}),n)};return tr.loadChatWidget=tf,Object.defineProperty(tr,Symbol.toStringTag,{value:"Module"}),tr}({});
//# sourceMappingURL=widget.iife.js.map
